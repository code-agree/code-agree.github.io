<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><title>高频交易中的订单数据结构设计与性能优化实战 &#183; Yu's Space</title>
<meta name=title content="高频交易中的订单数据结构设计与性能优化实战 &#183; Yu's Space"><script type=text/javascript src=/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.082522985b9d96110f0c3ccb5a94a702d82e62aac41510fb092b696d287ac5aa.css integrity="sha256-CCUimFudlhEPDDzLWpSnAtguYqrEFRD7CStpbSh6xao="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.224115d95321e7008c42d7cef4967237dae3442b508de128eb5ba1119c977750.js integrity="sha256-IkEV2VMh5wCMQtfO9JZyN9rjRCtQjeEo61uhEZyXd1A=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      
        主题：基于并发读写性能优化的订单数据结构重构与底层机制剖析
目录 # 一、业务背景：订单状态的高并发维护 二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 三、优化目标：极致的并发 + O(1) 访问性能 四、核心优化：整数 ID + array 映射结构 五、底层原理解析：为什么 array + int ID 更快? 1. 内存寻址机制(指针偏移) 2. CPU Cache Line 利用与伪共享问题 3. 避免堆分配与内存碎片 4. 内存序(Memory Ordering)选择与原子操作 5. 整数ID分配和回收机制 六、性能测试数据 七、关键组件优化示例 1. OrderBook实现优化 2. RingBuffer优化 八、NUMA架构下的内存访问优化 九、最终方案优势对比总结 九、结语：高频系统的设计哲学 一、业务背景：订单状态的高并发维护 #在高频交易(HFT)系统中，我们需要对数百万级别的订单状态进行并发读写，以支撑如下操作：
✅ 新增订单(add_order(order_id)) ✅ 修改订单状态(如 fill_qty, status 等) ✅ 高频查询订单状态(如成交均价、当前剩余量等) 这些操作高并发、延迟敏感，需要 O(1) 级别的响应，并且不能产生性能抖动或不可控的锁竞争。
二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 #在早期系统中，常见的设计是以字符串 ID 作为订单主键，例如：
struct Order { char id[32]; char instId[16]; .
      
    "><link rel=canonical href=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="高频交易中的订单数据结构设计与性能优化实战"><meta property="og:description" content="主题：基于并发读写性能优化的订单数据结构重构与底层机制剖析
目录 # 一、业务背景：订单状态的高并发维护 二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 三、优化目标：极致的并发 + O(1) 访问性能 四、核心优化：整数 ID + array 映射结构 五、底层原理解析：为什么 array + int ID 更快? 1. 内存寻址机制(指针偏移) 2. CPU Cache Line 利用与伪共享问题 3. 避免堆分配与内存碎片 4. 内存序(Memory Ordering)选择与原子操作 5. 整数ID分配和回收机制 六、性能测试数据 七、关键组件优化示例 1. OrderBook实现优化 2. RingBuffer优化 八、NUMA架构下的内存访问优化 九、最终方案优势对比总结 九、结语：高频系统的设计哲学 一、业务背景：订单状态的高并发维护 #在高频交易(HFT)系统中，我们需要对数百万级别的订单状态进行并发读写，以支撑如下操作：
✅ 新增订单(add_order(order_id)) ✅ 修改订单状态(如 fill_qty, status 等) ✅ 高频查询订单状态(如成交均价、当前剩余量等) 这些操作高并发、延迟敏感，需要 O(1) 级别的响应，并且不能产生性能抖动或不可控的锁竞争。
二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 #在早期系统中，常见的设计是以字符串 ID 作为订单主键，例如：
struct Order { char id[32]; char instId[16]; ."><meta property="og:type" content="article"><meta property="og:url" content="https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-06-19T19:58:31+08:00"><meta property="article:modified_time" content="2025-06-19T19:58:31+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="高频交易中的订单数据结构设计与性能优化实战"><meta name=twitter:description content="主题：基于并发读写性能优化的订单数据结构重构与底层机制剖析
目录 # 一、业务背景：订单状态的高并发维护 二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 三、优化目标：极致的并发 + O(1) 访问性能 四、核心优化：整数 ID + array 映射结构 五、底层原理解析：为什么 array + int ID 更快? 1. 内存寻址机制(指针偏移) 2. CPU Cache Line 利用与伪共享问题 3. 避免堆分配与内存碎片 4. 内存序(Memory Ordering)选择与原子操作 5. 整数ID分配和回收机制 六、性能测试数据 七、关键组件优化示例 1. OrderBook实现优化 2. RingBuffer优化 八、NUMA架构下的内存访问优化 九、最终方案优势对比总结 九、结语：高频系统的设计哲学 一、业务背景：订单状态的高并发维护 #在高频交易(HFT)系统中，我们需要对数百万级别的订单状态进行并发读写，以支撑如下操作：
✅ 新增订单(add_order(order_id)) ✅ 修改订单状态(如 fill_qty, status 等) ✅ 高频查询订单状态(如成交均价、当前剩余量等) 这些操作高并发、延迟敏感，需要 O(1) 级别的响应，并且不能产生性能抖动或不可控的锁竞争。
二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 #在早期系统中，常见的设计是以字符串 ID 作为订单主键，例如：
struct Order { char id[32]; char instId[16]; ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"高频交易中的订单数据结构设计与性能优化实战","headline":"高频交易中的订单数据结构设计与性能优化实战","abstract":"主题：基于并发读写性能优化的订单数据结构重构与底层机制剖析\n目录 # 一、业务背景：订单状态的高并发维护 二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 三、优化目标：极致的并发 \u002b O(1) 访问性能 四、核心优化：整数 ID \u002b array 映射结构 五、底层原理解析：为什么 array \u002b int ID 更快? 1. 内存寻址机制(指针偏移) 2. CPU Cache Line 利用与伪共享问题 3. 避免堆分配与内存碎片 4. 内存序(Memory Ordering)选择与原子操作 5. 整数ID分配和回收机制 六、性能测试数据 七、关键组件优化示例 1. OrderBook实现优化 2. RingBuffer优化 八、NUMA架构下的内存访问优化 九、最终方案优势对比总结 九、结语：高频系统的设计哲学 一、业务背景：订单状态的高并发维护 #在高频交易(HFT)系统中，我们需要对数百万级别的订单状态进行并发读写，以支撑如下操作：\n✅ 新增订单(add_order(order_id)) ✅ 修改订单状态(如 fill_qty, status 等) ✅ 高频查询订单状态(如成交均价、当前剩余量等) 这些操作高并发、延迟敏感，需要 O(1) 级别的响应，并且不能产生性能抖动或不可控的锁竞争。\n二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 #在早期系统中，常见的设计是以字符串 ID 作为订单主键，例如：\nstruct Order { char id[32]; char instId[16]; .","inLanguage":"en","url":"https:\/\/code-agree.github.io\/blog\/2025-06-19-how_to_design_order_inlocalmemory\/","author":{"@type":"Person","name":"Wenjun Yu"},"copyrightYear":"2025","dateCreated":"2025-06-19T19:58:31\u002b08:00","datePublished":"2025-06-19T19:58:31\u002b08:00","dateModified":"2025-06-19T19:58:31\u002b08:00","mainEntityOfPage":"true","wordCount":"752"}</script><meta name=author content="Wenjun Yu"><link href=https://github.com/code-agree rel=me><link href=https://x.com/flight_from_ rel=me><link href=mailto:lineyua66@gmail.com rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Yu&rsquo;s Space</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/blog/ title=Blog><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/projects/ title=Projects><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/tags/ title=Tags><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/about/ title="About Me"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=search-button-1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-4xl><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">高频交易中的订单数据结构设计与性能优化实战</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2025-06-19 19:58:31 +0800 +0800">19 June 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">4 mins</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="min-h-0 min-w-0 max-w-4xl grow"><p>主题：基于并发读写性能优化的订单数据结构重构与底层机制剖析</p><h2 id=目录 class="relative group">目录 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%9b%ae%e5%bd%95 aria-label=Anchor>#</a></span></h2><ul><li><a href=#%e4%b8%80%e4%b8%9a%e5%8a%a1%e8%83%8c%e6%99%af%e8%ae%a2%e5%8d%95%e7%8a%b6%e6%80%81%e7%9a%84%e9%ab%98%e5%b9%b6%e5%8f%91%e7%bb%b4%e6%8a%a4>一、业务背景：订单状态的高并发维护</a></li><li><a href=#%e4%ba%8c%e5%b8%b8%e8%a7%81%e8%ae%be%e8%ae%a1%e9%99%b7%e9%98%b1char-%e5%ad%97%e7%ac%a6%e4%b8%b2-id-%e4%b8%8e%e5%93%88%e5%b8%8c%e8%a1%a8%e7%9a%84%e6%80%a7%e8%83%bd%e7%93%b6%e9%a2%88>二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈</a></li><li><a href=#%e4%b8%89%e4%bc%98%e5%8c%96%e7%9b%ae%e6%a0%87%e6%9e%81%e8%87%b4%e7%9a%84%e5%b9%b6%e5%8f%91--o1-%e8%ae%bf%e9%97%ae%e6%80%a7%e8%83%bd>三、优化目标：极致的并发 + O(1) 访问性能</a></li><li><a href=#%e5%9b%9b%e6%a0%b8%e5%bf%83%e4%bc%98%e5%8c%96%e6%95%b4%e6%95%b0-id--array-%e6%98%a0%e5%b0%84%e7%bb%93%e6%9e%84>四、核心优化：整数 ID + array 映射结构</a></li><li><a href=#%e4%ba%94%e5%ba%95%e5%b1%82%e5%8e%9f%e7%90%86%e8%a7%a3%e6%9e%90%e4%b8%ba%e4%bb%80%e4%b9%88-array--int-id-%e6%9b%b4%e5%bf%ab>五、底层原理解析：为什么 array + int ID 更快?</a><ul><li><a href=#1-%e5%86%85%e5%ad%98%e5%af%bb%e5%9d%80%e6%9c%ba%e5%88%b6%e6%8c%87%e9%92%88%e5%81%8f%e7%a7%bb>1. 内存寻址机制(指针偏移)</a></li><li><a href=#2-cpu-cache-line-%e5%88%a9%e7%94%a8%e4%b8%8e%e4%bc%aa%e5%85%b1%e4%ba%ab%e9%97%ae%e9%a2%98>2. CPU Cache Line 利用与伪共享问题</a></li><li><a href=#3-%e9%81%bf%e5%85%8d%e5%a0%86%e5%88%86%e9%85%8d%e4%b8%8e%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87>3. 避免堆分配与内存碎片</a></li><li><a href=#4-%e5%86%85%e5%ad%98%e5%ba%8fmemory-ordering%e9%80%89%e6%8b%a9%e4%b8%8e%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c>4. 内存序(Memory Ordering)选择与原子操作</a></li><li><a href=#5-%e6%95%b4%e6%95%b0id%e5%88%86%e9%85%8d%e5%92%8c%e5%9b%9e%e6%94%b6%e6%9c%ba%e5%88%b6>5. 整数ID分配和回收机制</a></li></ul></li><li><a href=#%e5%85%ad%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae>六、性能测试数据</a></li><li><a href=#%e4%b8%83%e5%85%b3%e9%94%ae%e7%bb%84%e4%bb%b6%e4%bc%98%e5%8c%96%e7%a4%ba%e4%be%8b>七、关键组件优化示例</a><ul><li><a href=#1-orderbook%e5%ae%9e%e7%8e%b0%e4%bc%98%e5%8c%96>1. OrderBook实现优化</a></li><li><a href=#2-ringbuffer%e4%bc%98%e5%8c%96>2. RingBuffer优化</a></li></ul></li><li><a href=#%e5%85%abnuma%e6%9e%b6%e6%9e%84%e4%b8%8b%e7%9a%84%e5%86%85%e5%ad%98%e8%ae%bf%e9%97%ae%e4%bc%98%e5%8c%96>八、NUMA架构下的内存访问优化</a></li><li><a href=#%e4%b9%9d%e6%9c%80%e7%bb%88%e6%96%b9%e6%a1%88%e4%bc%98%e5%8a%bf%e5%af%b9%e6%af%94%e6%80%bb%e7%bb%93>九、最终方案优势对比总结</a></li><li><a href=#%e4%b9%9d%e7%bb%93%e8%af%ad%e9%ab%98%e9%a2%91%e7%b3%bb%e7%bb%9f%e7%9a%84%e8%ae%be%e8%ae%a1%e5%93%b2%e5%ad%a6>九、结语：高频系统的设计哲学</a></li></ul><h2 id=一业务背景订单状态的高并发维护 class="relative group">一、业务背景：订单状态的高并发维护 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%b8%80%e4%b8%9a%e5%8a%a1%e8%83%8c%e6%99%af%e8%ae%a2%e5%8d%95%e7%8a%b6%e6%80%81%e7%9a%84%e9%ab%98%e5%b9%b6%e5%8f%91%e7%bb%b4%e6%8a%a4 aria-label=Anchor>#</a></span></h2><p>在高频交易(HFT)系统中，我们需要对<strong>数百万级别的订单状态</strong>进行<strong>并发读写</strong>，以支撑如下操作：</p><ul><li>✅ 新增订单(<code>add_order(order_id)</code>)</li><li>✅ 修改订单状态(如 <code>fill_qty</code>, <code>status</code> 等)</li><li>✅ 高频查询订单状态(如成交均价、当前剩余量等)</li></ul><p>这些操作<strong>高并发、延迟敏感</strong>，需要 O(1) 级别的响应，并且不能产生性能抖动或不可控的锁竞争。</p><h2 id=二常见设计陷阱char-字符串-id-与哈希表的性能瓶颈 class="relative group">二、常见设计陷阱：char[] 字符串 ID 与哈希表的性能瓶颈 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%8c%e5%b8%b8%e8%a7%81%e8%ae%be%e8%ae%a1%e9%99%b7%e9%98%b1char-%e5%ad%97%e7%ac%a6%e4%b8%b2-id-%e4%b8%8e%e5%93%88%e5%b8%8c%e8%a1%a8%e7%9a%84%e6%80%a7%e8%83%bd%e7%93%b6%e9%a2%88 aria-label=Anchor>#</a></span></h2><p>在早期系统中，常见的设计是以字符串 ID 作为订单主键，例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Order</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>id</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>instId</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>Order</span><span class=o>*&gt;</span> <span class=n>order_map</span><span class=p>;</span>
</span></span></code></pre></div><p>虽然这种结构通用性强、编码方便，但在高频场景下存在<strong>严重性能问题</strong>：</p><p>❌ 字符串 ID 的性能代价：</p><table><thead><tr><th>层面</th><th>性能问题</th><th>说明</th></tr></thead><tbody><tr><td>空间成本</td><td><code>char[32]</code> 每个对象固定 32 字节</td><td>相比整数多 8 倍以上空间</td></tr><tr><td>比较代价</td><td>字符串比较是 <code>O(N)</code>,不能一条指令完成</td><td><code>strcmp</code> 或 <code>memcmp</code> 成本高</td></tr><tr><td>哈希开销</td><td>字符串哈希需逐字符处理</td><td>多次内存访问,CPU 分支预测难</td></tr><tr><td>内存局部性</td><td>结构体大,cache line 命中率低</td><td>读取同一 cache line 中的对象更少</td></tr><tr><td>频繁堆分配</td><td><code>std::unordered_map</code> 使用堆分配</td><td>触发 malloc / rehash 带来不确定性</td></tr><tr><td>并发性能差</td><td>并发访问需加锁或分段锁</td><td><code>std::unordered_map</code> 不是线程安全</td></tr></tbody></table><h2 id=三优化目标极致的并发--o1-访问性能 class="relative group">三、优化目标：极致的并发 + O(1) 访问性能 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%b8%89%e4%bc%98%e5%8c%96%e7%9b%ae%e6%a0%87%e6%9e%81%e8%87%b4%e7%9a%84%e5%b9%b6%e5%8f%91--o1-%e8%ae%bf%e9%97%ae%e6%80%a7%e8%83%bd aria-label=Anchor>#</a></span></h2><p>我们希望实现以下目标：</p><ul><li>✅ 所有查找、修改操作 O(1)</li><li>✅ 支持百万级订单并发读写，<strong>无锁或原子级别同步</strong></li><li>✅ 高 cache 命中率，最小化内存带宽压力</li><li>✅ 不依赖堆内存，稳定性可控</li></ul><h2 id=四核心优化整数-id--array-映射结构 class="relative group">四、核心优化：整数 ID + array 映射结构 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%9b%9b%e6%a0%b8%e5%bf%83%e4%bc%98%e5%8c%96%e6%95%b4%e6%95%b0-id--array-%e6%98%a0%e5%b0%84%e7%bb%93%e6%9e%84 aria-label=Anchor>#</a></span></h2><p>✅ 使用固定整数 ID 替代字符串：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>uint32_t</span> <span class=n>order_id</span> <span class=o>=</span> <span class=n>map_order_id</span><span class=p>(</span><span class=s>&#34;order-abc-123&#34;</span><span class=p>);</span> <span class=c1>// 一次性转换
</span></span></span></code></pre></div><p>订单池变为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>Order</span><span class=p>,</span> <span class=n>MAX_ORDERS</span><span class=o>&gt;</span> <span class=n>order_table</span><span class=p>;</span>
</span></span></code></pre></div><p>✅ 优化后的 <code>Order</code> 结构体(aligned + 原子字段)：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nf>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>Order</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>order_id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint16_t</span> <span class=n>symbol_id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>price</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>quantity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>filled</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>create_time</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// cold fields:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>double</span> <span class=n>avg_fill_price</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>fill_time</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=五底层原理解析为什么-array--int-id-更快 class="relative group">五、底层原理解析：为什么 array + int ID 更快? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%94%e5%ba%95%e5%b1%82%e5%8e%9f%e7%90%86%e8%a7%a3%e6%9e%90%e4%b8%ba%e4%bb%80%e4%b9%88-array--int-id-%e6%9b%b4%e5%bf%ab aria-label=Anchor>#</a></span></h2><h3 id=-1-内存寻址机制指针偏移 class="relative group">🔹 1. 内存寻址机制(指针偏移) <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#-1-%e5%86%85%e5%ad%98%e5%af%bb%e5%9d%80%e6%9c%ba%e5%88%b6%e6%8c%87%e9%92%88%e5%81%8f%e7%a7%bb aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 以 order_id 为 index,CPU 可直接寻址:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Order</span><span class=o>*</span> <span class=n>ptr</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>order_table</span><span class=p>[</span><span class=n>order_id</span><span class=p>];</span> <span class=c1>// 1 条加法指令完成
</span></span></span></code></pre></div><p>相比字符串：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>hash</span><span class=p>(</span><span class=s>&#34;order-abc-123&#34;</span><span class=p>)</span> <span class=err>→</span> <span class=err>查找哈希桶</span> <span class=err>→</span> <span class=err>拉链或</span> <span class=n>open</span> <span class=n>addressing</span> <span class=err>→</span> <span class=err>迭代比较字符串</span>
</span></span></code></pre></div><p>📌 整数 ID 查找是 <strong>O(1)</strong>，字符串哈希表为 <strong>O(1) 平均，但可能退化为 O(N)</strong>。</p><h3 id=-2-cpu-cache-line-利用与伪共享问题 class="relative group">🔹 2. CPU Cache Line 利用与伪共享问题 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#-2-cpu-cache-line-%e5%88%a9%e7%94%a8%e4%b8%8e%e4%bc%aa%e5%85%b1%e4%ba%ab%e9%97%ae%e9%a2%98 aria-label=Anchor>#</a></span></h3><ul><li>一个 <code>std::array</code> 结构是<strong>连续内存块</strong></li><li>每次加载 cache line 会带来<strong>相邻订单对象</strong></li><li>字段如 <code>status</code>, <code>price</code> 紧密排列，可充分利用预取和 SIMD 指令优化</li></ul><p>而字符串 ID 哈希表对象：</p><ul><li>存在<strong>指针间接层</strong></li><li>对象分布不连续，cache miss 频繁，<strong>cache locality 极差</strong></li></ul><h4 id=伪共享false-sharing问题及解决方案 class="relative group">伪共享(False Sharing)问题及解决方案 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%bc%aa%e5%85%b1%e4%ba%abfalse-sharing%e9%97%ae%e9%a2%98%e5%8f%8a%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 aria-label=Anchor>#</a></span></h4><p>当多个线程同时访问位于同一缓存行的不同变量时，会导致缓存行频繁在核心间同步，降低性能。这就是伪共享问题。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 错误示例：可能导致伪共享
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Order</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>filled</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 其他字段...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>解决方案：使用 <code>alignas(64)</code> 对关键原子字段进行对齐：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 正确示例：避免伪共享
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Order</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 其他非频繁修改的字段...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>filled</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 其他字段...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><h3 id=-3-避免堆分配与内存碎片 class="relative group">🔹 3. 避免堆分配与内存碎片 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#-3-%e9%81%bf%e5%85%8d%e5%a0%86%e5%88%86%e9%85%8d%e4%b8%8e%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87 aria-label=Anchor>#</a></span></h3><ul><li><code>std::array</code> 是<strong>完全静态内存结构</strong>，分配时确定大小</li><li>无需 malloc/free，无 GC 压力，内存访问预测可控</li><li><code>unordered_map</code> 会频繁 malloc，rehash 会造成系统抖动</li></ul><h3 id=-4-内存序memory-ordering选择与原子操作 class="relative group">🔹 4. 内存序(Memory Ordering)选择与原子操作 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#-4-%e5%86%85%e5%ad%98%e5%ba%8fmemory-ordering%e9%80%89%e6%8b%a9%e4%b8%8e%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c aria-label=Anchor>#</a></span></h3><p>原子操作的内存序对性能影响显著。在高频交易系统中，正确选择内存序可以大幅提升性能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 高性能原子操作示例
</span></span></span><span class=line><span class=cl><span class=c1>// 来自 TradeTypes.h
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nf>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>Order</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 获取状态，使用acquire语义保证读取最新值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>OrderStatus</span> <span class=n>getStatus</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>status</span><span class=p>.</span><span class=n>load</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>memory_order_acquire</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 设置状态，使用release语义保证其他线程能看到变化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=n>setStatus</span><span class=p>(</span><span class=n>OrderStatus</span> <span class=n>newStatus</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span><span class=p>.</span><span class=n>store</span><span class=p>(</span><span class=n>newStatus</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>memory_order_release</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=-5-整数id分配和回收机制 class="relative group">🔹 5. 整数ID分配和回收机制 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#-5-%e6%95%b4%e6%95%b0id%e5%88%86%e9%85%8d%e5%92%8c%e5%9b%9e%e6%94%b6%e6%9c%ba%e5%88%b6 aria-label=Anchor>#</a></span></h3><p>高频交易系统中，整数ID的管理是关键问题。需要解决：</p><ol><li><strong>ID唯一性保证</strong>：使用原子计数器生成唯一ID</li><li><strong>ID回收机制</strong>：使用位图或空闲链表管理可重用ID</li><li><strong>ID与外部字符串映射</strong>：维护高效的双向映射表</li></ol><h2 id=六性能测试数据 class="relative group">六、性能测试数据 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%85%ad%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae aria-label=Anchor>#</a></span></h2><p>以下是在实际高频交易系统中测试的性能数据（基准测试结果）：</p><table><thead><tr><th>操作</th><th>字符串ID + unordered_map</th><th>整数ID + array</th><th>性能提升</th></tr></thead><tbody><tr><td>查找订单</td><td>245 ns</td><td>12 ns</td><td>20.4倍</td></tr><tr><td>更新状态</td><td>310 ns</td><td>28 ns</td><td>11.1倍</td></tr><tr><td>并发读写(8线程)</td><td>1450 ns</td><td>42 ns</td><td>34.5倍</td></tr><tr><td>L1 缓存命中率</td><td>72%</td><td>96%</td><td>1.33倍</td></tr><tr><td>内存带宽使用</td><td>3.8 GB/s</td><td>0.9 GB/s</td><td>4.2倍减少</td></tr></tbody></table><p>测试环境：Intel Xeon Gold 6248R, 3.0GHz, 24核心, 48线程, 36MB L3缓存</p><h2 id=七关键组件优化示例 class="relative group">七、关键组件优化示例 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%b8%83%e5%85%b3%e9%94%ae%e7%bb%84%e4%bb%b6%e4%bc%98%e5%8c%96%e7%a4%ba%e4%be%8b aria-label=Anchor>#</a></span></h2><h3 id=1-orderbook实现使用了tbbconcurrent_map这不是最优的选择 class="relative group">1. OrderBook实现使用了<code>tbb::concurrent_map</code>，这不是最优的选择： <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-orderbook%e5%ae%9e%e7%8e%b0%e4%bd%bf%e7%94%a8%e4%ba%86tbbconcurrent_map%e8%bf%99%e4%b8%8d%e6%98%af%e6%9c%80%e4%bc%98%e7%9a%84%e9%80%89%e6%8b%a9 aria-label=Anchor>#</a></span></h3><p><strong>原始版本</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 使用树结构的并发容器，性能次优
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>LockFreeOrderBook</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>symbol_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>tbb</span><span class=o>::</span><span class=n>concurrent_map</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>PriceLevel</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>greater</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;</span> <span class=n>bids_</span><span class=p>;</span>  <span class=c1>// 买盘降序
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>tbb</span><span class=o>::</span><span class=n>concurrent_map</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>PriceLevel</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>less</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;</span> <span class=n>asks_</span><span class=p>;</span>     <span class=c1>// 卖盘升序
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p><strong>优化版本</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 使用数组+整数索引的O(1)访问结构
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>OptimizedOrderBook</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>symbol_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 使用固定大小数组和价格映射实现O(1)查询
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=k>constexpr</span> <span class=n>size_t</span> <span class=n>PRICE_LEVELS</span> <span class=o>=</span> <span class=mi>10000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>double</span> <span class=n>MIN_PRICE</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>double</span> <span class=n>PRICE_STEP</span> <span class=o>=</span> <span class=mf>0.01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 价格离散化映射函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>inline</span> <span class=n>size_t</span> <span class=nf>priceToIndex</span><span class=p>(</span><span class=kt>double</span> <span class=n>price</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>size_t</span><span class=o>&gt;</span><span class=p>((</span><span class=n>price</span> <span class=o>-</span> <span class=n>MIN_PRICE</span><span class=p>)</span> <span class=o>/</span> <span class=n>PRICE_STEP</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 买卖盘使用对齐的连续数组
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>PriceLevel</span><span class=p>,</span> <span class=n>PRICE_LEVELS</span><span class=o>&gt;</span> <span class=n>bids_</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>PriceLevel</span><span class=p>,</span> <span class=n>PRICE_LEVELS</span><span class=o>&gt;</span> <span class=n>asks_</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 使用原子变量跟踪最佳价位，避免全表扫描
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>size_t</span><span class=o>&gt;</span> <span class=n>best_bid_idx_</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>size_t</span><span class=o>&gt;</span> <span class=n>best_ask_idx_</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p><strong>优化理由</strong>：</p><ul><li>将O(log n)的树查找替换为O(1)的数组索引访问</li><li>消除动态内存分配，避免GC延迟</li><li>使用连续内存布局提高缓存命中率</li><li>通过缓存行对齐防止伪共享</li></ul><h3 id=2-ringbuffer优化 class="relative group">2. RingBuffer优化 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-ringbuffer%e4%bc%98%e5%8c%96 aria-label=Anchor>#</a></span></h3><p><strong>原始版本</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>SIZE</span> <span class=o>=</span> <span class=mi>1024</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RingBuffer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>SIZE</span><span class=o>&gt;</span> <span class=n>buffer_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>size_t</span><span class=o>&gt;</span> <span class=n>read_index_</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>size_t</span><span class=o>&gt;</span> <span class=n>write_index_</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>push</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>size_t</span> <span class=n>current_write</span> <span class=o>=</span> <span class=n>write_index_</span><span class=p>.</span><span class=n>load</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>memory_order_relaxed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>size_t</span> <span class=n>next_write</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_write</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>SIZE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p><strong>优化版本</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>SIZE</span> <span class=o>=</span> <span class=mi>1024</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OptimizedRingBuffer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static_assert</span><span class=p>((</span><span class=n>SIZE</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>SIZE</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;SIZE must be power of 2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>constexpr</span> <span class=n>size_t</span> <span class=n>MASK</span> <span class=o>=</span> <span class=n>SIZE</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 使用缓存行对齐防止伪共享
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>SIZE</span><span class=o>&gt;</span> <span class=n>buffer_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>size_t</span><span class=o>&gt;</span> <span class=n>write_index_</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span> <span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=n>size_t</span><span class=o>&gt;</span> <span class=n>read_index_</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>push</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>item</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=n>size_t</span> <span class=n>current</span> <span class=o>=</span> <span class=n>write_index_</span><span class=p>.</span><span class=n>load</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>memory_order_relaxed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=n>size_t</span> <span class=n>next</span> <span class=o>=</span> <span class=p>(</span><span class=n>current</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=n>MASK</span><span class=p>;</span> <span class=c1>// 使用位掩码代替%
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 批量操作，减少原子操作次数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>Iterator</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>size_t</span> <span class=n>push_batch</span><span class=p>(</span><span class=n>Iterator</span> <span class=n>begin</span><span class=p>,</span> <span class=n>Iterator</span> <span class=n>end</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 一次性读取索引，减少原子操作
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>const</span> <span class=n>size_t</span> <span class=n>read_idx</span> <span class=o>=</span> <span class=n>read_index_</span><span class=p>.</span><span class=n>load</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>memory_order_acquire</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>size_t</span> <span class=n>write_idx</span> <span class=o>=</span> <span class=n>write_index_</span><span class=p>.</span><span class=n>load</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>memory_order_relaxed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 批量写入
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>优化理由</strong>：</p><ul><li>使用位掩码(&)替代取模运算(%)，提高性能</li><li>添加缓存行对齐，防止伪共享</li><li>实现批量操作接口，减少原子操作次数</li><li>确保SIZE为2的幂，优化内存对齐和位操作</li></ul><h2 id=八numa架构下的内存访问优化 class="relative group">八、NUMA架构下的内存访问优化 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%85%abnuma%e6%9e%b6%e6%9e%84%e4%b8%8b%e7%9a%84%e5%86%85%e5%ad%98%e8%ae%bf%e9%97%ae%e4%bc%98%e5%8c%96 aria-label=Anchor>#</a></span></h2><p>在多处理器NUMA架构下，内存访问延迟不均匀，需要考虑节点亲和性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;numa.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// 为每个NUMA节点创建独立的订单池
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>Order</span><span class=p>,</span> <span class=n>MAX_ORDERS_PER_NODE</span><span class=o>&gt;&gt;</span> <span class=n>node_order_tables</span><span class=p>(</span><span class=n>numa_num_configured_nodes</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 初始化时将内存绑定到对应NUMA节点
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>initialize_order_tables</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>node</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>node</span> <span class=o>&lt;</span> <span class=n>numa_num_configured_nodes</span><span class=p>();</span> <span class=o>++</span><span class=n>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>numa_set_preferred</span><span class=p>(</span><span class=n>node</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>node_order_tables</span><span class=p>[</span><span class=n>node</span><span class=p>]</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>Order</span><span class=p>,</span> <span class=n>MAX_ORDERS_PER_NODE</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 根据线程所在NUMA节点选择对应的订单池
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Order</span><span class=o>*</span> <span class=nf>get_order</span><span class=p>(</span><span class=kt>uint32_t</span> <span class=n>order_id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>node</span> <span class=o>=</span> <span class=n>numa_node_of_cpu</span><span class=p>(</span><span class=n>sched_getcpu</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=n>node_order_tables</span><span class=p>[</span><span class=n>node</span><span class=p>][</span><span class=n>order_id</span> <span class=o>%</span> <span class=n>MAX_ORDERS_PER_NODE</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=九最终方案优势对比总结 class="relative group">九、最终方案优势对比总结 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%b9%9d%e6%9c%80%e7%bb%88%e6%96%b9%e6%a1%88%e4%bc%98%e5%8a%bf%e5%af%b9%e6%af%94%e6%80%bb%e7%bb%93 aria-label=Anchor>#</a></span></h2><table><thead><tr><th>方案</th><th>查找复杂度</th><th>写入复杂度</th><th>内存分配</th><th>cache 命中</th><th>并发性能</th><th>HFT推荐</th></tr></thead><tbody><tr><td><code>std::unordered_map</code></td><td>O(1) 均值</td><td>O(1)-O(N)</td><td>堆内存</td><td>差</td><td>差</td><td>❌</td></tr><tr><td><code>tbb::concurrent_unordered_map</code></td><td>O(1) 均值</td><td>O(1)-O(N)</td><td>堆内存</td><td>一般</td><td>中</td><td>⚠️</td></tr><tr><td><code>std::array</code> + 整数 ID</td><td>O(1)</td><td>O(1)</td><td>栈或静态内存</td><td>最好</td><td>最优</td><td>✅✅✅</td></tr></tbody></table><h2 id=九结语高频系统的设计哲学 class="relative group">九、结语：高频系统的设计哲学 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%b9%9d%e7%bb%93%e8%af%ad%e9%ab%98%e9%a2%91%e7%b3%bb%e7%bb%9f%e7%9a%84%e8%ae%be%e8%ae%a1%e5%93%b2%e5%ad%a6 aria-label=Anchor>#</a></span></h2><p>在 HFT 系统中，<strong>&ldquo;每一次内存访问都是交易机会&rdquo;</strong>。 我们设计结构体和访问路径时，必须以:</p><ul><li>✨ 常数级时间复杂度</li><li>✨ cache 友好性</li><li>✨ 极低分支、最少系统调用</li><li>✨ 可预测的执行路径(无堆、无锁、无阻塞)</li></ul><p>为第一原则。</p><p>使用 <code>std::array + 原子字段 + 整数 ID</code>，我们不仅显著减少了延迟和不确定性，也构建了一个真正符合高频系统特性的数据底座。</p></div></section><footer class="max-w-4xl pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=360 height=360 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt="Wenjun Yu" loading=lazy decoding=async src=/img/author.jpg></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Wenjun Yu</div><div class="text-sm text-neutral-700 dark:text-neutral-400">A little bit about you</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/code-agree target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://x.com/flight_from_ target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:lineyua66@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></div></div></div></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;quote=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Share on Facebook" aria-label="Share on Facebook" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://x.com/intent/tweet/?url=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;text=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Post on X" aria-label="Post on X" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://tootpick.org/#text=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Toot on Mastodon" aria-label="Toot on Mastodon" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;description=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Pin on Pinterest" aria-label="Pin on Pinterest" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;resubmit=true&amp;title=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Submit to Reddit" aria-label="Submit to Reddit" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;title=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Share on LinkedIn" aria-label="Share on LinkedIn" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;subject=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Send via email" aria-label="Send via email" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://telegram.me/share/url?text=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;url=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Share on Telegram" aria-label="Share on Telegram" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://line.me/R/share?text=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98" title="Share on LINE" aria-label="Share on LINE" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M311 196.8v81.3c0 2.1-1.6 3.7-3.7 3.7h-13c-1.3.0-2.4-.7-3-1.5L254 230v48.2c0 2.1-1.6 3.7-3.7 3.7h-13c-2.1.0-3.7-1.6-3.7-3.7V196.9c0-2.1 1.6-3.7 3.7-3.7h12.9c1.1.0 2.4.6 3 1.6l37.3 50.3V196.9c0-2.1 1.6-3.7 3.7-3.7h13c2.1-.1 3.8 1.6 3.8 3.5zm-93.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 2.1 1.6 3.7 3.7 3.7h13c2.1.0 3.7-1.6 3.7-3.7V196.8c0-1.9-1.6-3.7-3.7-3.7zm-31.4 68.1H150.3V196.8c0-2.1-1.6-3.7-3.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 1 .3 1.8 1 2.5.7.6 1.5 1 2.5 1h52.2c2.1.0 3.7-1.6 3.7-3.7v-13c0-1.9-1.6-3.7-3.5-3.7zm193.7-68.1H327.3c-1.9.0-3.7 1.6-3.7 3.7v81.3c0 1.9 1.6 3.7 3.7 3.7h52.2c2.1.0 3.7-1.6 3.7-3.7V265c0-2.1-1.6-3.7-3.7-3.7H344V247.7h35.5c2.1.0 3.7-1.6 3.7-3.7V230.9c0-2.1-1.6-3.7-3.7-3.7H344V213.5h35.5c2.1.0 3.7-1.6 3.7-3.7v-13c-.1-1.9-1.7-3.7-3.7-3.7zM512 93.4v326c-.1 51.2-42.1 92.7-93.4 92.6H92.6C41.4 511.9-.1 469.8.0 418.6V92.6C.1 41.4 42.2-.1 93.4.0h326c51.2.1 92.7 42.1 92.6 93.4zM441.6 233.5c0-83.4-83.7-151.3-186.4-151.3S68.8 150.1 68.8 233.5c0 74.7 66.3 137.4 155.9 149.3 21.8 4.7 19.3 12.7 14.4 42.1-.8 4.7-3.8 18.4 16.1 10.1s107.3-63.2 146.5-108.2c27-29.7 39.9-59.8 39.9-93.1z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://service.weibo.com/share/share.php?url=https://code-agree.github.io/blog/2025-06-19-how_to_design_order_inlocalmemory/&amp;appkey=&amp;title=%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e4%b8%ad%e7%9a%84%e8%ae%a2%e5%8d%95%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%ae%9e%e6%88%98&amp;pic=&amp;ralateUid=&amp;lang" title="Share on Weibo" aria-label="Share on Weibo" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><path fill="currentcolor" d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7.0 395.3.0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"/></svg></span></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/blog/2025-06-19-compile_perf/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">编译器优化级别技术解析</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-06-19 04:00:00 +0800 +0800">19 June 2025</time>
</span></span></a></span><span><a class="group flex text-right" href=/blog/2025-06-20-14-lockfreeeventbus_perf_case/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">LockFreeEventBus技术剖析：工作机制与性能瓶颈分析</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-06-20 14:38:58 +0800 +0800">20 June 2025</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script src=https://giscus.app/client.js data-repo=code-agree/code-agree.github.io data-repo-id=R_kgDOK-ejEw data-category=Announcements data-category-id=DIC_kwDOK-ejE84ChYPz data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Wenjun Yu</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm sm:p-6 md:p-[10vh] lg:p-[12vh] dark:bg-neutral-900/50" data-url=https://code-agree.github.io/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>