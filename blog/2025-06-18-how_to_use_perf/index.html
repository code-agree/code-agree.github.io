<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><title>Perf Report 分析完全指南 - 高频交易系统性能优化 &#183; Yu's Space</title>
<meta name=title content="Perf Report 分析完全指南 - 高频交易系统性能优化 &#183; Yu's Space"><script type=text/javascript src=/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.082522985b9d96110f0c3ccb5a94a702d82e62aac41510fb092b696d287ac5aa.css integrity="sha256-CCUimFudlhEPDDzLWpSnAtguYqrEFRD7CStpbSh6xao="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.224115d95321e7008c42d7cef4967237dae3442b508de128eb5ba1119c977750.js integrity="sha256-IkEV2VMh5wCMQtfO9JZyN9rjRCtQjeEo61uhEZyXd1A=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      
        目录 # 高频交易系统性能优化思路 Perf 基础知识 perf record 命令参数详解 采样事件类型 Perf 能分析的关键指标 Perf Report 输出解析 列含义详解 分析方法论 高级分析技巧 实际优化流程 关键指标解读 使用Perf分析内存性能指标 高频交易系统案例分析 高频交易系统性能优化思路 #在高频交易系统中，微秒级的延迟差异可能直接影响交易策略的有效性和盈利能力。使用perf进行性能分析是优化高频交易系统的关键步骤。以下是一个系统化的优化思路：
1. 性能基准建立 #关键指标:
端到端延迟: 从行情接收到下单的完整路径时间 吞吐量: 每秒处理的订单/行情数量 尾延迟: 95/99/99.9百分位延迟 CPU利用率: 核心交易路径的CPU使用情况 # 建立基准性能数据 perf stat -e cycles,instructions,cache-references,cache-misses,branches,branch-misses -a -g ./strategyTrade 命令参数解释:
cycles: CPU周期数，用于测量程序执行所需的处理器周期总量 instructions: 执行的指令数，结合cycles可计算IPC(每周期指令数)，评估CPU利用效率 cache-references: 缓存访问次数，表示程序对CPU缓存的总访问量 cache-misses: 缓存未命中次数，高缓存未命中率会导致处理器等待内存，增加延迟 branches: 分支指令执行次数，反映程序中条件判断和跳转的频率 branch-misses: 分支预测失败次数，高失败率会导致流水线刷新，降低CPU效率 -a: 收集所有CPU核心的数据，全系统视图 -g: 收集调用图信息，便于分析函数调用关系 输出示例及解读:
Performance counter stats for './strategyTrade': 12,345,678,901 cycles # 总CPU周期数 24,680,046,512 instructions # 总指令数，指令/周期比约为2.
      
    "><link rel=canonical href=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Perf Report 分析完全指南 - 高频交易系统性能优化"><meta property="og:description" content="目录 # 高频交易系统性能优化思路 Perf 基础知识 perf record 命令参数详解 采样事件类型 Perf 能分析的关键指标 Perf Report 输出解析 列含义详解 分析方法论 高级分析技巧 实际优化流程 关键指标解读 使用Perf分析内存性能指标 高频交易系统案例分析 高频交易系统性能优化思路 #在高频交易系统中，微秒级的延迟差异可能直接影响交易策略的有效性和盈利能力。使用perf进行性能分析是优化高频交易系统的关键步骤。以下是一个系统化的优化思路：
1. 性能基准建立 #关键指标:
端到端延迟: 从行情接收到下单的完整路径时间 吞吐量: 每秒处理的订单/行情数量 尾延迟: 95/99/99.9百分位延迟 CPU利用率: 核心交易路径的CPU使用情况 # 建立基准性能数据 perf stat -e cycles,instructions,cache-references,cache-misses,branches,branch-misses -a -g ./strategyTrade 命令参数解释:
cycles: CPU周期数，用于测量程序执行所需的处理器周期总量 instructions: 执行的指令数，结合cycles可计算IPC(每周期指令数)，评估CPU利用效率 cache-references: 缓存访问次数，表示程序对CPU缓存的总访问量 cache-misses: 缓存未命中次数，高缓存未命中率会导致处理器等待内存，增加延迟 branches: 分支指令执行次数，反映程序中条件判断和跳转的频率 branch-misses: 分支预测失败次数，高失败率会导致流水线刷新，降低CPU效率 -a: 收集所有CPU核心的数据，全系统视图 -g: 收集调用图信息，便于分析函数调用关系 输出示例及解读:
Performance counter stats for './strategyTrade': 12,345,678,901 cycles # 总CPU周期数 24,680,046,512 instructions # 总指令数，指令/周期比约为2."><meta property="og:type" content="article"><meta property="og:url" content="https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-06-18T03:03:07+08:00"><meta property="article:modified_time" content="2025-06-18T03:03:07+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Perf Report 分析完全指南 - 高频交易系统性能优化"><meta name=twitter:description content="目录 # 高频交易系统性能优化思路 Perf 基础知识 perf record 命令参数详解 采样事件类型 Perf 能分析的关键指标 Perf Report 输出解析 列含义详解 分析方法论 高级分析技巧 实际优化流程 关键指标解读 使用Perf分析内存性能指标 高频交易系统案例分析 高频交易系统性能优化思路 #在高频交易系统中，微秒级的延迟差异可能直接影响交易策略的有效性和盈利能力。使用perf进行性能分析是优化高频交易系统的关键步骤。以下是一个系统化的优化思路：
1. 性能基准建立 #关键指标:
端到端延迟: 从行情接收到下单的完整路径时间 吞吐量: 每秒处理的订单/行情数量 尾延迟: 95/99/99.9百分位延迟 CPU利用率: 核心交易路径的CPU使用情况 # 建立基准性能数据 perf stat -e cycles,instructions,cache-references,cache-misses,branches,branch-misses -a -g ./strategyTrade 命令参数解释:
cycles: CPU周期数，用于测量程序执行所需的处理器周期总量 instructions: 执行的指令数，结合cycles可计算IPC(每周期指令数)，评估CPU利用效率 cache-references: 缓存访问次数，表示程序对CPU缓存的总访问量 cache-misses: 缓存未命中次数，高缓存未命中率会导致处理器等待内存，增加延迟 branches: 分支指令执行次数，反映程序中条件判断和跳转的频率 branch-misses: 分支预测失败次数，高失败率会导致流水线刷新，降低CPU效率 -a: 收集所有CPU核心的数据，全系统视图 -g: 收集调用图信息，便于分析函数调用关系 输出示例及解读:
Performance counter stats for './strategyTrade': 12,345,678,901 cycles # 总CPU周期数 24,680,046,512 instructions # 总指令数，指令/周期比约为2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"Perf Report 分析完全指南 - 高频交易系统性能优化","headline":"Perf Report 分析完全指南 - 高频交易系统性能优化","abstract":"目录 # 高频交易系统性能优化思路 Perf 基础知识 perf record 命令参数详解 采样事件类型 Perf 能分析的关键指标 Perf Report 输出解析 列含义详解 分析方法论 高级分析技巧 实际优化流程 关键指标解读 使用Perf分析内存性能指标 高频交易系统案例分析 高频交易系统性能优化思路 #在高频交易系统中，微秒级的延迟差异可能直接影响交易策略的有效性和盈利能力。使用perf进行性能分析是优化高频交易系统的关键步骤。以下是一个系统化的优化思路：\n1. 性能基准建立 #关键指标:\n端到端延迟: 从行情接收到下单的完整路径时间 吞吐量: 每秒处理的订单\/行情数量 尾延迟: 95\/99\/99.9百分位延迟 CPU利用率: 核心交易路径的CPU使用情况 # 建立基准性能数据 perf stat -e cycles,instructions,cache-references,cache-misses,branches,branch-misses -a -g .\/strategyTrade 命令参数解释:\ncycles: CPU周期数，用于测量程序执行所需的处理器周期总量 instructions: 执行的指令数，结合cycles可计算IPC(每周期指令数)，评估CPU利用效率 cache-references: 缓存访问次数，表示程序对CPU缓存的总访问量 cache-misses: 缓存未命中次数，高缓存未命中率会导致处理器等待内存，增加延迟 branches: 分支指令执行次数，反映程序中条件判断和跳转的频率 branch-misses: 分支预测失败次数，高失败率会导致流水线刷新，降低CPU效率 -a: 收集所有CPU核心的数据，全系统视图 -g: 收集调用图信息，便于分析函数调用关系 输出示例及解读:\nPerformance counter stats for \u0026#39;.\/strategyTrade\u0026#39;: 12,345,678,901 cycles # 总CPU周期数 24,680,046,512 instructions # 总指令数，指令\/周期比约为2.","inLanguage":"en","url":"https:\/\/code-agree.github.io\/blog\/2025-06-18-how_to_use_perf\/","author":{"@type":"Person","name":"Wenjun Yu"},"copyrightYear":"2025","dateCreated":"2025-06-18T03:03:07\u002b08:00","datePublished":"2025-06-18T03:03:07\u002b08:00","dateModified":"2025-06-18T03:03:07\u002b08:00","mainEntityOfPage":"true","wordCount":"1390"}</script><meta name=author content="Wenjun Yu"><link href=https://github.com/code-agree rel=me><link href=https://x.com/flight_from_ rel=me><link href=mailto:lineyua66@gmail.com rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Yu&rsquo;s Space</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/blog/ title=Blog><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/projects/ title=Projects><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/tags/ title=Tags><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/about/ title="About Me"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=search-button-1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-4xl><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Perf Report 分析完全指南 - 高频交易系统性能优化</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2025-06-18 03:03:07 +0800 +0800">18 June 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="min-h-0 min-w-0 max-w-4xl grow"><h2 id=目录 class="relative group">目录 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%9b%ae%e5%bd%95 aria-label=Anchor>#</a></span></h2><ol><li><a href=#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e6%80%9d%e8%b7%af>高频交易系统性能优化思路</a></li><li><a href=#perf-%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86>Perf 基础知识</a><ul><li><a href=#1-perf-record-%e5%91%bd%e4%bb%a4%e5%8f%82%e6%95%b0%e8%af%a6%e8%a7%a3>perf record 命令参数详解</a></li><li><a href=#2-%e9%87%87%e6%a0%b7%e4%ba%8b%e4%bb%b6%e7%b1%bb%e5%9e%8b>采样事件类型</a></li><li><a href=#3-perf-%e8%83%bd%e5%88%86%e6%9e%90%e7%9a%84%e5%85%b3%e9%94%ae%e6%8c%87%e6%a0%87>Perf 能分析的关键指标</a></li></ul></li><li><a href=#perf-report-%e8%be%93%e5%87%ba%e8%a7%a3%e6%9e%90>Perf Report 输出解析</a><ul><li><a href=#%e5%88%97%e5%90%ab%e4%b9%89%e8%af%a6%e8%a7%a3>列含义详解</a></li><li><a href=#%e5%88%86%e6%9e%90%e6%96%b9%e6%b3%95%e8%ae%ba>分析方法论</a></li></ul></li><li><a href=#%e9%ab%98%e7%ba%a7%e5%88%86%e6%9e%90%e6%8a%80%e5%b7%a7>高级分析技巧</a></li><li><a href=#%e5%ae%9e%e9%99%85%e4%bc%98%e5%8c%96%e6%b5%81%e7%a8%8b>实际优化流程</a></li><li><a href=#%e5%85%b3%e9%94%ae%e6%8c%87%e6%a0%87%e8%a7%a3%e8%af%bb>关键指标解读</a></li><li><a href=#%e4%bd%bf%e7%94%a8perf%e5%88%86%e6%9e%90%e5%86%85%e5%ad%98%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87>使用Perf分析内存性能指标</a></li><li><a href=#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90>高频交易系统案例分析</a></li></ol><h2 id=高频交易系统性能优化思路 class="relative group">高频交易系统性能优化思路 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e6%80%9d%e8%b7%af aria-label=Anchor>#</a></span></h2><p>在高频交易系统中，微秒级的延迟差异可能直接影响交易策略的有效性和盈利能力。使用perf进行性能分析是优化高频交易系统的关键步骤。以下是一个系统化的优化思路：</p><h3 id=1-性能基准建立 class="relative group">1. 性能基准建立 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e6%80%a7%e8%83%bd%e5%9f%ba%e5%87%86%e5%bb%ba%e7%ab%8b aria-label=Anchor>#</a></span></h3><p><strong>关键指标</strong>:</p><ul><li><strong>端到端延迟</strong>: 从行情接收到下单的完整路径时间</li><li><strong>吞吐量</strong>: 每秒处理的订单/行情数量</li><li><strong>尾延迟</strong>: 95/99/99.9百分位延迟</li><li><strong>CPU利用率</strong>: 核心交易路径的CPU使用情况</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 建立基准性能数据</span>
</span></span><span class=line><span class=cl>perf stat -e cycles,instructions,cache-references,cache-misses,branches,branch-misses -a -g ./strategyTrade
</span></span></code></pre></div><p><strong>命令参数解释</strong>:</p><ul><li><code>cycles</code>: CPU周期数，用于测量程序执行所需的处理器周期总量</li><li><code>instructions</code>: 执行的指令数，结合cycles可计算IPC(每周期指令数)，评估CPU利用效率</li><li><code>cache-references</code>: 缓存访问次数，表示程序对CPU缓存的总访问量</li><li><code>cache-misses</code>: 缓存未命中次数，高缓存未命中率会导致处理器等待内存，增加延迟</li><li><code>branches</code>: 分支指令执行次数，反映程序中条件判断和跳转的频率</li><li><code>branch-misses</code>: 分支预测失败次数，高失败率会导致流水线刷新，降低CPU效率</li><li><code>-a</code>: 收集所有CPU核心的数据，全系统视图</li><li><code>-g</code>: 收集调用图信息，便于分析函数调用关系</li></ul><p><strong>输出示例及解读</strong>:</p><pre tabindex=0><code> Performance counter stats for &#39;./strategyTrade&#39;:

     12,345,678,901      cycles                    # 总CPU周期数
     24,680,046,512      instructions              # 总指令数，指令/周期比约为2.0，表示良好的流水线效率
        234,567,890      cache-references          # 缓存访问总次数
         23,456,789      cache-misses              # 约10%的缓存未命中率，理想值应&lt;5%
      1,234,567,890      branches                  # 分支指令数
         98,765,432      branch-misses             # 约8%的分支预测失败率，理想值应&lt;5%

      10.002345678 seconds time elapsed            # 程序总运行时间
</code></pre><p>这些基准数据为后续优化提供了量化参考点，任何优化措施都应该通过再次测量这些指标来验证其有效性。</p><h3 id=2-热点路径识别 class="relative group">2. 热点路径识别 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e7%83%ad%e7%82%b9%e8%b7%af%e5%be%84%e8%af%86%e5%88%ab aria-label=Anchor>#</a></span></h3><p>高频交易系统中最关键的路径通常是：</p><ul><li>行情数据解析</li><li>策略计算</li><li>订单生成与发送</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 识别关键路径热点</span>
</span></span><span class=line><span class=cl>perf record -F <span class=m>9999</span> -a -g ./strategyTrade
</span></span><span class=line><span class=cl>perf report --sort<span class=o>=</span>dso,symbol
</span></span></code></pre></div><h3 id=3-系统调用与上下文切换分析 class="relative group">3. 系统调用与上下文切换分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%8a%e4%b8%8b%e6%96%87%e5%88%87%e6%8d%a2%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><p>高频交易系统应尽量减少系统调用和上下文切换，这些是低延迟的天敌。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分析系统调用</span>
</span></span><span class=line><span class=cl>perf record -e syscalls:sys_enter_* -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>perf report
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析上下文切换</span>
</span></span><span class=line><span class=cl>perf record -e context-switches -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>perf report
</span></span></code></pre></div><h3 id=4-内存访问模式优化 class="relative group">4. 内存访问模式优化 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%e5%86%85%e5%ad%98%e8%ae%bf%e9%97%ae%e6%a8%a1%e5%bc%8f%e4%bc%98%e5%8c%96 aria-label=Anchor>#</a></span></h3><p>缓存未命中是高频交易系统性能下降的主要原因之一。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分析缓存性能</span>
</span></span><span class=line><span class=cl>perf record -e cache-misses,cache-references -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>perf report
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 详细分析内存访问</span>
</span></span><span class=line><span class=cl>perf mem record -a ./strategyTrade
</span></span><span class=line><span class=cl>perf mem report
</span></span></code></pre></div><h3 id=5-锁竞争与线程协作 class="relative group">5. 锁竞争与线程协作 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%e9%94%81%e7%ab%9e%e4%ba%89%e4%b8%8e%e7%ba%bf%e7%a8%8b%e5%8d%8f%e4%bd%9c aria-label=Anchor>#</a></span></h3><p>多线程高频交易系统中，线程间的锁竞争可能导致严重的性能问题。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分析锁竞争</span>
</span></span><span class=line><span class=cl>perf record -e lock:lock_acquire -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>perf report
</span></span></code></pre></div><h3 id=6-网络io性能 class="relative group">6. 网络I/O性能 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-%e7%bd%91%e7%bb%9cio%e6%80%a7%e8%83%bd aria-label=Anchor>#</a></span></h3><p>高频交易系统通常需要高效的网络I/O处理。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分析网络相关系统调用</span>
</span></span><span class=line><span class=cl>perf record -e syscalls:sys_enter_recvfrom,syscalls:sys_enter_sendto -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>perf report
</span></span></code></pre></div><h3 id=7-优化验证与迭代 class="relative group">7. 优化验证与迭代 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-%e4%bc%98%e5%8c%96%e9%aa%8c%e8%af%81%e4%b8%8e%e8%bf%ad%e4%bb%a3 aria-label=Anchor>#</a></span></h3><p>每次优化后，需要重新测量关键指标，确保优化有效。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 优化前后对比</span>
</span></span><span class=line><span class=cl>perf diff perf.data.before perf.data.after
</span></span></code></pre></div><h2 id=perf-基础知识 class="relative group">Perf 基础知识 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#perf-%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86 aria-label=Anchor>#</a></span></h2><h3 id=1-perf-record-命令参数详解 class="relative group">1. perf record 命令参数详解 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-perf-record-%e5%91%bd%e4%bb%a4%e5%8f%82%e6%95%b0%e8%af%a6%e8%a7%a3 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>perf record -a -g sleep <span class=m>30</span>
</span></span></code></pre></div><blockquote><p>默认采集事件是cpu-clock,可以使用-e $enevttype，指定采集的事件
使用perf report后，
在perf report的默认交互界面中：
每行前面的+号表示该条目可以展开
按下Enter键可以展开当前选中的条目，显示其调用关系
使用方向键可以在不同条目间导航
按下e键可以展开所有调用栈</p></blockquote><p><strong>参数解释</strong>:</p><ul><li><code>-a</code>: 系统范围内收集数据（all CPUs），监控所有CPU核心</li><li><code>-g</code>: 启用调用图记录，记录函数调用栈信息</li><li><code>-F &lt;freq></code>: 设置采样频率，如<code>-F 99</code>表示每秒99次</li><li><code>-p &lt;pid></code>: 指定进程ID进行分析</li><li><code>-e &lt;event></code>: 指定要采样的事件类型</li><li><code>sleep 30</code>: 采样持续30秒</li></ul><p><strong>常用组合</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分析特定进程</span>
</span></span><span class=line><span class=cl>perf record -g -p <span class=m>1234</span> sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 高频采样</span>
</span></span><span class=line><span class=cl>perf record -F <span class=m>999</span> -ag sleep <span class=m>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析特定程序</span>
</span></span><span class=line><span class=cl>perf record -g ./your_program
</span></span></code></pre></div><h3 id=2-采样事件类型 class="relative group">2. 采样事件类型 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e9%87%87%e6%a0%b7%e4%ba%8b%e4%bb%b6%e7%b1%bb%e5%9e%8b aria-label=Anchor>#</a></span></h3><p>perf可以采样多种事件类型，<code>cpu-clock:pppH</code>是其中一种。</p><p><strong>常见事件类型</strong>:</p><ul><li><code>cpu-clock</code>: CPU时钟周期，最常用的性能计数器</li><li><code>cycles</code>: CPU周期数</li><li><code>instructions</code>: 指令执行数</li><li><code>cache-misses</code>: 缓存未命中次数</li><li><code>branch-misses</code>: 分支预测失败次数</li><li><code>page-faults</code>: 页面错误次数</li><li><code>context-switches</code>: 上下文切换次数</li><li><code>cpu-migrations</code>: CPU迁移次数</li><li><code>L1-dcache-load-misses</code>: L1数据缓存加载未命中</li><li><code>LLC-load-misses</code>: 最后级缓存加载未命中</li></ul><p><strong>查看可用事件</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 列出所有可用事件</span>
</span></span><span class=line><span class=cl>perf list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按类别查看</span>
</span></span><span class=line><span class=cl>perf list <span class=s1>&#39;cache&#39;</span>  <span class=c1># 只看缓存相关事件</span>
</span></span></code></pre></div><h3 id=3-perf-能分析的关键指标 class="relative group">3. Perf 能分析的关键指标 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-perf-%e8%83%bd%e5%88%86%e6%9e%90%e7%9a%84%e5%85%b3%e9%94%ae%e6%8c%87%e6%a0%87 aria-label=Anchor>#</a></span></h3><p><strong>CPU性能指标</strong>:</p><ul><li><strong>CPU使用率</strong>: 各进程/线程的CPU时间分布</li><li><strong>热点函数</strong>: 消耗CPU时间最多的函数</li><li><strong>调用栈分析</strong>: 函数调用链及其开销</li><li><strong>指令执行效率</strong>: IPC (Instructions Per Cycle)</li></ul><p><strong>内存性能指标</strong>:</p><ul><li><strong>缓存命中率</strong>: L1/L2/LLC缓存命中情况</li><li><strong>内存访问模式</strong>: 内存读写操作分布</li><li><strong>NUMA访问</strong>: 跨NUMA节点内存访问</li><li><strong>页面错误</strong>: 主/次页面错误频率</li></ul><p><strong>I/O性能指标</strong>:</p><ul><li><strong>块I/O操作</strong>: 磁盘读写操作分布</li><li><strong>网络I/O</strong>: 网络数据包处理开销</li><li><strong>系统调用</strong>: I/O相关系统调用频率</li></ul><p><strong>线程与调度指标</strong>:</p><ul><li><strong>上下文切换</strong>: 进程/线程切换频率</li><li><strong>调度延迟</strong>: 线程等待调度的时间</li><li><strong>CPU迁移</strong>: 线程在CPU核心间的迁移</li><li><strong>锁竞争</strong>: 互斥锁/自旋锁等待时间</li></ul><p><strong>特定硬件指标</strong>:</p><ul><li><strong>分支预测</strong>: 分支预测成功/失败率</li><li><strong>前端绑定</strong>: 指令获取和解码瓶颈</li><li><strong>后端绑定</strong>: 执行单元瓶颈</li><li><strong>SIMD效率</strong>: 向量指令使用效率</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@debian:~# perf record -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@debian:~# perf report
</span></span><span class=line><span class=cl>Samples: 240K of event <span class=s1>&#39;cpu-clock:pppH&#39;</span>, Event count <span class=o>(</span>approx.<span class=o>)</span>: <span class=m>60002500000</span>
</span></span><span class=line><span class=cl>  Children      Self  Command          Shared Object                                    Symbol
</span></span><span class=line><span class=cl>+   49.63%     0.08%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::this_thread::yield
</span></span><span class=line><span class=cl>+   49.38%     6.63%  strategyTrade    libc.so.6                                        <span class=o>[</span>.<span class=o>]</span> __sched_yield
</span></span><span class=line><span class=cl>+   42.77%     0.00%  strategyTrade    <span class=o>[</span>kernel.kallsyms<span class=o>]</span>                                <span class=o>[</span>k<span class=o>]</span> entry_SYSCALL_64_after_hwframe
</span></span><span class=line><span class=cl>+   42.77%     0.09%  strategyTrade    <span class=o>[</span>kernel.kallsyms<span class=o>]</span>                                <span class=o>[</span>k<span class=o>]</span> do_syscall_64
</span></span><span class=line><span class=cl>+   39.40%     0.00%  quote_source     libstdc++.so.6.0.30                              <span class=o>[</span>.<span class=o>]</span> 0x00007fadf3cd44a3
</span></span><span class=line><span class=cl>+   39.39%     0.00%  quote_source     quote_source                                     <span class=o>[</span>.<span class=o>]</span> std:🧵:_State_impl&lt;std:🧵:_Invoker&lt;std::tuple&lt;void <span class=o>(</span>
</span></span><span class=line><span class=cl>+   39.39%     0.00%  quote_source     quote_source                                     <span class=o>[</span>.<span class=o>]</span> std:🧵:_Invoker&lt;std::tuple&lt;void <span class=o>(</span>QuoteMessageProcessor::*<span class=o>)</span>
</span></span><span class=line><span class=cl>+   39.39%     0.00%  quote_source     quote_source                                     <span class=o>[</span>.<span class=o>]</span> std:🧵:_Invoker&lt;std::tuple&lt;void <span class=o>(</span>QuoteMessageProcessor::*<span class=o>)</span>
</span></span><span class=line><span class=cl>+   39.39%     0.00%  quote_source     quote_source                                     <span class=o>[</span>.<span class=o>]</span> std::__invoke&lt;void <span class=o>(</span>QuoteMessageProcessor::*<span class=o>)()</span>, QuoteMessagePro
</span></span><span class=line><span class=cl>+   39.39%     0.00%  quote_source     quote_source                                     <span class=o>[</span>.<span class=o>]</span> std::__invoke_impl&lt;void, void <span class=o>(</span>QuoteMessageProcessor::*<span class=o>)()</span>, Quot
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    <span class=o>[</span>unknown<span class=o>]</span>                                        <span class=o>[</span>.<span class=o>]</span> 0x001405303d8d4866
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    libc.so.6                                        <span class=o>[</span>.<span class=o>]</span> __pthread_once_slow
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::once_flag::_Prepare_execution::_Prepare_execution&lt;std::call
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::once_flag::_Prepare_execution::_Prepare_execution&lt;std::call
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::call_once&lt;void <span class=o>(</span>std::__future_base::_State_baseV2::*<span class=o>)(</span>std::
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__invoke&lt;void <span class=o>(</span>std::__future_base::_State_baseV2::*<span class=o>)(</span>std::f
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__invoke_impl&lt;void, void <span class=o>(</span>std::__future_base::_State_baseV2
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__future_base::_State_baseV2::_M_do_set
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::function&lt;std::unique_ptr&lt;std::__future_base::_Result_base,
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::_Function_handler&lt;std::unique_ptr&lt;std::__future_base::_Resu
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__invoke_r&lt;std::unique_ptr&lt;std::__future_base::_Result_base
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__invoke_impl&lt;std::unique_ptr&lt;std::__future_base::_Result&lt;v
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__future_base::_Task_setter&lt;std::unique_ptr&lt;std::__future_b
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__future_base::_Task_state&lt;std::_Bind&lt;StraTrade::MessageHan
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__invoke_r&lt;void, std::_Bind&lt;StraTrade::MessageHandler::star
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::__invoke_impl&lt;void, std::_Bind&lt;StraTrade::MessageHandler::s
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::_Bind&lt;StraTrade::MessageHandler::start<span class=o>()</span>::<span class=o>{</span>lambda<span class=o>()</span><span class=c1>#1} ()&gt;:</span>
</span></span><span class=line><span class=cl>+   38.37%     0.00%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::_Bind&lt;StraTrade::MessageHandler::start<span class=o>()</span>::<span class=o>{</span>lambda<span class=o>()</span><span class=c1>#1} ()&gt;:</span>
</span></span></code></pre></div><h2 id=perf-report-输出解析 class="relative group">Perf Report 输出解析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#perf-report-%e8%be%93%e5%87%ba%e8%a7%a3%e6%9e%90 aria-label=Anchor>#</a></span></h2><p>以下是一个典型的perf report输出示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@debian:~# perf report
</span></span><span class=line><span class=cl>Samples: 240K of event <span class=s1>&#39;cpu-clock:pppH&#39;</span>, Event count <span class=o>(</span>approx.<span class=o>)</span>: <span class=m>60002500000</span>
</span></span><span class=line><span class=cl>  Children      Self  Command          Shared Object                                    Symbol
</span></span><span class=line><span class=cl>+   49.63%     0.08%  strategyTrade    strategyTrade                                    <span class=o>[</span>.<span class=o>]</span> std::this_thread::yield
</span></span><span class=line><span class=cl>+   49.38%     6.63%  strategyTrade    libc.so.6                                        <span class=o>[</span>.<span class=o>]</span> __sched_yield
</span></span><span class=line><span class=cl>+   42.77%     0.00%  strategyTrade    <span class=o>[</span>kernel.kallsyms<span class=o>]</span>                                <span class=o>[</span>k<span class=o>]</span> entry_SYSCALL_64_after_hwframe
</span></span><span class=line><span class=cl>+   42.77%     0.09%  strategyTrade    <span class=o>[</span>kernel.kallsyms<span class=o>]</span>                                <span class=o>[</span>k<span class=o>]</span> do_syscall_64
</span></span><span class=line><span class=cl>+   39.40%     0.00%  quote_source     libstdc++.so.6.0.30                              <span class=o>[</span>.<span class=o>]</span> 0x00007fadf3cd44a3
</span></span><span class=line><span class=cl>+   39.39%     0.00%  quote_source     quote_source                                     <span class=o>[</span>.<span class=o>]</span> std:🧵:_State_impl&lt;std:🧵:_Invoker&lt;std::tuple&lt;void <span class=o>(</span>
</span></span><span class=line><span class=cl>// ... 更多输出 ...
</span></span></code></pre></div><blockquote><p><strong>交互提示</strong>：在perf report的交互界面中，每行前面的+号表示该条目可以展开。按下Enter键可以展开当前选中的条目，显示其调用关系。使用方向键可以在不同条目间导航，按下e键可以展开所有调用栈。</p></blockquote><h3 id=列含义详解 class="relative group">列含义详解 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%88%97%e5%90%ab%e4%b9%89%e8%af%a6%e8%a7%a3 aria-label=Anchor>#</a></span></h3><h3 id=1-children-列 class="relative group">1. Children 列 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-children-%e5%88%97 aria-label=Anchor>#</a></span></h3><p><strong>含义</strong>: 包含子函数调用的总CPU时间占比
<strong>分析要点</strong>:</p><ul><li>这是<strong>层次化</strong>的时间统计</li><li>包括该函数及其调用的所有子函数的时间</li><li>用于识别<strong>调用链的热点</strong></li></ul><p><strong>示例分析</strong>:</p><pre tabindex=0><code>+49.40%  std::this_thread::yield  // 这个函数调用链总共占49.40%
+49.13%  __sched_yield           // 其中__sched_yield占49.13%
</code></pre><h3 id=2-self-列 class="relative group">2. Self 列 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-self-%e5%88%97 aria-label=Anchor>#</a></span></h3><p><strong>含义</strong>: 函数自身执行时间占比（不包括子函数）
<strong>分析要点</strong>:</p><ul><li>只统计该函数<strong>本身</strong>的CPU时间</li><li>高Self值表示该函数是<strong>直接热点</strong></li><li>Self值低但Children高说明时间花在子函数调用上</li></ul><p><strong>关键对比</strong>:</p><pre tabindex=0><code>Children    Self     解释
49.40%     0.10%    时间主要在子函数调用上
49.13%     6.50%    __sched_yield自身就消耗6.50%
</code></pre><h3 id=3-command-列 class="relative group">3. Command 列 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-command-%e5%88%97 aria-label=Anchor>#</a></span></h3><p><strong>含义</strong>: 进程/程序名称
<strong>分析要点</strong>:</p><ul><li>标识哪个进程产生的性能开销</li><li>多进程系统中用于区分不同组件</li></ul><p><strong>示例</strong>:</p><ul><li><code>strategyTrade</code>: 主交易进程</li><li><code>quote_source</code>: 行情数据进程</li></ul><h3 id=4-shared-object-列 class="relative group">4. Shared Object 列 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-shared-object-%e5%88%97 aria-label=Anchor>#</a></span></h3><p><strong>含义</strong>: 代码所在的共享库或可执行文件
<strong>分析要点</strong>:</p><ul><li>帮助定位问题代码位置</li><li>区分用户代码vs系统库调用</li></ul><p><strong>常见类型</strong>:</p><pre tabindex=0><code>strategyTrade           // 你的主程序
libc.so.6              // C标准库
libstdc++.so.6.0.30    // C++标准库
[kernel.kallsyms]      // 内核代码
[unknown]              // 未知/无符号信息
</code></pre><h3 id=5-symbol-列 class="relative group">5. Symbol 列 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-symbol-%e5%88%97 aria-label=Anchor>#</a></span></h3><p><strong>含义</strong>: 具体的函数或符号名称
<strong>分析要点</strong>:</p><ul><li><code>[.]</code> 表示用户空间函数</li><li><code>[k]</code> 表示内核函数</li><li>长符号名通常是C++模板展开</li></ul><h3 id=分析方法论 class="relative group">分析方法论 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%88%86%e6%9e%90%e6%96%b9%e6%b3%95%e8%ae%ba aria-label=Anchor>#</a></span></h3><h3 id=第一步识别热点 class="relative group">第一步：识别热点 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%ac%ac%e4%b8%80%e6%ad%a5%e8%af%86%e5%88%ab%e7%83%ad%e7%82%b9 aria-label=Anchor>#</a></span></h3><ol><li><strong>按Children排序</strong> - 找调用链热点</li><li><strong>按Self排序</strong> - 找直接执行热点</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>perf report --sort<span class=o>=</span>children
</span></span><span class=line><span class=cl>perf report --sort<span class=o>=</span>self
</span></span></code></pre></div><h3 id=第二步层次分析 class="relative group">第二步：层次分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%b1%82%e6%ac%a1%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><pre tabindex=0><code>父函数 (Children高，Self低)
├── 子函数A (Self高) ← 直接优化目标
├── 子函数B (Self中等)
└── 子函数C (Self低)
</code></pre><h3 id=第三步定位代码位置 class="relative group">第三步：定位代码位置 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%ac%ac%e4%b8%89%e6%ad%a5%e5%ae%9a%e4%bd%8d%e4%bb%a3%e7%a0%81%e4%bd%8d%e7%bd%ae aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看具体代码行</span>
</span></span><span class=line><span class=cl>perf annotate std::this_thread::yield
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看调用关系</span>
</span></span><span class=line><span class=cl>perf report --call-graph<span class=o>=</span>graph,0.5,caller
</span></span></code></pre></div><h2 id=案例分析步骤 class="relative group">案例分析步骤 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90%e6%ad%a5%e9%aa%a4 aria-label=Anchor>#</a></span></h2><p>在本节中，我们将分析一个实际的性能问题，展示如何应用前面介绍的方法和工具。</p><h3 id=1-快速扫描热点 class="relative group">1. 快速扫描热点 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e5%bf%ab%e9%80%9f%e6%89%ab%e6%8f%8f%e7%83%ad%e7%82%b9 aria-label=Anchor>#</a></span></h3><pre tabindex=0><code>49.40% std::this_thread::yield  ← 最大热点！
39.43% QuoteMessageProcessor    ← 第二大热点
38.61% processMessages          ← 实际业务逻辑
</code></pre><h3 id=2-深入分析yield问题 class="relative group">2. 深入分析yield问题 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e6%b7%b1%e5%85%a5%e5%88%86%e6%9e%90yield%e9%97%ae%e9%a2%98 aria-label=Anchor>#</a></span></h3><pre tabindex=0><code>Children: 49.40%  Self: 0.10%
说明：yield本身很快，但触发的系统调用很慢
</code></pre><h3 id=3-系统调用分析 class="relative group">3. 系统调用分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><pre tabindex=0><code>49.13% __sched_yield (Self: 6.50%)
说明：大部分时间在内核的调度器代码中
</code></pre><h3 id=4-调用链追踪 class="relative group">4. 调用链追踪 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%e8%b0%83%e7%94%a8%e9%93%be%e8%bf%bd%e8%b8%aa aria-label=Anchor>#</a></span></h3><pre tabindex=0><code>MessageHandler::start() 
→ lambda函数 
→ processMessages() 
→ yield循环
</code></pre><h2 id=高级分析技巧 class="relative group">高级分析技巧 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%ab%98%e7%ba%a7%e5%88%86%e6%9e%90%e6%8a%80%e5%b7%a7 aria-label=Anchor>#</a></span></h2><h3 id=1-过滤分析 class="relative group">1. 过滤分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e8%bf%87%e6%bb%a4%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 只看特定函数</span>
</span></span><span class=line><span class=cl>perf report --comms<span class=o>=</span>strategyTrade
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 只看用户空间</span>
</span></span><span class=line><span class=cl>perf report --dsos<span class=o>=</span>strategyTrade
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 按线程分析</span>
</span></span><span class=line><span class=cl>perf report --sort<span class=o>=</span>pid,comm
</span></span></code></pre></div><h3 id=2-调用图分析 class="relative group">2. 调用图分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e8%b0%83%e7%94%a8%e5%9b%be%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 生成调用图</span>
</span></span><span class=line><span class=cl>perf report --call-graph<span class=o>=</span>graph,0.5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 倒序调用图（谁调用了这个函数）</span>
</span></span><span class=line><span class=cl>perf report --call-graph<span class=o>=</span><span class=nb>caller</span>
</span></span></code></pre></div><h3 id=3-差异对比 class="relative group">3. 差异对比 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e5%b7%ae%e5%bc%82%e5%af%b9%e6%af%94 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 对比优化前后</span>
</span></span><span class=line><span class=cl>perf diff perf.data.before perf.data.after
</span></span></code></pre></div><h2 id=实际优化流程 class="relative group">实际优化流程 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ae%9e%e9%99%85%e4%bc%98%e5%8c%96%e6%b5%81%e7%a8%8b aria-label=Anchor>#</a></span></h2><h3 id=1-确定优化目标 class="relative group">1. 确定优化目标 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e7%a1%ae%e5%ae%9a%e4%bc%98%e5%8c%96%e7%9b%ae%e6%a0%87 aria-label=Anchor>#</a></span></h3><ul><li>Children > 10% 的函数链</li><li>Self > 5% 的直接函数</li><li>意外出现在热点的函数</li></ul><h3 id=2-验证假设 class="relative group">2. 验证假设 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e9%aa%8c%e8%af%81%e5%81%87%e8%ae%be aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 在可疑代码处添加计时
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>auto</span> <span class=n>start</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>suspected_function</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>duration</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration_cast</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>nanoseconds</span><span class=o>&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=n>start</span><span class=p>).</span><span class=n>count</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=3-优化验证 class="relative group">3. 优化验证 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e4%bc%98%e5%8c%96%e9%aa%8c%e8%af%81 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 优化前</span>
</span></span><span class=line><span class=cl>perf record -g ./program_before
</span></span><span class=line><span class=cl>perf report --stdio &gt; before.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 优化后  </span>
</span></span><span class=line><span class=cl>perf record -g ./program_after
</span></span><span class=line><span class=cl>perf report --stdio &gt; after.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对比结果</span>
</span></span><span class=line><span class=cl>diff before.txt after.txt
</span></span></code></pre></div><h2 id=关键指标解读 class="relative group">关键指标解读 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%85%b3%e9%94%ae%e6%8c%87%e6%a0%87%e8%a7%a3%e8%af%bb aria-label=Anchor>#</a></span></h2><h3 id=性能健康的系统应该 class="relative group">性能健康的系统应该： <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%a7%e8%83%bd%e5%81%a5%e5%ba%b7%e7%9a%84%e7%b3%bb%e7%bb%9f%e5%ba%94%e8%af%a5 aria-label=Anchor>#</a></span></h3><ul><li>没有单个函数占用>20%的CPU</li><li>yield/sleep类函数占比&lt;1%</li><li>业务逻辑函数占主要比例</li><li>系统调用占比合理(&lt;10%)</li></ul><h3 id=你的系统问题 class="relative group">你的系统问题： <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%bd%a0%e7%9a%84%e7%b3%bb%e7%bb%9f%e9%97%ae%e9%a2%98 aria-label=Anchor>#</a></span></h3><ul><li>yield占49% ← 严重异常</li><li>业务逻辑仅占38% ← 被挤压</li><li>大量时间在调度上 ← 设计问题</li></ul><h2 id=使用perf分析内存性能指标 class="relative group">使用Perf分析内存性能指标 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%bd%bf%e7%94%a8perf%e5%88%86%e6%9e%90%e5%86%85%e5%ad%98%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87 aria-label=Anchor>#</a></span></h2><p>内存性能问题往往是系统瓶颈的重要来源。Perf提供了多种工具和方法来分析内存相关的性能指标。</p><h3 id=1-缓存相关事件采集 class="relative group">1. 缓存相关事件采集 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e7%bc%93%e5%ad%98%e7%9b%b8%e5%85%b3%e4%ba%8b%e4%bb%b6%e9%87%87%e9%9b%86 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 采集缓存未命中事件</span>
</span></span><span class=line><span class=cl>perf record -e cache-misses -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 采集L1数据缓存加载未命中</span>
</span></span><span class=line><span class=cl>perf record -e L1-dcache-load-misses -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 采集最后级缓存加载未命中</span>
</span></span><span class=line><span class=cl>perf record -e LLC-load-misses -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 同时采集多个缓存事件</span>
</span></span><span class=line><span class=cl>perf record -e cache-misses,cache-references,L1-dcache-load-misses,LLC-load-misses -a -g sleep <span class=m>30</span>
</span></span></code></pre></div><h4 id=虚拟环境中的限制与替代方案 class="relative group">虚拟环境中的限制与替代方案 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e8%99%9a%e6%8b%9f%e7%8e%af%e5%a2%83%e4%b8%ad%e7%9a%84%e9%99%90%e5%88%b6%e4%b8%8e%e6%9b%bf%e4%bb%a3%e6%96%b9%e6%a1%88 aria-label=Anchor>#</a></span></h4><p>在虚拟机或容器环境中，许多硬件性能计数器无法直接访问，特别是缓存相关的事件。以下是常见的限制和替代方案：</p><p><strong>无法使用的缓存事件</strong>：</p><ul><li><code>L1-dcache-load-misses</code>：L1数据缓存未命中（大多数虚拟环境不可用）</li><li><code>LLC-load-misses</code>：最后级缓存未命中（大多数虚拟环境不可用）</li><li><code>iTLB-load-misses</code>：指令TLB未命中（通常不可用）</li><li><code>dTLB-load-misses</code>：数据TLB未命中（通常不可用）</li><li>大多数特定于处理器型号的缓存事件</li></ul><p><strong>替代方案</strong>：</p><ol><li><strong>使用软件事件替代</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 使用软件事件和采样</span>
</span></span><span class=line><span class=cl>perf record -e cycles:u -a -g sleep <span class=m>30</span>
</span></span></code></pre></div><ol start=2><li><strong>使用可用的通用事件</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 大多数虚拟环境中可用的事件</span>
</span></span><span class=line><span class=cl>perf record -e cpu-clock,task-clock,context-switches,cpu-migrations,page-faults -a -g sleep <span class=m>30</span>
</span></span></code></pre></div><ol start=3><li><strong>使用perf stat进行基本分析</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基本性能统计，在大多数虚拟环境中可用</span>
</span></span><span class=line><span class=cl>perf stat -e cycles,instructions,branches,branch-misses ./your_program
</span></span></code></pre></div><ol start=4><li><strong>使用系统级指标</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 结合vmstat和perf</span>
</span></span><span class=line><span class=cl>vmstat <span class=m>1</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>perf record -e cpu-clock -a -g sleep <span class=m>30</span>
</span></span></code></pre></div><ol start=5><li><strong>考虑使用其他工具</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在虚拟环境中可以使用BCC/BPF工具</span>
</span></span><span class=line><span class=cl><span class=c1># 需要安装BCC工具包</span>
</span></span><span class=line><span class=cl>/usr/share/bcc/tools/cachestat <span class=m>1</span>
</span></span></code></pre></div><ol start=6><li><strong>使用应用程序级计时器</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 在应用代码中添加计时器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>auto</span> <span class=n>start</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>critical_function</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>end</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>milli</span><span class=o>&gt;</span> <span class=n>elapsed</span> <span class=o>=</span> <span class=n>end</span> <span class=o>-</span> <span class=n>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;执行时间: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>elapsed</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; ms</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span></code></pre></div><blockquote><p><strong>注意</strong>：如果缓存性能分析对您的应用至关重要，建议在物理机上进行性能测试，而不是在虚拟环境中。</p></blockquote><h3 id=2-内存访问模式分析 class="relative group">2. 内存访问模式分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e5%86%85%e5%ad%98%e8%ae%bf%e9%97%ae%e6%a8%a1%e5%bc%8f%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 采集内存加载事件</span>
</span></span><span class=line><span class=cl>perf record -e mem:0:u -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 采集内存存储事件</span>
</span></span><span class=line><span class=cl>perf record -e mem:0:u:store -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 采集大页面事件</span>
</span></span><span class=line><span class=cl>perf record -e hugetlb:*,page-faults -a -g sleep <span class=m>30</span>
</span></span></code></pre></div><h3 id=3-内存带宽和延迟分析 class="relative group">3. 内存带宽和延迟分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e5%86%85%e5%ad%98%e5%b8%a6%e5%ae%bd%e5%92%8c%e5%bb%b6%e8%bf%9f%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 使用perf c2c分析伪共享问题</span>
</span></span><span class=line><span class=cl>perf c2c record -a ./your_program
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析结果</span>
</span></span><span class=line><span class=cl>perf c2c report --stats -NN
</span></span></code></pre></div><h3 id=4-内存相关指标解读 class="relative group">4. 内存相关指标解读 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%e5%86%85%e5%ad%98%e7%9b%b8%e5%85%b3%e6%8c%87%e6%a0%87%e8%a7%a3%e8%af%bb aria-label=Anchor>#</a></span></h3><p>分析perf report输出时，以下是与内存性能相关的关键指标：</p><h4 id=缓存命中率计算 class="relative group">缓存命中率计算 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%bc%93%e5%ad%98%e5%91%bd%e4%b8%ad%e7%8e%87%e8%ae%a1%e7%ae%97 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 采集缓存命中和未命中事件</span>
</span></span><span class=line><span class=cl>perf stat -e cache-references,cache-misses ./your_program
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出示例</span>
</span></span><span class=line><span class=cl>Performance counter stats <span class=k>for</span> <span class=s1>&#39;./your_program&#39;</span>:
</span></span><span class=line><span class=cl>  2,342,833      cache-references
</span></span><span class=line><span class=cl>    234,487      cache-misses            <span class=c1># 10.01% of cache-references</span>
</span></span></code></pre></div><p>缓存命中率 = 1 - (cache-misses / cache-references) = 约90%</p><h4 id=内存访问延迟分析 class="relative group">内存访问延迟分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%86%85%e5%ad%98%e8%ae%bf%e9%97%ae%e5%bb%b6%e8%bf%9f%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 使用perf mem命令</span>
</span></span><span class=line><span class=cl>perf mem record -a ./your_program
</span></span><span class=line><span class=cl>perf mem report
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出会显示加载/存储操作的延迟分布</span>
</span></span></code></pre></div><h3 id=5-常见内存性能问题及解决方案 class="relative group">5. 常见内存性能问题及解决方案 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%e5%b8%b8%e8%a7%81%e5%86%85%e5%ad%98%e6%80%a7%e8%83%bd%e9%97%ae%e9%a2%98%e5%8f%8a%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 aria-label=Anchor>#</a></span></h3><table><thead><tr><th>问题类型</th><th>Perf指标特征</th><th>可能的解决方案</th></tr></thead><tbody><tr><td>缓存未命中率高</td><td>cache-misses > 10%</td><td>优化数据结构布局，提高局部性</td></tr><tr><td>伪共享问题</td><td>高LLC-load-misses，多线程</td><td>使用缓存行填充，分离热点变量</td></tr><tr><td>内存带宽瓶颈</td><td>高mem-loads/stores，低IPC</td><td>减少不必要的内存访问，使用流式加载</td></tr><tr><td>NUMA访问不当</td><td>高remote_DRAM访问</td><td>确保线程与其访问的内存在同一NUMA节点</td></tr><tr><td>页面错误过多</td><td>高page-faults计数</td><td>预分配内存，使用大页面</td></tr></tbody></table><h3 id=6-高级内存分析案例 class="relative group">6. 高级内存分析案例 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-%e9%ab%98%e7%ba%a7%e5%86%85%e5%ad%98%e5%88%86%e6%9e%90%e6%a1%88%e4%be%8b aria-label=Anchor>#</a></span></h3><p>以下是一个真实案例，展示如何使用perf分析和解决内存性能问题：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 采集内存访问事件</span>
</span></span><span class=line><span class=cl>perf record -e cycles:pp -e cache-misses:pp -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析结果</span>
</span></span><span class=line><span class=cl>perf report
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出示例（简化版）</span>
</span></span><span class=line><span class=cl>Children  Self   Symbol
</span></span><span class=line><span class=cl>+  25.3%   1.2%  <span class=o>[</span>.<span class=o>]</span> process_data
</span></span><span class=line><span class=cl>+  24.1%  15.6%  <span class=o>[</span>.<span class=o>]</span> memcpy
</span></span><span class=line><span class=cl>+  10.2%   8.7%  <span class=o>[</span>.<span class=o>]</span> std::vector::resize
</span></span></code></pre></div><p><strong>分析</strong>：memcpy和vector::resize占用了大量CPU时间，表明存在不必要的内存复制操作。</p><p><strong>解决方案</strong>：</p><ol><li>使用移动语义代替复制</li><li>预分配足够的vector容量</li><li>使用引用代替值传递</li></ol><p>优化后，相关函数的开销降低了80%，整体性能提升了35%。</p><h3 id=7-内存性能优化工作流 class="relative group">7. 内存性能优化工作流 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-%e5%86%85%e5%ad%98%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e5%b7%a5%e4%bd%9c%e6%b5%81 aria-label=Anchor>#</a></span></h3><ol><li><strong>发现问题</strong>：使用<code>perf stat</code>识别是否存在内存瓶颈</li><li><strong>定位热点</strong>：使用<code>perf record/report</code>找出内存访问热点</li><li><strong>分析模式</strong>：使用<code>perf mem</code>分析访问模式和延迟</li><li><strong>验证假设</strong>：修改代码并再次测量</li><li><strong>迭代优化</strong>：持续监控和改进</li></ol><p>内存性能优化是一个持续过程，需要结合应用特性和硬件架构特点进行针对性分析和优化。</p><h2 id=高频交易系统案例分析 class="relative group">高频交易系统案例分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h2><p>以下是一个真实的高频交易系统性能优化案例，展示如何使用perf工具发现并解决性能瓶颈。</p><h3 id=问题场景 class="relative group">问题场景 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%97%ae%e9%a2%98%e5%9c%ba%e6%99%af aria-label=Anchor>#</a></span></h3><p>某高频交易系统在行情波动较大时出现延迟增加，影响交易决策速度。初步观察显示CPU使用率不高，但系统响应变慢。</p><h3 id=步骤1-整体性能分析 class="relative group">步骤1: 整体性能分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%ad%a5%e9%aa%a41-%e6%95%b4%e4%bd%93%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 采集系统整体性能数据</span>
</span></span><span class=line><span class=cl>perf record -a -g -F <span class=m>9999</span> sleep <span class=m>60</span>
</span></span><span class=line><span class=cl>perf report
</span></span></code></pre></div><p><strong>发现</strong>:</p><pre tabindex=0><code>Children    Self    Command         Symbol
+49.63%     0.08%   strategyTrade   [.] std::this_thread::yield
+49.38%     6.63%   strategyTrade   [.] __sched_yield
+39.40%     0.00%   quote_source    [.] QuoteMessageProcessor相关函数
</code></pre><p>这表明系统大量时间花在线程yield上，而非实际业务逻辑处理。</p><h3 id=步骤2-线程模型分析 class="relative group">步骤2: 线程模型分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%ad%a5%e9%aa%a42-%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分析线程状态转换</span>
</span></span><span class=line><span class=cl>perf record -e sched:sched_switch -a -g sleep <span class=m>30</span>
</span></span><span class=line><span class=cl>perf report
</span></span></code></pre></div><p><strong>发现</strong>: 行情处理线程和策略计算线程之间存在严重的线程切换开销，使用了低效的轮询模式。</p><h3 id=步骤3-内存访问模式分析 class="relative group">步骤3: 内存访问模式分析 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%ad%a5%e9%aa%a43-%e5%86%85%e5%ad%98%e8%ae%bf%e9%97%ae%e6%a8%a1%e5%bc%8f%e5%88%86%e6%9e%90 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分析缓存效率</span>
</span></span><span class=line><span class=cl>perf stat -e cache-references,cache-misses ./strategyTrade
</span></span></code></pre></div><p><strong>发现</strong>: 缓存未命中率超过15%，远高于理想值。</p><h3 id=步骤4-优化实施 class="relative group">步骤4: 优化实施 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%ad%a5%e9%aa%a44-%e4%bc%98%e5%8c%96%e5%ae%9e%e6%96%bd aria-label=Anchor>#</a></span></h3><ol><li><p><strong>线程模型重构</strong>:</p><ul><li>将轮询模式改为条件变量通知</li><li>减少线程数量，按CPU核心分配线程</li></ul></li><li><p><strong>内存布局优化</strong>:</p><ul><li>重新组织行情数据结构，提高缓存局部性</li><li>使用缓存行填充避免伪共享</li><li>预分配内存池，避免动态分配</li></ul></li><li><p><strong>算法优化</strong>:</p><ul><li>将热点计算路径向量化</li><li>减少分支预测失败的可能性</li></ul></li></ol><h3 id=步骤5-优化效果验证 class="relative group">步骤5: 优化效果验证 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%ad%a5%e9%aa%a45-%e4%bc%98%e5%8c%96%e6%95%88%e6%9e%9c%e9%aa%8c%e8%af%81 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 优化后性能测量</span>
</span></span><span class=line><span class=cl>perf stat -e cycles,instructions,cache-references,cache-misses,branches,branch-misses -a ./strategyTrade_optimized
</span></span></code></pre></div><p><strong>结果</strong>:</p><ul><li>端到端延迟降低了78%</li><li>缓存未命中率从15%降至3%</li><li>CPU使用率提高了25%（更有效利用）</li><li>yield调用占比从49%降至0.5%</li></ul><h3 id=关键经验总结 class="relative group">关键经验总结 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%85%b3%e9%94%ae%e7%bb%8f%e9%aa%8c%e6%80%bb%e7%bb%93 aria-label=Anchor>#</a></span></h3><ol><li><strong>避免轮询</strong>: 在高频交易系统中，用条件变量或事件通知代替yield轮询</li><li><strong>数据局部性</strong>: 确保热点数据结构适合缓存行大小</li><li><strong>线程亲和性</strong>: 将关键线程绑定到特定CPU核心</li><li><strong>避免系统调用</strong>: 最小化关键路径上的系统调用</li><li><strong>内存预分配</strong>: 使用内存池避免动态内存分配</li><li><strong>无锁算法</strong>: 在可能的情况下使用无锁数据结构</li></ol><h2 id=总结与最佳实践 class="relative group">总结与最佳实践 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%80%bb%e7%bb%93%e4%b8%8e%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5 aria-label=Anchor>#</a></span></h2><p>通过本文的分析和案例研究，我们可以总结出以下高频交易系统性能优化的最佳实践：</p><ol><li><p><strong>系统化分析流程</strong>：</p><ul><li>建立性能基准</li><li>识别关键热点</li><li>分层分析问题</li><li>验证优化效果</li></ul></li><li><p><strong>关注关键性能指标</strong>：</p><ul><li>端到端延迟</li><li>缓存命中率</li><li>系统调用频率</li><li>上下文切换次数</li></ul></li><li><p><strong>常见优化策略</strong>：</p><ul><li>避免轮询，使用事件通知</li><li>优化内存布局和访问模式</li><li>减少锁竞争和线程切换</li><li>使用无锁算法和数据结构</li><li>预分配资源，避免运行时分配</li></ul></li><li><p><strong>持续监控与优化</strong>：</p><ul><li>建立性能监控机制</li><li>定期进行性能分析</li><li>在系统变更后重新评估性能</li></ul></li></ol><p>通过使用perf工具进行系统化的性能分析，结合对高频交易系统特性的深入理解，我们可以有效地识别和解决性能瓶颈，提高系统的响应速度和吞吐量，最终提升交易策略的执行效率和盈利能力。</p></div></section><footer class="max-w-4xl pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=360 height=360 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt="Wenjun Yu" loading=lazy decoding=async src=/img/author.jpg></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Wenjun Yu</div><div class="text-sm text-neutral-700 dark:text-neutral-400">A little bit about you</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/code-agree target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://x.com/flight_from_ target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:lineyua66@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></div></div></div></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;quote=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Share on Facebook" aria-label="Share on Facebook" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://x.com/intent/tweet/?url=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;text=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Post on X" aria-label="Post on X" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://tootpick.org/#text=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/%20Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Toot on Mastodon" aria-label="Toot on Mastodon" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;description=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Pin on Pinterest" aria-label="Pin on Pinterest" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;resubmit=true&amp;title=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Submit to Reddit" aria-label="Submit to Reddit" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;title=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Share on LinkedIn" aria-label="Share on LinkedIn" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;subject=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Send via email" aria-label="Send via email" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://telegram.me/share/url?text=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;url=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Share on Telegram" aria-label="Share on Telegram" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://line.me/R/share?text=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" title="Share on LINE" aria-label="Share on LINE" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M311 196.8v81.3c0 2.1-1.6 3.7-3.7 3.7h-13c-1.3.0-2.4-.7-3-1.5L254 230v48.2c0 2.1-1.6 3.7-3.7 3.7h-13c-2.1.0-3.7-1.6-3.7-3.7V196.9c0-2.1 1.6-3.7 3.7-3.7h12.9c1.1.0 2.4.6 3 1.6l37.3 50.3V196.9c0-2.1 1.6-3.7 3.7-3.7h13c2.1-.1 3.8 1.6 3.8 3.5zm-93.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 2.1 1.6 3.7 3.7 3.7h13c2.1.0 3.7-1.6 3.7-3.7V196.8c0-1.9-1.6-3.7-3.7-3.7zm-31.4 68.1H150.3V196.8c0-2.1-1.6-3.7-3.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 1 .3 1.8 1 2.5.7.6 1.5 1 2.5 1h52.2c2.1.0 3.7-1.6 3.7-3.7v-13c0-1.9-1.6-3.7-3.5-3.7zm193.7-68.1H327.3c-1.9.0-3.7 1.6-3.7 3.7v81.3c0 1.9 1.6 3.7 3.7 3.7h52.2c2.1.0 3.7-1.6 3.7-3.7V265c0-2.1-1.6-3.7-3.7-3.7H344V247.7h35.5c2.1.0 3.7-1.6 3.7-3.7V230.9c0-2.1-1.6-3.7-3.7-3.7H344V213.5h35.5c2.1.0 3.7-1.6 3.7-3.7v-13c-.1-1.9-1.7-3.7-3.7-3.7zM512 93.4v326c-.1 51.2-42.1 92.7-93.4 92.6H92.6C41.4 511.9-.1 469.8.0 418.6V92.6C.1 41.4 42.2-.1 93.4.0h326c51.2.1 92.7 42.1 92.6 93.4zM441.6 233.5c0-83.4-83.7-151.3-186.4-151.3S68.8 150.1 68.8 233.5c0 74.7 66.3 137.4 155.9 149.3 21.8 4.7 19.3 12.7 14.4 42.1-.8 4.7-3.8 18.4 16.1 10.1s107.3-63.2 146.5-108.2c27-29.7 39.9-59.8 39.9-93.1z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://service.weibo.com/share/share.php?url=https://code-agree.github.io/blog/2025-06-18-how_to_use_perf/&amp;appkey=&amp;title=Perf%20Report%20%e5%88%86%e6%9e%90%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%20-%20%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96&amp;pic=&amp;ralateUid=&amp;lang" title="Share on Weibo" aria-label="Share on Weibo" target=_blank rel="noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><path fill="currentcolor" d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7.0 395.3.0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"/></svg></span></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/blog/memory_order/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Memory_order</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-06-11 02:15:43 +0800 +0800">11 June 2025</time>
</span></span></a></span><span><a class="group flex text-right" href=/blog/2025-06-19-compile_perf/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">编译器优化级别技术解析</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-06-19 04:00:00 +0800 +0800">19 June 2025</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script src=https://giscus.app/client.js data-repo=code-agree/code-agree.github.io data-repo-id=R_kgDOK-ejEw data-category=Announcements data-category-id=DIC_kwDOK-ejE84ChYPz data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Wenjun Yu</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm sm:p-6 md:p-[10vh] lg:p-[12vh] dark:bg-neutral-900/50" data-url=https://code-agree.github.io/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>