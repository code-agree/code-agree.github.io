<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Blog on Yu's Space</title><link>https://code-agree.github.io/blog/</link><description>Recent content in Blog on Yu's Space</description><generator>Hugo</generator><language>en</language><lastBuildDate>Mon, 19 May 2025 13:38:50 +0800</lastBuildDate><atom:link href="https://code-agree.github.io/blog/index.xml" rel="self" type="application/rss+xml"/><item><title>MmAvellaneda Stoikov</title><link>https://code-agree.github.io/blog/mmavellaneda-stoikov/</link><pubDate>Mon, 19 May 2025 13:38:50 +0800</pubDate><guid>https://code-agree.github.io/blog/mmavellaneda-stoikov/</guid><description>&lt;p>è¿™ç¯‡è®ºæ–‡ &lt;strong>ã€ŠOptimal High-Frequency Market Makingã€‹&lt;/strong> å®ç°å¹¶åˆ†æäº† Avellaneda-Stoikov (2008) çš„é«˜é¢‘åšå¸‚å®šä»·æ¨¡å‹ï¼Œå¹¶å¼•å…¥äº†ä¸€ä¸ªåŠ¨æ€åº“å­˜æ§åˆ¶æ¨¡å—ï¼Œç”¨äºä¼˜åŒ–é™ä»·å•çš„æŒ‚å•é‡ï¼Œä»¥åœ¨ä¿è¯ç›ˆåˆ©çš„åŒæ—¶æ§åˆ¶åº“å­˜é£é™©ã€‚ä¸‹é¢æ˜¯è¯¦ç»†è§£è¯»ï¼š&lt;/p>
&lt;hr>
&lt;h2 id="-ä¸€ç ”ç©¶èƒŒæ™¯ä¸åŠ¨æœº" class="relative group">ğŸ“Œ ä¸€ã€ç ”ç©¶èƒŒæ™¯ä¸åŠ¨æœº &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#-%e4%b8%80%e7%a0%94%e7%a9%b6%e8%83%8c%e6%99%af%e4%b8%8e%e5%8a%a8%e6%9c%ba" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>é«˜é¢‘åšå¸‚å•†ï¼ˆHFT market makersï¼‰é€šè¿‡åœ¨è®¢å•ç°¿ä¸­æŒç»­æŒ‚å‡ºä¹°å–é™ä»·å•æ¥æä¾›æµåŠ¨æ€§ï¼Œèµšå– &lt;strong>ä¹°å–ä»·å·®ï¼ˆspreadï¼‰&lt;/strong> å’Œ &lt;strong>äº¤æ˜“æ‰€æä¾›çš„æŒ‚å•è¿”åˆ©ï¼ˆrebateï¼‰&lt;/strong>ã€‚ä½†è¿™åŒæ—¶ä¼šäº§ç”Ÿ&lt;strong>åº“å­˜é£é™©ï¼ˆinventory riskï¼‰&lt;/strong>ï¼Œå³ä¹°å…¥æˆ–å–å‡ºè¿‡å¤šåï¼Œä»·æ ¼æ³¢åŠ¨å¸¦æ¥çš„é£é™©ã€‚&lt;/p>
&lt;p>Avellaneda-Stoikov æ¨¡å‹æ˜¯å…¶ä¸­ä¸€ä¸ªç»å…¸çš„é«˜é¢‘åšå¸‚å®šä»·æ¡†æ¶ï¼Œå®ƒåœ¨å‡è®¾è‚¡ç¥¨ä»·æ ¼æœä»å¸ƒæœ—è¿åŠ¨çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡æ±‚è§£æœ€ä¼˜æ§åˆ¶é—®é¢˜å¾—å‡º&lt;strong>æœ€ä¼˜æŠ¥ä»·ç­–ç•¥&lt;/strong>ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="-äºŒæ¨¡å‹æ¡†æ¶" class="relative group">ğŸ“Œ äºŒã€æ¨¡å‹æ¡†æ¶ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#-%e4%ba%8c%e6%a8%a1%e5%9e%8b%e6%a1%86%e6%9e%b6" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="21-å®šä»·æ¨¡å‹pricing" class="relative group">2.1 å®šä»·æ¨¡å‹ï¼ˆPricingï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-%e5%ae%9a%e4%bb%b7%e6%a8%a1%e5%9e%8bpricing" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>åŸºäº Avellaneda &amp;amp; Stoikov (2008)ï¼š&lt;/p>
&lt;ul>
&lt;li>è‚¡ç¥¨ä»·æ ¼æœä»å¸ƒæœ—è¿åŠ¨ï¼š $dS_t = \sigma dW_t$&lt;/li>
&lt;li>å¸‚åœºæ·±åº¦ä¸æˆäº¤æ¦‚ç‡å…³ç³»ï¼š$\lambda(\delta) = A e^{-\kappa \delta}$&lt;/li>
&lt;li>åšå¸‚å•†ç›®æ ‡æ˜¯æœ€å¤§åŒ–ç»ˆç«¯æ—¶åˆ» $T$ æ—¶çš„æŒ‡æ•°æ•ˆç”¨å‡½æ•°ï¼š&lt;/li>
&lt;/ul>
&lt;p>$$
\max_{\delta_a, \delta_b} \mathbb{E}[-e^{-\gamma (X_T + q_T S_T)}]
$$&lt;/p></description></item><item><title>è¡Œæƒ…æ•°æ®è§£æä¼˜åŒ–æœ€ä½³å®è·µ</title><link>https://code-agree.github.io/blog/perf/</link><pubDate>Wed, 30 Apr 2025 03:54:56 +0800</pubDate><guid>https://code-agree.github.io/blog/perf/</guid><description>&lt;h1 id="è¡Œæƒ…æ•°æ®è§£æä¼˜åŒ–æœ€ä½³å®è·µ" class="relative group">è¡Œæƒ…æ•°æ®è§£æä¼˜åŒ–æœ€ä½³å®è·µ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%a1%8c%e6%83%85%e6%95%b0%e6%8d%ae%e8%a7%a3%e6%9e%90%e4%bc%98%e5%8c%96%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="åŸå§‹è§£ææ–¹æ¡ˆçš„æ€§èƒ½ç“¶é¢ˆ" class="relative group">åŸå§‹è§£ææ–¹æ¡ˆçš„æ€§èƒ½ç“¶é¢ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%8e%9f%e5%a7%8b%e8%a7%a3%e6%9e%90%e6%96%b9%e6%a1%88%e7%9a%84%e6%80%a7%e8%83%bd%e7%93%b6%e9%a2%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åŸå§‹çš„ Binance èšåˆäº¤æ˜“æ•°æ®è§£æå®ç°å­˜åœ¨å¤šä¸ªæ€§èƒ½ç“¶é¢ˆï¼Œè¿™åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­å°¤ä¸ºå…³é”®ã€‚ä¸»è¦é—®é¢˜åŒ…æ‹¬ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>ä½¿ç”¨ &lt;code>std::stod&lt;/code> è¿›è¡Œå­—ç¬¦ä¸²åˆ°æµ®ç‚¹æ•°è½¬æ¢&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">price&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">stod&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">price_str&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">quantity&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">stod&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">qty_str&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªä¸¥é‡é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>std::stod&lt;/code> åœ¨åº•å±‚å®ç°ä¸­éœ€è¦å¤„ç†å„ç§æ ¼å¼å’Œæœ¬åœ°åŒ–ï¼Œå¯¼è‡´è®¡ç®—å¼€é”€å¤§&lt;/li>
&lt;li>æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºäº†ä¸´æ—¶ &lt;code>std::string&lt;/code> å¯¹è±¡ï¼Œå¢åŠ äº†å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åˆ›å»ºä¸´æ—¶çš„ &lt;code>padded_string&lt;/code> å¯¹è±¡&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">simdjson&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">padded_string&lt;/span> &lt;span class="n">padded_json&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">json&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">simdjson&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">dom&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">element&lt;/span> &lt;span class="n">doc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">padded_json&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¼šå¯¼è‡´é¢å¤–çš„å†…å­˜åˆ†é…å’Œå¤åˆ¶ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜é¢‘ç‡å¤„ç†æ¶ˆæ¯æ—¶å˜å¾—éå¸¸æ˜æ˜¾ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä½¿ç”¨ä½æ•ˆçš„å­—ç¬¦ä¸²å¤åˆ¶æ–¹æ³•&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">strncpy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">symbol&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">doc&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;s&amp;#34;&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">get_string&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">symbol&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ ‡å‡†çš„ &lt;code>strncpy&lt;/code> æ²¡æœ‰åˆ©ç”¨ç°ä»£ CPU çš„ SIMD æŒ‡ä»¤é›†ä¼˜åŠ¿ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¼‚å¸¸å¤„ç†æˆæœ¬&lt;/strong>ï¼šåœ¨è§£æçƒ­è·¯å¾„ä¸­å¤§é‡ä½¿ç”¨ try-catch ç»“æ„ï¼Œè¿™ä¼šå¯¼è‡´ç¼–è¯‘å™¨ç”Ÿæˆé¢å¤–ä»£ç ï¼Œå½±å“æ€§èƒ½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é‡å¤è·å– JSON èŠ‚ç‚¹&lt;/strong>ï¼šå¤šæ¬¡è®¿é—®ç›¸åŒçš„ JSON èŠ‚ç‚¹ï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œå­—ç¬¦ä¸²å“ˆå¸ŒæŸ¥æ‰¾ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="ä¼˜åŒ–æ–¹æ¡ˆ" class="relative group">ä¼˜åŒ–æ–¹æ¡ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bc%98%e5%8c%96%e6%96%b9%e6%a1%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å®æ–½äº†å¤šå±‚æ¬¡çš„ä¼˜åŒ–ç­–ç•¥ï¼š&lt;/p></description></item><item><title>TLSä¼šè¯æ¢å¤ï¼ˆSession Resumptionï¼‰</title><link>https://code-agree.github.io/blog/session_resumption/</link><pubDate>Fri, 07 Mar 2025 19:24:12 +0800</pubDate><guid>https://code-agree.github.io/blog/session_resumption/</guid><description>&lt;hr>
&lt;h2 id="1-ä¼šè¯æ¢å¤ç®€ä»‹" class="relative group">1. ä¼šè¯æ¢å¤ç®€ä»‹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e4%bc%9a%e8%af%9d%e6%81%a2%e5%a4%8d%e7%ae%80%e4%bb%8b" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="ä»€ä¹ˆæ˜¯ä¼šè¯æ¢å¤" class="relative group">ä»€ä¹ˆæ˜¯ä¼šè¯æ¢å¤ï¼Ÿ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bb%80%e4%b9%88%e6%98%af%e4%bc%9a%e8%af%9d%e6%81%a2%e5%a4%8d" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>TLSä¼šè¯æ¢å¤æ˜¯TLSåè®®çš„ä¸€é¡¹ä¼˜åŒ–ç‰¹æ€§ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŸºäºä¹‹å‰å»ºç«‹çš„å®‰å…¨ä¼šè¯å¿«é€Ÿæ¢å¤é€šä¿¡ï¼Œè·³è¿‡å®Œæ•´çš„æ¡æ‰‹è¿‡ç¨‹ã€‚åœ¨TLS 1.3ä¸­ï¼Œä¼šè¯æ¢å¤ä¸»è¦é€šè¿‡**PSKï¼ˆPre-Shared Keyï¼Œé¢„å…±äº«å¯†é’¥ï¼‰**æœºåˆ¶å®ç°ï¼Œè€Œåœ¨TLS 1.2åŠæ›´æ—©ç‰ˆæœ¬ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Session IDæˆ–Session Ticketå®ç°ã€‚&lt;/p>
&lt;h3 id="ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯æ¢å¤" class="relative group">ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯æ¢å¤ï¼Ÿ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e4%bc%9a%e8%af%9d%e6%81%a2%e5%a4%8d" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æ€§èƒ½ä¼˜åŒ–&lt;/strong>ï¼š
&lt;ul>
&lt;li>å®Œæ•´æ¡æ‰‹ï¼ˆTLS 1.3ï¼‰ï¼š1-RTT&lt;/li>
&lt;li>ä¼šè¯æ¢å¤ï¼š1-RTTï¼ˆæˆ–0-RTTï¼‰&lt;/li>
&lt;li>æ˜¾è‘—å‡å°‘è¿æ¥å»ºç«‹æ—¶é—´&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>èµ„æºèŠ‚çœ&lt;/strong>ï¼š
&lt;ul>
&lt;li>é™ä½CPUå¼€é”€ï¼ˆé¿å…é‡å¤å¯†é’¥äº¤æ¢ï¼‰&lt;/li>
&lt;li>å‡å°‘ç½‘ç»œå¸¦å®½å ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="2-tls-13ä¸­çš„ä¼šè¯æ¢å¤æœºåˆ¶" class="relative group">2. TLS 1.3ä¸­çš„ä¼šè¯æ¢å¤æœºåˆ¶ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-tls-13%e4%b8%ad%e7%9a%84%e4%bc%9a%e8%af%9d%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="å·¥ä½œæµç¨‹å¯¹æ¯”" class="relative group">å·¥ä½œæµç¨‹å¯¹æ¯” &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b%e5%af%b9%e6%af%94" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;h4 id="å®Œæ•´æ¡æ‰‹tls-13" class="relative group">å®Œæ•´æ¡æ‰‹ï¼ˆTLS 1.3ï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%ae%8c%e6%95%b4%e6%8f%a1%e6%89%8btls-13" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plaintext" data-lang="plaintext">&lt;span class="line">&lt;span class="cl">Client Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ClientHello |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |--------------------&amp;gt;|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ServerHello |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | EncryptedExt |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Certificate |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | CertVerify |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Finished |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |&amp;lt;--------------------|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Finished |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |--------------------&amp;gt;|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | NewSessionTicket |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |&amp;lt;--------------------|
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>RTTï¼š1æ¬¡å¾€è¿”&lt;/li>
&lt;li>æœåŠ¡å™¨åœ¨æ¡æ‰‹åå‘é€&lt;code>NewSessionTicket&lt;/code>ï¼ŒåŒ…å«PSKå’Œæœ‰æ•ˆæœŸä¿¡æ¯ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ä¼šè¯æ¢å¤1-rtt" class="relative group">ä¼šè¯æ¢å¤ï¼ˆ1-RTTï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bc%9a%e8%af%9d%e6%81%a2%e5%a4%8d1-rtt" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plaintext" data-lang="plaintext">&lt;span class="line">&lt;span class="cl">Client Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ClientHello |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | (with PSK) |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |--------------------&amp;gt;|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ServerHello |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Finished |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |&amp;lt;--------------------|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Finished |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |--------------------&amp;gt;|
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>RTTï¼š1æ¬¡å¾€è¿”&lt;/li>
&lt;li>å®¢æˆ·ç«¯ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„PSKç›´æ¥æ¢å¤ä¼šè¯ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="0-rttå¯é€‰" class="relative group">0-RTTï¼ˆå¯é€‰ï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#0-rtt%e5%8f%af%e9%80%89" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plaintext" data-lang="plaintext">&lt;span class="line">&lt;span class="cl">Client Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ClientHello |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | (with PSK + Early Data) |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |--------------------&amp;gt;|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ServerHello |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Finished |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |&amp;lt;--------------------|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | Finished |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |--------------------&amp;gt;|
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>RTTï¼š0æ¬¡å¾€è¿”ï¼ˆæ—©æœŸæ•°æ®éšé¦–æ¬¡è¯·æ±‚å‘é€ï¼‰&lt;/li>
&lt;li>æ³¨æ„ï¼š0-RTTæœ‰é‡æ”¾æ”»å‡»é£é™©ï¼Œä»…é€‚ç”¨äºå¹‚ç­‰è¯·æ±‚ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="3-å®ç°ç¤ºä¾‹åŸºäºpicotls" class="relative group">3. å®ç°ç¤ºä¾‹ï¼ˆåŸºäºpicotlsï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-%e5%ae%9e%e7%8e%b0%e7%a4%ba%e4%be%8b%e5%9f%ba%e4%ba%8epicotls" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="æ•°æ®ç»“æ„" class="relative group">æ•°æ®ç»“æ„ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">typedef&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ptls_iovec_t&lt;/span> &lt;span class="n">session_ticket&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ä¼šè¯ticketï¼ˆåŒ…å«PSKï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">ptls_save_ticket_t&lt;/span> &lt;span class="n">ticket_cb&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ticketä¿å­˜å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">is_resumption&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æ˜¯å¦æ¢å¤ä¼šè¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">time_t&lt;/span> &lt;span class="n">ticket_received_time&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ticketæ¥æ”¶æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="kt">tls_context_t&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¿å­˜ä¼šè¯ticket" class="relative group">ä¿å­˜ä¼šè¯Ticket &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bf%9d%e5%ad%98%e4%bc%9a%e8%af%9dticket" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">save_ticket_cb&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">ptls_save_ticket_t&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">ptls_t&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">tls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">ptls_iovec_t&lt;/span> &lt;span class="n">ticket&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">tls_context_t&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">ctx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">container_of&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">tls_context_t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ticket_cb&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡Šæ”¾æ—§ticket
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¿å­˜æ–°ticket
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ctx&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">malloc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// å†…å­˜åˆ†é…å¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">memcpy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ctx&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ctx&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">ticket_received_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">time&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å°è¯•ä¼šè¯æ¢å¤" class="relative group">å°è¯•ä¼šè¯æ¢å¤ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%b0%9d%e8%af%95%e4%bc%9a%e8%af%9d%e6%81%a2%e5%a4%8d" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">ptls_handshake_properties_t&lt;/span> &lt;span class="n">props&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls_ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ£€æŸ¥ticketæ˜¯å¦è¿‡æœŸï¼ˆå‡è®¾æœ‰æ•ˆæœŸ24å°æ—¶ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">time&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">NULL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls_ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ticket_received_time&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">24&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">3600&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">session_ticket&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls_ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">max_early_data_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">16384&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æ”¯æŒ0-RTT
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_info&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">resumption_attempted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">ptls_handshake&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="éªŒè¯æ¢å¤ç»“æœ" class="relative group">éªŒè¯æ¢å¤ç»“æœ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%aa%8c%e8%af%81%e6%81%a2%e5%a4%8d%e7%bb%93%e6%9e%9c" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_info&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">resumption_attempted&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_info&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">resumption_succeeded&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">ptls_is_psk_handshake&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">session_info&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">resumption_succeeded&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¢å¤å¤±è´¥ï¼Œæ¸…ç†ticket
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls_ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls_ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls_ctx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">session_ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="4-åœ¨è¿æ¥æ± ä¸­çš„åº”ç”¨" class="relative group">4. åœ¨è¿æ¥æ± ä¸­çš„åº”ç”¨ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#4-%e5%9c%a8%e8%bf%9e%e6%8e%a5%e6%b1%a0%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="åœºæ™¯" class="relative group">åœºæ™¯ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%9c%ba%e6%99%af" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>å¤ç”¨è¿æ¥&lt;/strong>ï¼šæ£€æŸ¥ticketæœ‰æ•ˆæ€§ï¼Œä¼˜å…ˆå°è¯•æ¢å¤ï¼Œå¤±è´¥åˆ™å®Œæ•´æ¡æ‰‹ã€‚&lt;/li>
&lt;li>&lt;strong>æ–°å»ºè¿æ¥&lt;/strong>ï¼šä½¿ç”¨å·²æœ‰ticketå°è¯•æ¢å¤ï¼Œä¿å­˜æ–°ticketã€‚&lt;/li>
&lt;li>&lt;strong>è¿æ¥ç»´æŠ¤&lt;/strong>ï¼šè·Ÿè¸ªticketæœ‰æ•ˆæœŸï¼Œæ¸…ç†è¿‡æœŸticketï¼Œç»Ÿè®¡æ¢å¤ç‡ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ç¤ºä¾‹é€»è¾‘" class="relative group">ç¤ºä¾‹é€»è¾‘ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e7%a4%ba%e4%be%8b%e9%80%bb%e8%be%91" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">ticket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">base&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nf">time&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">NULL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">pool&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">ticket_time&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">pool&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">ticket_lifetime&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å°è¯•æ¢å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">session_ticket&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pool&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">ticket&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">ptls_handshake&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nf">ptls_is_psk_handshake&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">resumption_success&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">resumption_fail&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ptls_handshake&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// å›é€€å®Œæ•´æ¡æ‰‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®Œæ•´æ¡æ‰‹å¹¶ä¿å­˜æ–°ticket
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">ptls_handshake&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">tls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="5-æ³¨æ„äº‹é¡¹" class="relative group">5. æ³¨æ„äº‹é¡¹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#5-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="å®‰å…¨æ€§" class="relative group">å®‰å…¨æ€§ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%ae%89%e5%85%a8%e6%80%a7" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æœ‰æ•ˆæœŸé™åˆ¶&lt;/strong>ï¼šticketé€šå¸¸æœ‰æ•ˆæ•°å°æ—¶ï¼Œç”±æœåŠ¡å™¨æŒ‡å®šã€‚&lt;/li>
&lt;li>&lt;strong>å­˜å‚¨å®‰å…¨&lt;/strong>ï¼šé¿å…æ˜æ–‡ä¿å­˜ticketï¼Œå»ºè®®åŠ å¯†å­˜å‚¨ã€‚&lt;/li>
&lt;li>&lt;strong>0-RTTé£é™©&lt;/strong>ï¼šé˜²èŒƒé‡æ”¾æ”»å‡»ï¼Œä»…ç”¨äºå®‰å…¨åœºæ™¯ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–" class="relative group">æ€§èƒ½ä¼˜åŒ– &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ticketç®¡ç†&lt;/strong>ï¼šé¿å…è¿‡åº¦ä¿å­˜ï¼Œå®šæœŸæ¸…ç†æ— æ•ˆticketã€‚&lt;/li>
&lt;li>&lt;strong>æœåŠ¡å™¨è´Ÿè½½&lt;/strong>ï¼šå‡å°‘é¢‘ç¹å‘é€&lt;code>NewSessionTicket&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>ç›‘æ§æŒ‡æ ‡&lt;/strong>ï¼šè®°å½•æ¢å¤æˆåŠŸç‡ï¼Œä¼˜åŒ–ç­–ç•¥ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="é”™è¯¯å¤„ç†" class="relative group">é”™è¯¯å¤„ç† &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>ä¼˜é›…é™çº§&lt;/strong>ï¼šæ¢å¤å¤±è´¥æ—¶åˆ‡æ¢å®Œæ•´æ¡æ‰‹ã€‚&lt;/li>
&lt;li>&lt;strong>æ—¥å¿—è®°å½•&lt;/strong>ï¼šä¿å­˜å¤±è´¥åŸå› ï¼ˆå¦‚ticketè¿‡æœŸæˆ–æ‹’ç»ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="6-æ€»ç»“" class="relative group">6. æ€»ç»“ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#6-%e6%80%bb%e7%bb%93" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>TLSä¼šè¯æ¢å¤é€šè¿‡PSKæœºåˆ¶æ˜¾è‘—æå‡è¿æ¥æ•ˆç‡ï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚è¿æ¥æ± ï¼‰ä¸­æ•ˆæœæ˜æ˜¾ã€‚æ­£ç¡®å®ç°éœ€è¦å¹³è¡¡å®‰å…¨æ€§ä¸æ€§èƒ½ï¼Œå…³æ³¨ticketç®¡ç†ã€é”™è¯¯å¤„ç†å’Œç›‘æ§ã€‚é€šè¿‡1-RTTæˆ–0-RTTï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯åœ¨æ¯«ç§’å†…æ¢å¤å®‰å…¨é€šä¿¡ï¼Œæ˜¯ç°ä»£ç½‘ç»œä¼˜åŒ–çš„å…³é”®æŠ€æœ¯ã€‚&lt;/p></description></item><item><title>ä½¿ç”¨ Tailscale å®ç° MacOS è®¾å¤‡è¿œç¨‹è¿æ¥æ•™ç¨‹</title><link>https://code-agree.github.io/blog/share_screen/</link><pubDate>Sun, 19 Jan 2025 11:15:08 +0800</pubDate><guid>https://code-agree.github.io/blog/share_screen/</guid><description>&lt;p>æˆ‘æ¥å¸®ä½ ç¼–å†™ä¸€ä»½è¯¦ç»†çš„æŠ€æœ¯æ•™ç¨‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ Tailscale åœ¨ MacOS è®¾å¤‡é—´å®ç°è¿œç¨‹è¿æ¥ã€‚&lt;/p>
&lt;h1 id="ä½¿ç”¨-tailscale-å®ç°-macos-è®¾å¤‡è¿œç¨‹è¿æ¥æ•™ç¨‹" class="relative group">ä½¿ç”¨ Tailscale å®ç° MacOS è®¾å¤‡è¿œç¨‹è¿æ¥æ•™ç¨‹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bd%bf%e7%94%a8-tailscale-%e5%ae%9e%e7%8e%b0-macos-%e8%ae%be%e5%a4%87%e8%bf%9c%e7%a8%8b%e8%bf%9e%e6%8e%a5%e6%95%99%e7%a8%8b" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="å‡†å¤‡å·¥ä½œ" class="relative group">å‡†å¤‡å·¥ä½œ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;ol>
&lt;li>ç¡®ä¿ä¸¤å° MacOS è®¾å¤‡éƒ½èƒ½æ­£å¸¸è®¿é—®äº’è”ç½‘&lt;/li>
&lt;li>å‡†å¤‡ä¸€ä¸ª Tailscale è´¦å·ï¼ˆå¯ä»¥ä½¿ç”¨ Googleã€GitHub ç­‰è´¦å·ç™»å½•ï¼‰&lt;/li>
&lt;/ol>
&lt;h2 id="è¯¦ç»†æ­¥éª¤" class="relative group">è¯¦ç»†æ­¥éª¤ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%af%a6%e7%bb%86%e6%ad%a5%e9%aa%a4" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="ç¬¬ä¸€æ­¥å®‰è£…-tailscale" class="relative group">ç¬¬ä¸€æ­¥ï¼šå®‰è£… Tailscale &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%ae%89%e8%a3%85-tailscale" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>åœ¨ä¸¤å° MacOS è®¾å¤‡ä¸Šåˆ†åˆ«å®‰è£… Tailscaleï¼š&lt;/p></description></item><item><title>å…±äº«å†…å­˜å¤šè¿›ç¨‹é€šä¿¡ä¸­çš„é¡µé¢åˆ‡æ¢åŒæ­¥é—®é¢˜åˆ†æä¸è§£å†³</title><link>https://code-agree.github.io/blog/fix_share_page_position/</link><pubDate>Fri, 17 Jan 2025 04:21:23 +0800</pubDate><guid>https://code-agree.github.io/blog/fix_share_page_position/</guid><description>&lt;h2 id="é—®é¢˜ç°è±¡" class="relative group">é—®é¢˜ç°è±¡ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%97%ae%e9%a2%98%e7%8e%b0%e8%b1%a1" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨å¤šè¿›ç¨‹å…±äº«å†…å­˜é€šä¿¡ä¸­ï¼Œå‘ç°è¯»å–è¿›ç¨‹å‡ºç°å¼‚å¸¸ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å†™å…¥è¿›ç¨‹ï¼ˆçº¿ç¨‹3002707ï¼‰æ­£å¸¸å†™å…¥æ•°æ®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¯»å–è¿›ç¨‹ï¼ˆçº¿ç¨‹3002791ï¼‰å¡åœ¨å›ºå®šä½ç½®ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>page: 0
write_pos: 134209160
read_pos: 134199368
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ol>
&lt;h2 id="é—®é¢˜å®šä½è¿‡ç¨‹" class="relative group">é—®é¢˜å®šä½è¿‡ç¨‹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%97%ae%e9%a2%98%e5%ae%9a%e4%bd%8d%e8%bf%87%e7%a8%8b" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="1-åˆæ­¥åˆ†æ" class="relative group">1. åˆæ­¥åˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e5%88%9d%e6%ad%a5%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>é¦–å…ˆè§‚å¯Ÿåˆ°ä¸€ä¸ªå…³é”®ç°è±¡ï¼š&lt;/p>
&lt;ul>
&lt;li>Binanceçš„è¯»å†™æ­£å¸¸&lt;/li>
&lt;li>Bitgetçš„è¯»å–å¡åœ¨å›ºå®šä½ç½®&lt;/li>
&lt;li>ä¸¤ä¸ªäº¤æ˜“æ‰€ä½¿ç”¨ç›¸åŒçš„å…±äº«å†…å­˜æœºåˆ¶&lt;/li>
&lt;/ul>
&lt;h3 id="2-ä»£ç åˆ†æ" class="relative group">2. ä»£ç åˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e4%bb%a3%e7%a0%81%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>æ£€æŸ¥å…±äº«å†…å­˜ç®¡ç†çš„æ ¸å¿ƒç±»ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>å†™å…¥æœºåˆ¶&lt;/strong>ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">bool&lt;/span> &lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">TypedFrame&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;amp;&lt;/span> &lt;span class="n">frame&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">write_pos&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">frame_size&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">page_size_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">switchToNextPage&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_pos&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">current_write_pos_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">size_t&lt;/span>&lt;span class="o">&amp;gt;*&lt;/span> &lt;span class="n">shared_write_pos&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">reinterpret_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">size_t&lt;/span>&lt;span class="o">&amp;gt;*&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current_page_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getData&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shared_write_pos&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">store&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">write_pos&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">frame_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_release&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;strong>é¡µé¢åˆ‡æ¢&lt;/strong>ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">Journal&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">switchToNextPage&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_page_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">page_engine_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getNextPage&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_write_pos_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">store&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Page&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">PageEngine&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">getNextPage&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_page_index_&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">current_page_index_&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">pages_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">addNewPage&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">pages_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">current_page_index_&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-å…³é”®å‘ç°" class="relative group">3. å…³é”®å‘ç° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-%e5%85%b3%e9%94%ae%e5%8f%91%e7%8e%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>é€šè¿‡åˆ†æå‘ç°ï¼š&lt;/p></description></item><item><title>Solana_monitor</title><link>https://code-agree.github.io/blog/solana_monitor/</link><pubDate>Fri, 20 Dec 2024 03:08:38 +0800</pubDate><guid>https://code-agree.github.io/blog/solana_monitor/</guid><description>&lt;h1 id="solanaé“¾ä¸Šäº¤æ˜“ç›‘æ§æœ€ä½³å®è·µä»logssubscribeåˆ°å…¨æ–¹ä½ç›‘æ§" class="relative group">Solanaé“¾ä¸Šäº¤æ˜“ç›‘æ§æœ€ä½³å®è·µï¼šä»logsSubscribeåˆ°å…¨æ–¹ä½ç›‘æ§ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#solana%e9%93%be%e4%b8%8a%e4%ba%a4%e6%98%93%e7%9b%91%e6%8e%a7%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%e4%bb%8elogssubscribe%e5%88%b0%e5%85%a8%e6%96%b9%e4%bd%8d%e7%9b%91%e6%8e%a7" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="èƒŒæ™¯ä»‹ç»" class="relative group">èƒŒæ™¯ä»‹ç» &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%83%8c%e6%99%af%e4%bb%8b%e7%bb%8d" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨Solanaé“¾ä¸Šå¼€å‘ä¸­ï¼Œå®æ—¶ç›‘æ§ç‰¹å®šè´¦æˆ·çš„äº¤æ˜“æ´»åŠ¨æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œç‰¹åˆ«æ˜¯åœ¨æ„å»ºè·Ÿå•æœºå™¨äººè¿™ç±»å¯¹æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨åœºæ™¯ä¸­ã€‚æœ€åˆï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨Solanaæä¾›çš„&lt;code>logsSubscribe&lt;/code> WebSocket APIæ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥æ˜¯æœ€ç›´æ¥çš„è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å‘ç°è¿™ç§æ–¹æ¡ˆå­˜åœ¨ä¸€äº›é™åˆ¶å’Œé—®é¢˜ã€‚&lt;/p>
&lt;h2 id="é—®é¢˜å‘ç°" class="relative group">é—®é¢˜å‘ç° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%97%ae%e9%a2%98%e5%8f%91%e7%8e%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨ä½¿ç”¨&lt;code>logsSubscribe&lt;/code>è¿›è¡Œè´¦æˆ·ç›‘æ§æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªå…³é”®é—®é¢˜ï¼šæŸäº›ç¡®å®å‘ç”Ÿçš„äº¤æ˜“å¹¶æ²¡æœ‰è¢«æˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿæ•è·åˆ°ã€‚è¿™ä¸ªé—®é¢˜çš„å‘ç°ä¿ƒä½¿æˆ‘ä»¬æ·±å…¥ç ”ç©¶Solanaçš„äº¤æ˜“æ—¥å¿—æœºåˆ¶ï¼Œå¹¶æœ€ç»ˆè®¾è®¡äº†ä¸€ä¸ªæ›´å…¨é¢çš„ç›‘æ§æ–¹æ¡ˆã€‚&lt;/p>
&lt;h3 id="ä¸ºä»€ä¹ˆä¼šé—æ¼äº¤æ˜“" class="relative group">ä¸ºä»€ä¹ˆä¼šé—æ¼äº¤æ˜“ï¼Ÿ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e4%bc%9a%e9%81%97%e6%bc%8f%e4%ba%a4%e6%98%93" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>
&lt;p>æ—¥å¿—è®°å½•æœºåˆ¶çš„å±€é™æ€§&lt;/p>
&lt;ul>
&lt;li>ç¨‹åºå¯èƒ½ä¸ä¼šåœ¨æ—¥å¿—ä¸­æ˜ç¡®è®°å½•æ‰€æœ‰æ¶‰åŠçš„è´¦æˆ·åœ°å€&lt;/li>
&lt;li>äº¤æ˜“å¯èƒ½ä½¿ç”¨äº†PDA(Program Derived Address)æˆ–å…¶ä»–æ´¾ç”Ÿåœ°å€&lt;/li>
&lt;li>æŸäº›DEXé‡‡ç”¨å†…éƒ¨è´¦æˆ·æ˜ å°„ï¼Œè€Œä¸æ˜¯ç›´æ¥è®°å½•ç”¨æˆ·åœ°å€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>mentions&lt;/code>è¿‡æ»¤å™¨çš„é™åˆ¶&lt;/p>
&lt;ul>
&lt;li>åªèƒ½æ•è·åœ¨æ—¥å¿—ä¸­æ˜ç¡®æåˆ°ç›®æ ‡åœ°å€çš„äº¤æ˜“&lt;/li>
&lt;li>æ— æ³•æ•è·é€šè¿‡é—´æ¥æ–¹å¼å½±å“ç›®æ ‡è´¦æˆ·çš„äº¤æ˜“&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="è§£å†³æ–¹æ¡ˆ" class="relative group">è§£å†³æ–¹æ¡ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªå¤šç»´åº¦ç›‘æ§æ–¹æ¡ˆï¼Œé€šè¿‡ç»„åˆå¤šç§è®¢é˜…æ–¹å¼æ¥ç¡®ä¿ä¸ä¼šé—æ¼ä»»ä½•ç›¸å…³äº¤æ˜“ã€‚&lt;/p></description></item><item><title>Solanaé“¾ä¸Šäº¤æ˜“ç›‘æ§æŠ€æœ¯åˆ†æ</title><link>https://code-agree.github.io/blog/solana/</link><pubDate>Thu, 19 Dec 2024 01:32:32 +0800</pubDate><guid>https://code-agree.github.io/blog/solana/</guid><description>&lt;h1 id="solanaé“¾ä¸Šäº¤æ˜“ç›‘æ§æŠ€æœ¯åˆ†æ" class="relative group">Solanaé“¾ä¸Šäº¤æ˜“ç›‘æ§æŠ€æœ¯åˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#solana%e9%93%be%e4%b8%8a%e4%ba%a4%e6%98%93%e7%9b%91%e6%8e%a7%e6%8a%80%e6%9c%af%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="1-solana-dex-äº¤æ˜“å½¢å¼" class="relative group">1. Solana DEX äº¤æ˜“å½¢å¼ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-solana-dex-%e4%ba%a4%e6%98%93%e5%bd%a2%e5%bc%8f" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="11-ç›´æ¥-dex-äº¤æ˜“" class="relative group">1.1 ç›´æ¥ DEX äº¤æ˜“ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e7%9b%b4%e6%8e%a5-dex-%e4%ba%a4%e6%98%93" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>ç”¨æˆ·ç›´æ¥ä¸ DEX åˆçº¦äº¤äº’ï¼Œäº¤æ˜“æµç¨‹ç®€å•ç›´æ¥ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>ç”¨æˆ·é’±åŒ… -&amp;gt; DEXç¨‹åº (å¦‚Raydium/Orca) -&amp;gt; Token Program
&lt;/code>&lt;/pre>&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>äº¤æ˜“æ—¥å¿—ç®€æ´ï¼Œä¸»è¦åŒ…å«å•ä¸ª DEX ç¨‹åºçš„è°ƒç”¨&lt;/li>
&lt;li>å®¹æ˜“è¯†åˆ«äº¤æ˜“å¹³å°å’Œäº¤æ˜“å¯¹&lt;/li>
&lt;li>Token Program çš„ transfer æŒ‡ä»¤è¾ƒå°‘&lt;/li>
&lt;/ul>
&lt;h3 id="12-èšåˆå™¨äº¤æ˜“jupiter" class="relative group">1.2 èšåˆå™¨äº¤æ˜“ï¼ˆJupiterï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#12-%e8%81%9a%e5%90%88%e5%99%a8%e4%ba%a4%e6%98%93jupiter" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>é€šè¿‡èšåˆå™¨è·¯ç”±åˆ°å•ä¸ªæˆ–å¤šä¸ª DEXã€‚&lt;/p></description></item><item><title>WebSocketæ¶ˆæ¯å¤„ç†çº¿ç¨‹CPUäº²å’Œæ€§å¯¼è‡´çš„æ¶ˆæ¯é˜»å¡æ•…éšœåˆ†æ</title><link>https://code-agree.github.io/blog/message_overstocked/</link><pubDate>Fri, 13 Dec 2024 05:15:51 +0800</pubDate><guid>https://code-agree.github.io/blog/message_overstocked/</guid><description>&lt;h2 id="ä¸€æ•…éšœç°è±¡" class="relative group">ä¸€ã€æ•…éšœç°è±¡ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%80%e6%95%85%e9%9a%9c%e7%8e%b0%e8%b1%a1" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="11-å•endpointæ¨¡å¼æ•…éšœ" class="relative group">1.1 å•endpointæ¨¡å¼æ•…éšœ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e5%8d%95endpoint%e6%a8%a1%e5%bc%8f%e6%95%85%e9%9a%9c" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>å•ä¸ªWebSocketè¿æ¥æ—¶æ¶ˆæ¯æ¥æ”¶å®Œå…¨é˜»å¡&lt;/li>
&lt;li>æ—¥å¿—æ˜¾ç¤ºæ¶ˆæ¯å¤„ç†çº¿ç¨‹å¯åŠ¨åæ— æ³•æ¥æ”¶æ–°æ¶ˆæ¯&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code class="language-log" data-lang="log">[2024-12-12 20:31:29.455] [error] [setThreadAffinity] Error calling pthread_setaffinity_np: 22
[2024-12-12 20:31:29.697] [info] Message thread started for endpoint: OkxPublic
// ä¹‹åæ— æ¶ˆæ¯æ¥æ”¶æ—¥å¿—
&lt;/code>&lt;/pre>&lt;h3 id="12-å¤šendpointæ¨¡å¼éƒ¨åˆ†æ­£å¸¸" class="relative group">1.2 å¤šendpointæ¨¡å¼éƒ¨åˆ†æ­£å¸¸ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#12-%e5%a4%9aendpoint%e6%a8%a1%e5%bc%8f%e9%83%a8%e5%88%86%e6%ad%a3%e5%b8%b8" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>å¤šä¸ªWebSocketè¿æ¥æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ­£å¸¸æ¥æ”¶æ¶ˆæ¯&lt;/li>
&lt;li>æ—¥å¿—æ˜¾ç¤ºæ¶ˆæ¯å¤„ç†æƒ…å†µï¼š&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code class="language-log" data-lang="log">[20:54:50.542] [thread 91374] Processing message for OkxPublic
[20:54:50.640] [thread 91374] Processing message for OkxPublic
// åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æŒç»­å¤„ç†æ¶ˆæ¯
&lt;/code>&lt;/pre>&lt;h2 id="äºŒç³»ç»Ÿæ¶æ„åˆ†æ" class="relative group">äºŒã€ç³»ç»Ÿæ¶æ„åˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%ba%8c%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="21-websocketæ¶ˆæ¯æ¥æ”¶æœºåˆ¶" class="relative group">2.1 WebSocketæ¶ˆæ¯æ¥æ”¶æœºåˆ¶ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-websocket%e6%b6%88%e6%81%af%e6%8e%a5%e6%94%b6%e6%9c%ba%e5%88%b6" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">WebSocketClient&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">receiveMessages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">MessageHandler&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">true&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 1. é˜»å¡å¼æ¥æ”¶WebSocketæ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ws_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">receiveFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 2. åŒæ­¥å›è°ƒå¤„ç†æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">exception&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="22-å…³é”®æŠ€æœ¯ç‚¹" class="relative group">2.2 å…³é”®æŠ€æœ¯ç‚¹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#22-%e5%85%b3%e9%94%ae%e6%8a%80%e6%9c%af%e7%82%b9" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>é˜»å¡å¼WebSocketæ¥æ”¶&lt;/strong>&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„å¤§ååé‡è®¢å•å‘é€æœºåˆ¶</title><link>https://code-agree.github.io/blog/sendingorder/</link><pubDate>Thu, 12 Dec 2024 02:17:32 +0800</pubDate><guid>https://code-agree.github.io/blog/sendingorder/</guid><description>&lt;h3 id="1-éœ€æ±‚èƒŒæ™¯" class="relative group">1. éœ€æ±‚èƒŒæ™¯ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e9%9c%80%e6%b1%82%e8%83%8c%e6%99%af" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªå…¸å‹åœºæ™¯ï¼šéœ€è¦åŒæ—¶å¤„ç†ä¸‰ä¸ªå…³è”è®¢å•ï¼ˆä¸‰è§’å¥—åˆ©ï¼‰ã€‚è¿™äº›è®¢å•å¿…é¡»å‡ ä¹åŒæ—¶å‘å‡ºä»¥ç¡®ä¿å¥—åˆ©çš„æœ‰æ•ˆæ€§ã€‚&lt;/p>
&lt;p>å…³é”®æŒ‘æˆ˜ï¼š&lt;/p>
&lt;ul>
&lt;li>è®¢å•å¿…é¡»åŒæ—¶æˆ–å‡ ä¹åŒæ—¶å‘å‡º&lt;/li>
&lt;li>ç³»ç»Ÿéœ€è¦å¤„ç†é«˜å¹¶å‘çš„è®¢å•ç»„&lt;/li>
&lt;li>éœ€è¦ä¿è¯è®¢å•å¤„ç†çš„ç¨³å®šæ€§å’Œå¯é æ€§&lt;/li>
&lt;/ul>
&lt;h3 id="2-å½“å‰ä½¿ç”¨çš„ä¸¤ç§å¤„ç†è®¢å•çš„æœºåˆ¶" class="relative group">2. å½“å‰ä½¿ç”¨çš„ä¸¤ç§å¤„ç†è®¢å•çš„æœºåˆ¶ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e5%bd%93%e5%89%8d%e4%bd%bf%e7%94%a8%e7%9a%84%e4%b8%a4%e7%a7%8d%e5%a4%84%e7%90%86%e8%ae%a2%e5%8d%95%e7%9a%84%e6%9c%ba%e5%88%b6" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æ— é”é˜Ÿåˆ—æœºåˆ¶&lt;/strong>
&lt;ul>
&lt;li>è®¢å•ç”Ÿæˆåè¿›å…¥ä¸€ä¸ªæ— é”é˜Ÿåˆ—&lt;/li>
&lt;li>å¤šä¸ªçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–è®¢å•è¿›è¡Œå¤„ç†&lt;/li>
&lt;li>è®¢å•çš„å‘é€é€šè¿‡RestClientè¿›è¡Œï¼ŒRestClientè´Ÿè´£ç®¡ç†HTTPè¿æ¥æ± å¹¶å‘é€è¯·æ±‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>åˆ†ç‰‡æœºåˆ¶&lt;/strong>
&lt;ul>
&lt;li>è®¢å•ç”Ÿæˆåæ ¹æ®æŸç§è§„åˆ™åˆ†é…åˆ°ä¸åŒçš„åˆ†ç‰‡&lt;/li>
&lt;li>æ¯ä¸ªåˆ†ç‰‡ç”±å›ºå®šçš„çº¿ç¨‹å¤„ç†&lt;/li>
&lt;li>åŒä¸€ç»„çš„è®¢å•è¢«åˆ†é…åˆ°åŒä¸€ä¸ªåˆ†ç‰‡ï¼Œç¡®ä¿ç»„å†…è®¢å•çš„å¤„ç†ä¸€è‡´æ€§&lt;/li>
&lt;li>RestClientåŒæ ·è´Ÿè´£è®¢å•çš„å‘é€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">OrderShard&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="nc">OrderGroup&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">groupId&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">timestamp&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Order&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">orders&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">OrderGroup&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">orderQueue_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span> &lt;span class="n">mutex_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">condition_variable&lt;/span> &lt;span class="n">cv_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RestClient&lt;/span> &lt;span class="n">restClient_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="n">addOrderGroup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">OrderGroup&lt;/span> &lt;span class="n">group&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">lock_guard&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mutex_&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">orderQueue_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">move&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">group&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cv_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">notify_one&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">processOrders&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OrderGroup&lt;/span> &lt;span class="n">group&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mutex_&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cv_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">wait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="n">orderQueue_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="n">running_&lt;/span>&lt;span class="p">;&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">running_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">group&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">move&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">orderQueue_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">front&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">orderQueue_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ‰¹é‡å‘é€åŒç»„è®¢å•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">sendOrderGroup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">group&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="n">sendOrderGroup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">OrderGroup&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">group&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥å‘é€ç»„å†…æ‰€æœ‰è®¢å•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">auto&lt;/span> &lt;span class="n">conn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restClient_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getConnection&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nl">order&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">group&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">sendOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-ä¸¤ç§æœºåˆ¶çš„æ‰§è¡Œç»“æœåˆ†æ" class="relative group">3. ä¸¤ç§æœºåˆ¶çš„æ‰§è¡Œç»“æœåˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-%e4%b8%a4%e7%a7%8d%e6%9c%ba%e5%88%b6%e7%9a%84%e6%89%a7%e8%a1%8c%e7%bb%93%e6%9e%9c%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æ— é”é˜Ÿåˆ—æœºåˆ¶&lt;/strong>
&lt;ul>
&lt;li>æ—¥å¿—æ˜¾ç¤ºç»„å†…è®¢å•çš„å‘é€æ—¶é—´å·®è¾ƒå¤§ï¼Œé€šå¸¸åœ¨180-220msä¹‹é—´&lt;/li>
&lt;li>å­˜åœ¨è¾ƒå¤§çš„å»¶è¿Ÿæ³¢åŠ¨ï¼Œéƒ¨åˆ†ç»„çš„æœ€å¤§æ—¶é—´å·®è¶…è¿‡1000ms&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>æ€»è®¢å•ç»„æ•°: 164
å­˜åœ¨æ—¶é—´å·®çš„ç»„æ•°: 161
æœ€å¤§æ—¶é—´å·®: 2961.000ms
å¹³å‡æ—¶é—´å·®: 308.851ms
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>
&lt;p>&lt;strong>åˆ†ç‰‡æœºåˆ¶&lt;/strong>&lt;/p></description></item><item><title>é«˜æ€§èƒ½è®¢å•æ‰§è¡Œç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ</title><link>https://code-agree.github.io/blog/batch_order/</link><pubDate>Fri, 06 Dec 2024 17:45:16 +0800</pubDate><guid>https://code-agree.github.io/blog/batch_order/</guid><description>&lt;h2 id="1-èƒŒæ™¯é—®é¢˜" class="relative group">1. èƒŒæ™¯é—®é¢˜ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e8%83%8c%e6%99%af%e9%97%ae%e9%a2%98" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="11-æ€§èƒ½æŒ‘æˆ˜" class="relative group">1.1 æ€§èƒ½æŒ‘æˆ˜ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e6%80%a7%e8%83%bd%e6%8c%91%e6%88%98" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>é«˜ååé‡è®¢å•å¤„ç†éœ€æ±‚&lt;/li>
&lt;li>æ¯ä¸ªè®¢å•éƒ½éœ€è¦ HTTP è¯·æ±‚&lt;/li>
&lt;li>JWT Token ç”Ÿæˆå¼€é”€å¤§&lt;/li>
&lt;li>ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿ&lt;/li>
&lt;/ul>
&lt;h3 id="12-ä¸»è¦ç—›ç‚¹" class="relative group">1.2 ä¸»è¦ç—›ç‚¹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#12-%e4%b8%bb%e8%a6%81%e7%97%9b%e7%82%b9" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>å•ä¸ªè®¢å•å‘é€é€ æˆç½‘ç»œè¯·æ±‚è¿‡å¤š&lt;/li>
&lt;li>JWT Token é¢‘ç¹ç”Ÿæˆæµªè´¹èµ„æº&lt;/li>
&lt;li>å¤§é‡è®¢å•å¹¶å‘å¯èƒ½å¯¼è‡´ç³»ç»Ÿç“¶é¢ˆ&lt;/li>
&lt;/ul>
&lt;h2 id="2-è§£å†³æ–¹æ¡ˆ" class="relative group">2. è§£å†³æ–¹æ¡ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="21-jwt-token-ç¼“å­˜æœºåˆ¶" class="relative group">2.1 JWT Token ç¼“å­˜æœºåˆ¶ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-jwt-token-%e7%bc%93%e5%ad%98%e6%9c%ba%e5%88%b6" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">RestClient&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="k">constexpr&lt;/span> &lt;span class="k">auto&lt;/span> &lt;span class="n">JWT_REFRESH_INTERVAL&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">chrono&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">seconds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// é¢„ç•™åˆ·æ–°çª—å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">getOrCreateJWT&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">uri&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">chrono&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">steady_clock&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">expiryTime&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">token&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generateJWT&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uri&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">expiryTime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">JWT_REFRESH_INTERVAL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>ä¼˜ç‚¹&lt;/strong>ï¼š&lt;/p></description></item><item><title>é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹ï¼šio_uring ä¸å†…å­˜ä¼˜åŒ–æŠ€æœ¯è¯¦è§£</title><link>https://code-agree.github.io/blog/io_uring/</link><pubDate>Fri, 06 Dec 2024 06:04:25 +0800</pubDate><guid>https://code-agree.github.io/blog/io_uring/</guid><description>&lt;h2 id="0-å†…å­˜ç®¡ç†ä¼˜åŒ–" class="relative group">0. å†…å­˜ç®¡ç†ä¼˜åŒ– &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#0-%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86%e4%bc%98%e5%8c%96" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="01-å¤§é¡µå†…å­˜-huge-pages" class="relative group">0.1 å¤§é¡µå†…å­˜ (Huge Pages) &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#01-%e5%a4%a7%e9%a1%b5%e5%86%85%e5%ad%98-huge-pages" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>å¤§é¡µå†…å­˜æ˜¯ä¸€ç§å†…å­˜ç®¡ç†ä¼˜åŒ–æŠ€æœ¯ï¼Œä¸»è¦ä¼˜åŠ¿ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡å°‘ TLB (Translation Lookaside Buffer) ç¼ºå¤±&lt;/li>
&lt;li>å‡å°‘é¡µè¡¨é¡¹æ•°é‡&lt;/li>
&lt;li>æé«˜å†…å­˜è®¿é—®æ•ˆç‡&lt;/li>
&lt;/ul>
&lt;p>ç³»ç»Ÿé…ç½®å’Œæ£€æŸ¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ£€æŸ¥ç³»ç»Ÿå¤§é¡µé…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat /proc/meminfo &lt;span class="p">|&lt;/span> grep Huge
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é…ç½®å¤§é¡µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">20&lt;/span> &amp;gt; /proc/sys/vm/nr_hugepages &lt;span class="c1"># åˆ†é…20ä¸ªå¤§é¡µ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="02-å†…å­˜é”å®š-memory-locking" class="relative group">0.2 å†…å­˜é”å®š (Memory Locking) &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#02-%e5%86%85%e5%ad%98%e9%94%81%e5%ae%9a-memory-locking" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>é˜²æ­¢å†…å­˜è¢«äº¤æ¢åˆ°ç£ç›˜ï¼Œç¡®ä¿æ•°æ®å§‹ç»ˆåœ¨ç‰©ç†å†…å­˜ä¸­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ£€æŸ¥å†…å­˜é”å®šé™åˆ¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">ulimit&lt;/span> -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿®æ”¹é™åˆ¶ï¼ˆéœ€è¦rootæƒé™ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;* soft memlock unlimited&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/security/limits.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="03-å†…å­˜ä¼˜åŒ–å®ç°" class="relative group">0.3 å†…å­˜ä¼˜åŒ–å®ç° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#03-%e5%86%85%e5%ad%98%e4%bc%98%e5%8c%96%e5%ae%9e%e7%8e%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">IOBuffer&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">explicit&lt;/span> &lt;span class="nf">IOBuffer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 1. å°è¯•ä½¿ç”¨å¤§é¡µå†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">static_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="o">*&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mmap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">nullptr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PROT_READ&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">PROT_WRITE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MAP_PRIVATE&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">MAP_ANONYMOUS&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">MAP_HUGETLB&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">MAP_FAILED&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 2. å›é€€åˆ°æ™®é€šå†…å­˜ + é¢„å¡«å……
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">static_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="o">*&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mmap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">nullptr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PROT_READ&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">PROT_WRITE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MAP_PRIVATE&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">MAP_ANONYMOUS&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">MAP_POPULATE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">MAP_FAILED&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">runtime_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to allocate memory&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 3. å°è¯•é”å®šå†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">mlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LOG_WARN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to lock memory: {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">strerror&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">errno&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">~&lt;/span>&lt;span class="n">IOBuffer&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">MAP_FAILED&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">nullptr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">munlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">munmap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="1-io_uring-å¤šè·¯-io-ä¼˜åŠ¿" class="relative group">1. io_uring å¤šè·¯ I/O ä¼˜åŠ¿ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-io_uring-%e5%a4%9a%e8%b7%af-io-%e4%bc%98%e5%8a%bf" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="11-ä¼ ç»Ÿ-io-æ¨¡å‹çš„é—®é¢˜" class="relative group">1.1 ä¼ ç»Ÿ I/O æ¨¡å‹çš„é—®é¢˜ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e4%bc%a0%e7%bb%9f-io-%e6%a8%a1%e5%9e%8b%e7%9a%84%e9%97%ae%e9%a2%98" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä¼ ç»Ÿ epoll æ¨¡å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">epoll_fd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">epoll_create1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">epoll_event&lt;/span> &lt;span class="n">events&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">MAX_EVENTS&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ¯ä¸ª I/O æ“ä½œéƒ½éœ€è¦ç³»ç»Ÿè°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// ç³»ç»Ÿè°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// ç³»ç»Ÿè°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">epoll_wait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">epoll_fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">events&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">MAX_EVENTS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// ç³»ç»Ÿè°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é—®é¢˜ï¼š&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“åœºæ™¯ä¸‹çš„å¤šWSè¿æ¥ä½å»¶æ—¶æ–¹æ¡ˆè®¾è®¡</title><link>https://code-agree.github.io/blog/multiquotedata/</link><pubDate>Tue, 03 Dec 2024 01:01:26 +0800</pubDate><guid>https://code-agree.github.io/blog/multiquotedata/</guid><description>&lt;h2 id="1-ä¸šåŠ¡èƒŒæ™¯ä¸æŒ‘æˆ˜" class="relative group">1. ä¸šåŠ¡èƒŒæ™¯ä¸æŒ‘æˆ˜ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e4%b8%9a%e5%8a%a1%e8%83%8c%e6%99%af%e4%b8%8e%e6%8c%91%e6%88%98" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­ï¼Œéœ€è¦åŒæ—¶ç»´æŠ¤å¤šä¸ªWebSocketè¿æ¥ä»¥è®¢é˜…ä¸åŒäº¤æ˜“æ‰€çš„è¡Œæƒ…æ•°æ®ã€‚ä¸»è¦æŒ‘æˆ˜åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>éœ€è¦å¤„ç†å¤šä¸ªäº¤æ˜“æ‰€çš„å¹¶å‘è¿æ¥&lt;/li>
&lt;li>å¯¹æ¶ˆæ¯å¤„ç†å»¶è¿Ÿæœ‰ä¸¥æ ¼è¦æ±‚&lt;/li>
&lt;li>éœ€è¦ä¿è¯æ•°æ®å¤„ç†çš„ç¨³å®šæ€§&lt;/li>
&lt;li>ç³»ç»Ÿèµ„æºï¼ˆCPUã€å†…å­˜ï¼‰çš„é«˜æ•ˆåˆ©ç”¨&lt;/li>
&lt;/ul>
&lt;h2 id="2-ä¼ ç»Ÿæ–¹æ¡ˆçš„å±€é™" class="relative group">2. ä¼ ç»Ÿæ–¹æ¡ˆçš„å±€é™ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e4%bc%a0%e7%bb%9f%e6%96%b9%e6%a1%88%e7%9a%84%e5%b1%80%e9%99%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="21-ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ" class="relative group">2.1 ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-%e4%bc%a0%e7%bb%9f%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e6%96%b9%e6%a1%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å¸¸è§çš„æ¶ˆæ¯å¤„ç†æµç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">WebSocketæ¥æ”¶&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="err">æ¶ˆæ¯é˜Ÿåˆ—&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="err">å¤„ç†çº¿ç¨‹æ± &lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="err">ä¸šåŠ¡å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å­˜åœ¨çš„é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¶ˆæ¯ç»è¿‡é˜Ÿåˆ—å¸¦æ¥é¢å¤–å»¶è¿Ÿ&lt;/li>
&lt;li>çº¿ç¨‹åˆ‡æ¢å¼€é”€å¤§&lt;/li>
&lt;li>å†…å­˜æ‹·è´æ¬¡æ•°å¤š&lt;/li>
&lt;li>èµ„æºç«äº‰å¯¼è‡´æ€§èƒ½ä¸ç¨³å®š&lt;/li>
&lt;/ul>
&lt;h2 id="3-ä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡" class="relative group">3. ä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-%e4%bc%98%e5%8c%96%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="31-æ ¸å¿ƒè®¾è®¡ç†å¿µ" class="relative group">3.1 æ ¸å¿ƒè®¾è®¡ç†å¿µ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#31-%e6%a0%b8%e5%bf%83%e8%ae%be%e8%ae%a1%e7%90%86%e5%bf%b5" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>é›¶æ‹·è´æ•°æ®å¤„ç†&lt;/li>
&lt;li>CPUäº²å’Œæ€§ç»‘å®š&lt;/li>
&lt;li>é¢„åˆ†é…å†…å­˜&lt;/li>
&lt;li>æ¯ä¸ªè¿æ¥ç‹¬ç«‹å¤„ç†&lt;/li>
&lt;/ol>
&lt;h3 id="32-å…³é”®ç»„ä»¶è®¾è®¡" class="relative group">3.2 å…³é”®ç»„ä»¶è®¾è®¡ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#32-%e5%85%b3%e9%94%ae%e7%bb%84%e4%bb%b6%e8%ae%be%e8%ae%a1" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">ConnectionContext&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¿æ¥åŸºç¡€ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">WebSocketClient&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">endpoint_name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ€§èƒ½ä¼˜åŒ–ç›¸å…³
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">cpu_core&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">};&lt;/span> &lt;span class="c1">// CPUæ ¸å¿ƒç»‘å®š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">direct_buffer&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="k">nullptr&lt;/span>&lt;span class="p">};&lt;/span> &lt;span class="c1">// é¢„åˆ†é…ç¼“å†²åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="k">constexpr&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">BUFFER_SIZE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">64&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">MessageProcessor&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">dedicated_processor&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èµ„æºç®¡ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="n">ConnectionContext&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">direct_buffer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">munlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">direct_buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BUFFER_SIZE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">munmap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">direct_buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BUFFER_SIZE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç¦ç”¨æ‹·è´ä»¥ä¿è¯èµ„æºå®‰å…¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ConnectionContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">ConnectionContext&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">delete&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ConnectionContext&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="k">operator&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">ConnectionContext&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">delete&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="33-ä¼˜åŒ–ç»†èŠ‚" class="relative group">3.3 ä¼˜åŒ–ç»†èŠ‚ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#33-%e4%bc%98%e5%8c%96%e7%bb%86%e8%8a%82" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>å†…å­˜ç®¡ç†ä¼˜åŒ–&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä½¿ç”¨å¤§é¡µå†…å­˜å’Œå†…å­˜é”å®š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">buffer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mmap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">nullptr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BUFFER_SIZE&lt;/span>&lt;span class="p">,&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PROT_READ&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">PROT_WRITE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MAP_PRIVATE&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">MAP_ANONYMOUS&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BUFFER_SIZE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŸå› ï¼š&lt;/p></description></item><item><title>ä»˜é¹HSBC</title><link>https://code-agree.github.io/blog/fupeng/</link><pubDate>Sun, 01 Dec 2024 21:06:34 +0800</pubDate><guid>https://code-agree.github.io/blog/fupeng/</guid><description>&lt;p>HSBC é€Ÿè®°
æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’&lt;/p>
&lt;p>çºè¶Šä¸–å®¶ Â· è‡»äº«æ²™é¾™ ä¸Šæµ·ç«™&lt;/p>
&lt;p>ï¼ˆé€Ÿè®°ç¨¿ï¼‰&lt;/p>
&lt;p>æ—¶é—´ï¼š2024 å¹´ 11 æœˆ 24 æ—¥&lt;/p>
&lt;p>åœ°ç‚¹ï¼šä¸Šæµ·æµ¦ä¸œæ–‡åä¸œæ–¹é…’åº— LG1 å±‚ä¸œæ–¹å…&lt;/p>
&lt;p>ä¸»æŒäººï¼šå¥³å£«ä»¬ï¼Œå…ˆç”Ÿä»¬ï¼Œå„ä½å°Šæ•¬çš„æ¥å®¾ï¼Œæˆ‘æ˜¯é™ˆä½³æ˜Šï¼ˆéŸ³ï¼‰ï¼Œæˆ‘æ˜¯æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’ä¸Šæµ·åˆ†åŒºæ€»ç»ç†ï¼Œæˆ‘ä»£è¡¨ä¸Šæµ·æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’æ¬¢è¿å„ä½çš„è…ä¸´ã€‚&lt;/p>
&lt;p>ä»Šå¤©æœ‰å¾ˆå¤šæ–°æœ‹å‹ï¼Œä¹Ÿæœ‰å¾ˆå¤šè€æœ‹å‹ï¼Œæˆ‘åœ¨å‘¨äº”çš„æ—¶å€™é—®è¿‡åå°åŒäº‹æŠ¥åæŠ¥äº†å¤šå°‘äº†ï¼Œä»–å‘Šè¯‰æˆ‘ä»¬å·²ç»å¿«è¦æ¥è¿‘ 200 äººäº†ï¼Œä½†ä»ä»Šå¤©çš„è§„æ¨¡æ¥çœ‹ï¼Œæˆ‘æ„Ÿè§‰å¥½åƒä»Šå¤©çš„äººæ•°è¿˜è¦å†è¶…è¿‡ä¸€äº›ã€‚&lt;/p>
&lt;p>å½“ç„¶äº†ï¼Œæœ‰ä¸€äº›æ˜¯åŸå…ˆçš„è€å®¢æˆ·ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ˜¯æ…•åè€Œæ¥ï¼Œçœ‹åˆ°è¿™æ¬¡é‚€è¯·çš„æ˜¯ä»˜é¹å…ˆç”Ÿï¼Œæ‰€ä»¥æ…•åè€Œæ¥ã€‚ä¹Ÿæœ‰ä¸€äº›æ–°æœ‹å‹ã€‚åœ¨ä»˜é¹å…ˆç”Ÿä¸Šå°ä¹‹å‰ï¼Œè¯·å…è®¸æˆ‘å¯¹æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’åšç®€çŸ­çš„ä»‹ç»ã€‚&lt;/p>
&lt;p>æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’æ˜¯å…¨çƒçš„æˆ˜ç•¥é‡ç‚¹ä¹‹ä¸€ï¼Œè€æœ‹å‹éƒ½çŸ¥é“ï¼Œæ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’æˆç«‹äº 2020 å¹´ï¼Œè·ä»Šåˆšå¥½å››å¹´ï¼Œåœ¨å››å¹´çš„è¿‡ç¨‹ä¸­é›†å›¢ä¸€ç›´åœ¨ç»™æˆ‘ä»¬å¤§åŠ›æ³¨èµ„ï¼Œä¹Ÿæ˜¯é›†å›¢é‡Œæœ€é‡è¦çš„é¡¹ç›®ä¹‹ä¸€ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆèšç„¦åœ¨ä¸­å›½å¸‚åœºä¸Šï¼Ÿå¤§å®¶å¾ˆå¤šäººéƒ½æ˜ç™½ï¼Œä¸­å›½ä¸­äº§é˜¶çº§çš„äººæ•°åœ¨ä¸–ç•Œä¸Šå æœ‰é‡æ˜¯æœ€åºå¤§çš„ï¼Œéšç€ä¸­å›½ç»æµçš„é«˜é€Ÿå‘å±•ï¼Œä¸­å›½äººè´¢å¯Œç®¡ç†çš„éœ€æ±‚é€æ­¥æå‡åˆ°å¾ˆé«˜çš„æ°´å‡†ã€‚æ‰€ä»¥ï¼Œç§äººè´¢å¯Œè§„åˆ’ä¹Ÿä¼šå˜æˆæ±‡ä¸°çš„é‡è¦æˆ˜ç•¥ä¹‹ä¸€ã€‚&lt;/p>
&lt;p>ä»‹ç»ä¸€ä¸‹å‘å±•å†å²ï¼Œä» 2020 å¹´æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’æˆç«‹ï¼Œå…ˆæ˜¯åœ¨ä¸Šæµ·å’Œå¹¿å·ï¼Œæ€»éƒ¨ç¦»è¿™é‡Œä¸è¿œï¼Œæ±‡ä¸°æ€»éƒ¨å°±åœ¨å›½é‡‘ï¼Œæ¬¢è¿å¤§å®¶å»åä¸€åã€‚é€æ­¥è¿›å…¥åˆ°æ­å·ã€æ·±åœ³ã€åŒ—äº¬ã€ä½›å±±ï¼Œä»Šå¹´åœ¨è‹å·ã€æˆéƒ½å¼€ç«‹äº†åˆ†æ”¯æœºæ„ã€‚&lt;/p>
&lt;p>2020 å¹´æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’æ‰åˆšåˆšæˆç«‹ï¼Œé‚£æ±‡ä¸°çš„å†å²åˆæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿæ±‡ä¸°ç®€ç§°å« HSBCï¼Œå¾ˆå¤šäººä¼šé—® HSBC å››ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨ç€ä»€ä¹ˆï¼Œå¯ä»¥è·Ÿå¤§å®¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒH ä»£è¡¨çš„æ˜¯é¦™æ¸¯çš„æ„æ€ï¼ŒS ä»£è¡¨çš„æ˜¯ä¸Šæµ·çš„æ„æ€ã€‚å¾ˆå¤šäººå°è±¡ä¸­ä»¥ä¸ºæ±‡ä¸°æ˜¯ä¸€å®¶å¤–èµ„é“¶è¡Œï¼Œä½†å…¶å®å¤§å®¶æœ‰æ‰€ä¸çŸ¥ï¼Œå…¶å®æ±‡ä¸°åœ¨æ¸…æœçš„æ—¶å€™å°±åœ¨å¤–æ»©å·²ç»è®¾ç«‹äº†æ€»éƒ¨ï¼Œç°åœ¨è¿™æ ‹æ¥¼äº¤ç»™äº†æµ¦å‘é“¶è¡Œã€‚1949 å¹´ä¹‹åï¼Œæ±‡ä¸°å› ä¸ºå†å²çš„åŸå› é€€å‡ºäº†ä¸­å›½ï¼Œåœ¨ WTO ä¹‹åå›åˆ°äº†ä¸­å›½ã€‚&lt;/p>
&lt;p>æ±‡ä¸° 1865 å¹´æˆç«‹è‡³ä»Šå·²ç»æœ‰ 100 å¤šå¹´äº†ï¼Œé‚£æ—¶å€™è¿˜æ˜¯æ¸…æœçš„åŒæ²»å¹´é—´ï¼ŒåŒæ—¶å·²ç»åœ¨å…¨çƒçš„ 62 ä¸ªå›½å®¶è¿˜æœ‰ 3900 å¤šåå®¢æˆ·ï¼Œè¿™æ®µå†å²å’Œè¿™ä¹ˆå¤§çš„åˆ†å¸ƒä¹Ÿæ˜¯æ±‡ä¸°å¾ˆå¤šåŒäº‹å†…å¿ƒçš„éª„å‚²ã€‚æˆ‘ä»¬è·Ÿå¾ˆå¤šå®¢æˆ·åšæ²Ÿé€šçš„æ—¶å€™ï¼Œç»å¸¸ä¼šæŠŠè¿™æ®µå†å²æ‹¿å‡ºæ¥è·Ÿå¤§å®¶è®²ä¸€è®²ï¼Œå°±åƒè¿™å¤´çŸ³ç‹®å­ï¼Œå¾ˆå¤šäººéƒ½è§è¿‡ï¼Œä½†å¾ˆå¤šäººéƒ½ä¸çŸ¥é“å®ƒçš„å†å²ï¼Œå¾ˆå¤šäººåœ¨æµ·æŠ¥ã€å¹¿å‘Šã€æ¸¯å…ƒå¤§é’ä¸Šçœ‹è¿‡è¿™ä¸ªçŸ³ç‹®å­ï¼ŒåŸæ¥åœ¨å¤–æ»©ä¸Šä¹Ÿæœ‰ä¸¤åº§ï¼Œç°åœ¨æ”¾åœ¨ä¸Šæµ·åšç‰©é¦†é‡Œï¼Œå‰ä¸€é˜µå„¿æˆ‘åœ¨åšç‰©é¦†å‚è§‚çš„æ—¶å€™è¿˜çœ‹åˆ°äº†è¿™ä¸¤åªçŸ³ç‹®å­ï¼Œä¸Šé¢è¿˜æœ‰å¾ˆå¤šå†å²çš„ç—•è¿¹ï¼Œæ¯”å¦‚è¯´æˆ˜äº‰è€Œç•™ä¸‹çš„å¼¹å­”ï¼Œå°±åœ¨äººæ°‘å¹¿åœºçš„åšç‰©é¦†é‡Œï¼Œå¤§å®¶æœ‰å…´è¶£çš„è¯å¯ä»¥å»çœ‹ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>è´¢å¯Œå¤§çŸ©é˜µä¸ä¸­å›½å†…åœ°å¸‚åœºï¼Œæ±‡ä¸°é›†å›¢å¯¹äºä¸­å›½ç§äººè´¢å¯Œè§„åˆ’ä¸šåŠ¡çš„é‡è§†ç¨‹åº¦ï¼Œåœ¨å¤§çŸ©é˜µä¸­æ‰¿æ‹…äº†å¾ˆé‡è¦çš„åœ°ä½ã€‚&lt;/p>
&lt;p>æ¯ 100 ä½å®¢æˆ·ä¸­ï¼Œä¼šæœ‰ 87 ä½å®¢æˆ·å°†æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’è§†ä½œä¸ºæä¾›è´¢å¯Œé‡è¦çš„ä¸»è¦å“ç‰Œï¼Œæå‡ºäº†å¾ˆå¤šå¥½è¯„ï¼Œ82% çš„è°ƒç ”è€…æ‰“å‡º 9-10 åˆ†çš„é«˜åˆ†ã€‚&lt;/p>
&lt;p>ä¹Ÿæœ‰ä¸€äº›æ¯”è¾ƒæœ‰æ„æ€çš„è¯ï¼Œå¦‚ï¼šâ€œå¯¹äº§å“å†…å®¹çš„ä¿éšœæ»¡æ„ï¼Œå…¬å¸å¤§æœ‰ä¿éšœï¼›ç”„æ±‡ç”Ÿæ´»æœ‰ä¸€å®šçš„å¸å¼•åŠ›ï¼Œæ±‡ä¸°çš„äº§å“è¾ƒè´µä½†ä¹Ÿæ„¿æ„ä¹°ï¼Œå› ä¸ºå¯¹æ±‡ä¸°ç§äººè´¢å¯Œè§„åˆ’å¸ˆçš„è®¤å¯ã€‚â€&lt;/p>
&lt;p>è¿™ä¸¤å¹´æå‡ºä¸€å¥æ¯”è¾ƒæ–°çš„ Sloganâ€œæ‡‚ä½ å…³å¿ƒçš„ï¼Œç»™ä½ å®‰å¿ƒçš„â€ã€‚&lt;/p>
&lt;p>ä»Šå¤©çš„æ´»åŠ¨æˆ‘ä»¬é‚€è¯·åˆ°äº†ä¸€ä½é‡é‡çº§å˜‰å®¾ï¼Œä»–æ›¾ä»»èŒäºé›·æ›¼å…„å¼Ÿã€æ‰€ç½—é—¨æŠ•èµ„é›†å›¢ç­‰å…¨çƒé¡¶å°–é‡‘èæœºæ„ï¼Œä»äº‹å¯¹å†²åŸºé‡‘ç­‰ç›¸å…³å·¥ä½œã€‚ä»–å°±æ˜¯ä¸œåŒ—è¯åˆ¸é¦–å¸­ç»æµå­¦å®¶ä»˜é¹å…ˆç”Ÿã€‚è®©æˆ‘ä»¬æ¬¢è¿ä»˜é¹å…ˆç”Ÿä¸ºæˆ‘ä»¬å¸¦æ¥ã€Š2024 å¹´å¹´ç»ˆå›é¡¾å’Œ 2025 å¹´å±•æœ›â€”â€”å¯¹å†²é£é™© VS è½¯ç€é™†ã€‹ä¸»é¢˜åˆ†äº«ï¼Œæœ‰è¯·ä»˜é¹å…ˆç”Ÿï¼&lt;/p>
&lt;p>ä»˜é¹ï¼šæ­£å€¼å¹´åº•ï¼Œè™½ç„¶åˆšæ‰æ±‡ä¸°ä¸€ç›´å¼ºè°ƒå¤§å®¶ä¸å½•éŸ³ä¸å½•åƒï¼Œä½†å¤§æ¦‚ç‡ä½ æŒ¡ä¸ä½ã€‚æˆ‘åœ¨è¿™å„¿è®²è¯ä¼šè°¨æ…ä¸€äº›ï¼Œéå¸¸å°å¿ƒè°¨æ…ï¼Œå¤§æ¦‚ç‡ä¼šæœ‰äººé€éœ²å‡ºå»ï¼Œæ”¾åˆ° YouTube ä¸Šï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰è§æˆ‘éƒ½è¯´ä»˜æ€»æˆ‘åœ¨ YouTube ä¸Šçœ‹è¿‡ä½ çš„è§†é¢‘ï¼Œæˆ‘è¯´é‚£éƒ½æ˜¯ç›—ç‰ˆçš„ï¼Œé ç›—ç‰ˆå‘è´¢çš„ä¹Ÿä¸å°‘ã€‚&lt;/p></description></item><item><title>OrderBook æœ¬åœ°ç»´æŠ¤æ–¹æ¡ˆè®¾è®¡</title><link>https://code-agree.github.io/blog/orderbook/</link><pubDate>Wed, 27 Nov 2024 02:35:19 +0800</pubDate><guid>https://code-agree.github.io/blog/orderbook/</guid><description>&lt;h1 id="orderbook-æœ¬åœ°ç»´æŠ¤æ–¹æ¡ˆè®¾è®¡" class="relative group">OrderBook æœ¬åœ°ç»´æŠ¤æ–¹æ¡ˆè®¾è®¡ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#orderbook-%e6%9c%ac%e5%9c%b0%e7%bb%b4%e6%8a%a4%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="ä¸€ä¸šåŠ¡èƒŒæ™¯" class="relative group">ä¸€ã€ä¸šåŠ¡èƒŒæ™¯ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%b8%80%e4%b8%9a%e5%8a%a1%e8%83%8c%e6%99%af" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>OrderBookï¼ˆè®¢å•ç°¿ï¼‰æ˜¯åæ˜ å¸‚åœºæ·±åº¦å’ŒæµåŠ¨æ€§çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå…¶ç»´æŠ¤è´¨é‡ç›´æ¥å½±å“ï¼š&lt;/p>
&lt;ul>
&lt;li>ç­–ç•¥äº¤æ˜“å†³ç­–çš„å‡†ç¡®æ€§&lt;/li>
&lt;li>é£é™©æ§åˆ¶çš„æœ‰æ•ˆæ€§&lt;/li>
&lt;li>å¸‚åœºå®šä»·çš„åŠæ—¶æ€§&lt;/li>
&lt;/ul>
&lt;h3 id="11-ä¸šåŠ¡ä»·å€¼" class="relative group">1.1 ä¸šåŠ¡ä»·å€¼ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e4%b8%9a%e5%8a%a1%e4%bb%b7%e5%80%bc" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>ä»·æ ¼å‘ç°&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å®æ—¶åæ˜ å¸‚åœºä¾›éœ€çŠ¶æ€&lt;/li>
&lt;li>æä¾›å¤šå±‚æ¬¡ä»·æ ¼ä¿¡æ¯&lt;/li>
&lt;li>å±•ç¤ºå¸‚åœºæ·±åº¦åˆ†å¸ƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>äº¤æ˜“å†³ç­–æ”¯æŒ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æœ€ä¼˜ä»·æ ¼ç¡®å®šï¼ˆNBBOï¼‰&lt;/li>
&lt;li>æµåŠ¨æ€§è¯„ä¼°&lt;/li>
&lt;li>äº¤æ˜“æˆæœ¬ä¼°ç®—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é£é™©ç®¡ç†&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>å¸‚åœºå¼‚å¸¸ç›‘æ§&lt;/li>
&lt;li>æµåŠ¨æ€§é£é™©è¯„ä¼°&lt;/li>
&lt;li>ä»·æ ¼æ³¢åŠ¨è¿½è¸ª&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="äºŒæŠ€æœ¯æ–¹æ¡ˆ" class="relative group">äºŒã€æŠ€æœ¯æ–¹æ¡ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%ba%8c%e6%8a%80%e6%9c%af%e6%96%b9%e6%a1%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="21-æ ¸å¿ƒæ•°æ®ç»“æ„" class="relative group">2.1 æ ¸å¿ƒæ•°æ®ç»“æ„ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">LockFreeOrderBook&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åŸºç¡€ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">symbol_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// çŠ¶æ€ç®¡ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">uint64_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">last_update_time_&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">uint64_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">last_sequence_&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">initialized_&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nb">false&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä»·æ ¼æ¡£ä½å­˜å‚¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">using&lt;/span> &lt;span class="n">PriceLevelMap&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tbb&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">concurrent_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">double&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PriceLevel&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">greater&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PriceLevelMap&lt;/span> &lt;span class="n">bids_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ä¹°ç›˜ - é™åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">PriceLevelMap&lt;/span> &lt;span class="n">asks_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// å–ç›˜ - å‡åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä»·æ ¼æ¡£ä½ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">PriceLevel&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">double&lt;/span> &lt;span class="n">price&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">double&lt;/span> &lt;span class="n">quantity&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">update_time&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ·±åº¦æ•°æ®ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">DepthData&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PriceLevel&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">bids&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PriceLevel&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">asks&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">sequence_num&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">timestamp&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="22-æ ¸å¿ƒåŠŸèƒ½å®ç°" class="relative group">2.2 æ ¸å¿ƒåŠŸèƒ½å®ç° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#22-%e6%a0%b8%e5%bf%83%e5%8a%9f%e8%83%bd%e5%ae%9e%e7%8e%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>&lt;strong>å¿«ç…§æ•°æ®å¤„ç†&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">LockFreeOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">onSnapshot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">QuoteData&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">L2MarketData&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åºåˆ—å·æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">initialized_&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sequence_num&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">last_sequence_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡å»ºè®¢å•ç°¿
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">bids_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clear&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asks_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clear&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ‰¹é‡æ„å»ºä»·æ ¼æ¡£ä½
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nl">event&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">events&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nl">update&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">updates&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">new_quantity&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">continue&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PriceLevel&lt;/span> &lt;span class="nf">level&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">price_level&lt;/span>&lt;span class="p">,&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">new_quantity&lt;/span>&lt;span class="p">,&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">timestamp&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">side&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;bid&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bids_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">price_level&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">asks_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">price_level&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ›´æ–°çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">updateState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>&lt;strong>å¢é‡æ›´æ–°å¤„ç†&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">LockFreeOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">onUpdate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">QuoteData&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">L2MarketData&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// çŠ¶æ€æ£€æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">initialized_&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sequence_num&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">last_sequence_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¤„ç†ä»·æ ¼æ¡£ä½æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nl">event&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">events&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nl">update&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">updates&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PriceLevel&lt;/span> &lt;span class="nf">level&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">price_level&lt;/span>&lt;span class="p">,&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">new_quantity&lt;/span>&lt;span class="p">,&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">timestamp&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">book&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">side&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;bid&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">bids_&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">asks_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">inserted&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">book&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">price_level&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">inserted&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">it&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">second&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æ›´æ–°ç°æœ‰æ¡£ä½
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ›´æ–°çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">updateState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>&lt;strong>æ·±åº¦æ•°æ®æŸ¥è¯¢&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">DepthData&lt;/span> &lt;span class="n">LockFreeOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">getDepth&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">levels&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DepthData&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sequence_num&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">last_sequence_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">timestamp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">last_update_time_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ”¶é›†æœ‰æ•ˆä»·æ ¼æ¡£ä½
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">bids_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">quantity&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bids&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">levels&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bids&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push_back&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">asks_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">quantity&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">asks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">levels&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">asks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push_back&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="23-æŠ€æœ¯ç‰¹ç‚¹" class="relative group">2.3 æŠ€æœ¯ç‰¹ç‚¹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#23-%e6%8a%80%e6%9c%af%e7%89%b9%e7%82%b9" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>å¹¶å‘å®‰å…¨&lt;/strong>&lt;/p></description></item><item><title>å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰ä¸é›¶æ‹·è´æŠ€æœ¯ï¼šæ·±å…¥ç†è§£å’Œå®è·µ</title><link>https://code-agree.github.io/blog/zero_copy/</link><pubDate>Tue, 22 Oct 2024 01:23:46 +0800</pubDate><guid>https://code-agree.github.io/blog/zero_copy/</guid><description>&lt;h2 id="1-æ¦‚è¿°" class="relative group">1. æ¦‚è¿° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e6%a6%82%e8%bf%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰æ˜¯ä¸€ç§å°†æ–‡ä»¶æˆ–è®¾å¤‡æ˜ å°„åˆ°å†…å­˜çš„æ–¹æ³•ï¼Œè€Œé›¶æ‹·è´æ˜¯ä¸€ç§å‡å°‘æˆ–é¿å…æ•°æ®åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¸å¿…è¦å¤åˆ¶çš„æŠ€æœ¯ã€‚è¿™ä¸¤ä¸ªæ¦‚å¿µå¯†åˆ‡ç›¸å…³ï¼Œä½†åˆæœ‰æ‰€ä¸åŒã€‚&lt;/p>
&lt;h2 id="2-mmap-æ˜¯é›¶æ‹·è´å—" class="relative group">2. mmap æ˜¯é›¶æ‹·è´å—ï¼Ÿ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-mmap-%e6%98%af%e9%9b%b6%e6%8b%b7%e8%b4%9d%e5%90%97" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>ç­”æ¡ˆæ˜¯ï¼š&lt;strong>mmap æœ¬èº«ä¸æ˜¯é›¶æ‹·è´æŠ€æœ¯ï¼Œä½†å®ƒå¯ä»¥å®ç°é›¶æ‹·è´çš„æ•ˆæœ&lt;/strong>ã€‚&lt;/p>
&lt;h3 id="21-mmap-çš„å·¥ä½œåŸç†" class="relative group">2.1 mmap çš„å·¥ä½œåŸç† &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-mmap-%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>å½“è°ƒç”¨ mmap æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨è™šæ‹Ÿå†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å†…å­˜åŒºåŸŸã€‚&lt;/li>
&lt;li>è¿™ä¸ªå†…å­˜åŒºåŸŸä¼šæ˜ å°„åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆpage cacheï¼‰ä¸­çš„ç‰©ç†é¡µé¢ã€‚&lt;/li>
&lt;li>å½“ç¨‹åºè®¿é—®è¿™ä¸ªå†…å­˜åŒºåŸŸæ—¶ï¼Œå¦‚æœç›¸åº”çš„é¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œä¼šè§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œæ“ä½œç³»ç»Ÿä¼šä»ç£ç›˜åŠ è½½æ•°æ®åˆ°å†…å­˜ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="22-ä¸ºä»€ä¹ˆ-mmap-å¯ä»¥å®ç°é›¶æ‹·è´" class="relative group">2.2 ä¸ºä»€ä¹ˆ mmap å¯ä»¥å®ç°é›¶æ‹·è´ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#22-%e4%b8%ba%e4%bb%80%e4%b9%88-mmap-%e5%8f%af%e4%bb%a5%e5%ae%9e%e7%8e%b0%e9%9b%b6%e6%8b%b7%e8%b4%9d" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>ä¸€æ—¦æ˜ å°„å»ºç«‹ï¼Œç”¨æˆ·è¿›ç¨‹å¯ä»¥ç›´æ¥è¯»å†™è¿™ä¸ªå†…å­˜åŒºåŸŸï¼Œè€Œæ— éœ€åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´è¿›è¡Œæ•°æ®å¤åˆ¶ã€‚&lt;/li>
&lt;li>å¯¹äºè¯»æ“ä½œï¼Œæ•°æ®ä»ç£ç›˜è¯»å…¥ page cache åï¼Œå¯ä»¥ç›´æ¥è¢«ç”¨æˆ·è¿›ç¨‹è®¿é—®ï¼Œæ— éœ€é¢å¤–å¤åˆ¶ã€‚&lt;/li>
&lt;li>å¯¹äºå†™æ“ä½œï¼Œä¿®æ”¹ç›´æ¥å‘ç”Ÿåœ¨ page cache ä¸Šï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨é€‚å½“çš„æ—¶å€™å°†ä¿®æ”¹åŒæ­¥åˆ°ç£ç›˜ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="3-mmap-ä¸ä¼ ç»Ÿ-io-çš„æ¯”è¾ƒ" class="relative group">3. mmap ä¸ä¼ ç»Ÿ I/O çš„æ¯”è¾ƒ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-mmap-%e4%b8%8e%e4%bc%a0%e7%bb%9f-io-%e7%9a%84%e6%af%94%e8%be%83" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="31-ä¼ ç»Ÿ-read-ç³»ç»Ÿè°ƒç”¨" class="relative group">3.1 ä¼ ç»Ÿ read ç³»ç»Ÿè°ƒç”¨ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#31-%e4%bc%a0%e7%bb%9f-read-%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">char&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4096&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ssize_t&lt;/span> &lt;span class="n">bytes_read&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠä¸¤æ¬¡æ•°æ®æ‹·è´ï¼š&lt;/p></description></item><item><title>GitHubç§æœ‰ä»“åº“ååŒå¼€å‘æŒ‡å—</title><link>https://code-agree.github.io/blog/project_manage/</link><pubDate>Wed, 16 Oct 2024 02:04:51 +0800</pubDate><guid>https://code-agree.github.io/blog/project_manage/</guid><description>&lt;h2 id="ç›®å½•" class="relative group">ç›®å½• &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e7%9b%ae%e5%bd%95" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;ol>
&lt;li>&lt;a href="#%e7%ae%80%e4%bb%8b">ç®€ä»‹&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%e4%bb%93%e5%ba%93%e7%bb%93%e6%9e%84%e5%92%8c%e5%88%86%e6%94%af%e7%ad%96%e7%95%a5">ä»“åº“ç»“æ„å’Œåˆ†æ”¯ç­–ç•¥&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%e5%8d%8f%e4%bd%9c%e8%80%85%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86">åä½œè€…æƒé™ç®¡ç†&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%e4%bf%9d%e6%8a%a4%e4%b8%bb%e5%88%86%e6%94%af">ä¿æŠ¤ä¸»åˆ†æ”¯&lt;/a>&lt;/li>
&lt;li>&lt;a href="#pull-request-%e5%92%8c%e4%bb%a3%e7%a0%81%e5%ae%a1%e6%9f%a5%e6%b5%81%e7%a8%8b">Pull Request å’Œä»£ç å®¡æŸ¥æµç¨‹&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%e6%8c%81%e7%bb%ad%e9%9b%86%e6%88%90%e4%b8%8e%e9%83%a8%e7%bd%b2-cicd">æŒç»­é›†æˆä¸éƒ¨ç½² (CI/CD)&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%e6%96%87%e6%a1%a3%e5%92%8c%e6%b2%9f%e9%80%9a">æ–‡æ¡£å’Œæ²Ÿé€š&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%e5%92%8c%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹&lt;/a>&lt;/li>
&lt;/ol>
&lt;h2 id="ç®€ä»‹" class="relative group">ç®€ä»‹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e7%ae%80%e4%bb%8b" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨æ²¡æœ‰é«˜çº§ GitHub åŠŸèƒ½çš„ç§æœ‰ä»“åº“ä¸­è¿›è¡ŒååŒå¼€å‘å¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œä½†é€šè¿‡æ­£ç¡®çš„å®è·µå’Œå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªé«˜æ•ˆã€å®‰å…¨çš„å¼€å‘ç¯å¢ƒã€‚æœ¬æŒ‡å—æ€»ç»“äº†æˆ‘ä»¬è®¨è®ºçš„ä¸»è¦ç­–ç•¥å’ŒæŠ€æœ¯ã€‚&lt;/p>
&lt;h2 id="ä»“åº“ç»“æ„å’Œåˆ†æ”¯ç­–ç•¥" class="relative group">ä»“åº“ç»“æ„å’Œåˆ†æ”¯ç­–ç•¥ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bb%93%e5%ba%93%e7%bb%93%e6%9e%84%e5%92%8c%e5%88%86%e6%94%af%e7%ad%96%e7%95%a5" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;ul>
&lt;li>&lt;strong>ä¸»åˆ†æ”¯&lt;/strong>ï¼š&lt;code>main&lt;/code>ï¼ˆç¨³å®šã€å¯éƒ¨ç½²çš„ä»£ç ï¼‰&lt;/li>
&lt;li>&lt;strong>å¼€å‘åˆ†æ”¯&lt;/strong>ï¼š&lt;code>main_for_dev&lt;/code>ï¼ˆæ—¥å¸¸å¼€å‘å·¥ä½œï¼‰&lt;/li>
&lt;li>&lt;strong>ç‰¹æ€§åˆ†æ”¯&lt;/strong>ï¼šä» &lt;code>main_for_dev&lt;/code> åˆ†å‡ºï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½&lt;/li>
&lt;/ul>
&lt;p>å·¥ä½œæµç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>ä» &lt;code>main_for_dev&lt;/code> åˆ›å»ºç‰¹æ€§åˆ†æ”¯&lt;/li>
&lt;li>åœ¨ç‰¹æ€§åˆ†æ”¯ä¸Šå¼€å‘&lt;/li>
&lt;li>å®Œæˆåï¼Œåˆ›å»º Pull Request åˆ° &lt;code>main_for_dev&lt;/code>&lt;/li>
&lt;li>ä»£ç å®¡æŸ¥å’Œæµ‹è¯•&lt;/li>
&lt;li>åˆå¹¶åˆ° &lt;code>main_for_dev&lt;/code>&lt;/li>
&lt;li>å®šæœŸå°† &lt;code>main_for_dev&lt;/code> åˆå¹¶åˆ° &lt;code>main&lt;/code>&lt;/li>
&lt;/ol>
&lt;h2 id="åä½œè€…æƒé™ç®¡ç†" class="relative group">åä½œè€…æƒé™ç®¡ç† &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%8d%8f%e4%bd%9c%e8%80%85%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>GitHub ç§æœ‰ä»“åº“æä¾›ä»¥ä¸‹æƒé™çº§åˆ«ï¼š&lt;/p></description></item><item><title>Forkæœºåˆ¶è¯¦è§£ï¼šä»åŸºç¡€åˆ°é«˜çº§åº”ç”¨</title><link>https://code-agree.github.io/blog/fork/</link><pubDate>Tue, 15 Oct 2024 02:45:13 +0800</pubDate><guid>https://code-agree.github.io/blog/fork/</guid><description>&lt;h2 id="1-å¼•è¨€" class="relative group">1. å¼•è¨€ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e5%bc%95%e8%a8%80" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>Forkæ˜¯Unix/Linuxç³»ç»Ÿä¸­æœ€åŸºæœ¬ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„ç³»ç»Ÿè°ƒç”¨ä¹‹ä¸€ã€‚å®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹,è¿™ä¸ªæ–°è¿›ç¨‹æ˜¯åŸè¿›ç¨‹çš„ä¸€ä¸ªå‡ ä¹å®Œå…¨ç›¸åŒçš„å‰¯æœ¬ã€‚æœ¬æ¬¡æŠ€æœ¯åˆ†äº«å°†æ·±å…¥æ¢è®¨forkæœºåˆ¶,ä»åŸºæœ¬æ¦‚å¿µåˆ°é«˜çº§åº”ç”¨ã€‚&lt;/p>
&lt;h2 id="2-forkçš„åŸºæœ¬åŸç†" class="relative group">2. Forkçš„åŸºæœ¬åŸç† &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-fork%e7%9a%84%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="21-ä»€ä¹ˆæ˜¯fork" class="relative group">2.1 ä»€ä¹ˆæ˜¯Fork &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-%e4%bb%80%e4%b9%88%e6%98%affork" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>Forkæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨,ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹ï¼ˆç§°ä¸ºå­è¿›ç¨‹ï¼‰æ˜¯è°ƒç”¨è¿›ç¨‹ï¼ˆç§°ä¸ºçˆ¶è¿›ç¨‹ï¼‰çš„ä¸€ä¸ªå‡ ä¹å®Œå…¨ç›¸åŒçš„å‰¯æœ¬ã€‚&lt;/p>
&lt;h3 id="22-forkçš„å·¥ä½œåŸç†" class="relative group">2.2 Forkçš„å·¥ä½œåŸç† &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#22-fork%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>å½“ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨forkæ—¶:&lt;/p>
&lt;ol>
&lt;li>ç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚&lt;/li>
&lt;li>æ–°è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„ä¸€ä¸ªå‰¯æœ¬,åŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µã€å †æ ˆç­‰ã€‚&lt;/li>
&lt;li>å­è¿›ç¨‹è·å¾—çˆ¶è¿›ç¨‹æ•°æ®ç©ºé—´ã€å †å’Œæ ˆçš„å‰¯æœ¬ã€‚&lt;/li>
&lt;li>çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ç»§ç»­æ‰§è¡Œforkè°ƒç”¨ä¹‹åçš„ä»£ç ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="23-forkçš„è¿”å›å€¼" class="relative group">2.3 Forkçš„è¿”å›å€¼ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#23-fork%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>Forkè°ƒç”¨ä¼šè¿”å›ä¸¤æ¬¡:&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„ä½åŸŸå‹ç¼©æŠ€æœ¯</title><link>https://code-agree.github.io/blog/bit_field_compression/</link><pubDate>Sun, 13 Oct 2024 03:18:35 +0800</pubDate><guid>https://code-agree.github.io/blog/bit_field_compression/</guid><description>&lt;h2 id="1-åŸºç¡€æ¦‚å¿µ" class="relative group">1. åŸºç¡€æ¦‚å¿µ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e5%9f%ba%e7%a1%80%e6%a6%82%e5%bf%b5" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="11-äºŒè¿›åˆ¶è¡¨ç¤º" class="relative group">1.1 äºŒè¿›åˆ¶è¡¨ç¤º &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e4%ba%8c%e8%bf%9b%e5%88%b6%e8%a1%a8%e7%a4%ba" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>è®¡ç®—æœºä½¿ç”¨äºŒè¿›åˆ¶ï¼ˆ0å’Œ1ï¼‰å­˜å‚¨å’Œå¤„ç†æ•°æ®&lt;/li>
&lt;li>1 byte = 8 bits&lt;/li>
&lt;li>32ä½æ•´æ•°å¯ä»¥è¡¨ç¤ºä» 0 åˆ° 2^32 - 1 çš„æ•°å€¼&lt;/li>
&lt;/ul>
&lt;h3 id="12-ä½æ“ä½œåŸºç¡€" class="relative group">1.2 ä½æ“ä½œåŸºç¡€ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#12-%e4%bd%8d%e6%93%8d%e4%bd%9c%e5%9f%ba%e7%a1%80" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ul>
&lt;li>ä¸æ“ä½œ (&amp;amp;): ä¸¤ä½éƒ½ä¸º1æ—¶ç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0&lt;/li>
&lt;li>æˆ–æ“ä½œ (|): è‡³å°‘ä¸€ä½ä¸º1æ—¶ç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0&lt;/li>
&lt;li>å¼‚æˆ–æ“ä½œ (^): ä¸¤ä½ä¸åŒæ—¶ç»“æœä¸º1ï¼Œç›¸åŒæ—¶ä¸º0&lt;/li>
&lt;li>éæ“ä½œ (~): å°†æ¯ä¸€ä½å–å&lt;/li>
&lt;li>å·¦ç§» (&amp;laquo;): å°†æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨ï¼Œå³ä¾§è¡¥0&lt;/li>
&lt;li>å³ç§» (&amp;raquo;): å°†æ‰€æœ‰ä½å‘å³ç§»åŠ¨ï¼Œå·¦ä¾§è¡¥0æˆ–ç¬¦å·ä½&lt;/li>
&lt;/ul>
&lt;p>ç¤ºä¾‹ï¼š&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„å¸‚åœºæ•°æ®å­˜å‚¨ä¼˜åŒ–</title><link>https://code-agree.github.io/blog/read/</link><pubDate>Sun, 29 Sep 2024 01:36:04 +0800</pubDate><guid>https://code-agree.github.io/blog/read/</guid><description>&lt;h2 id="1-èƒŒæ™¯ä»‹ç»" class="relative group">1. èƒŒæ™¯ä»‹ç» &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e8%83%8c%e6%99%af%e4%bb%8b%e7%bb%8d" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­ï¼Œå¸‚åœºæ•°æ®çš„å¿«é€Ÿè¯»å–å’Œå¤„ç†æ˜¯å…³é”®æ€§èƒ½æŒ‡æ ‡ä¹‹ä¸€ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä½¿ç”¨å…±äº«å†…å­˜æ¥å­˜å‚¨å’Œè®¿é—®å®æ—¶å¸‚åœºæ•°æ®ï¼Œå…¶ä¸­ &lt;code>MarketDataStore&lt;/code> ç±»è´Ÿè´£ç®¡ç†è¿™äº›æ•°æ®ã€‚æœ¬æ–‡å°†è®¨è®ºå¦‚ä½•ä¼˜åŒ– &lt;code>MarketDataStore&lt;/code> ä¸­çš„ &lt;code>readLatestData&lt;/code> å‡½æ•°ï¼Œä»¥æé«˜æ•°æ®è¯»å–çš„æ•ˆç‡ã€‚&lt;/p>
&lt;h2 id="2-åˆå§‹å®ç°" class="relative group">2. åˆå§‹å®ç° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e5%88%9d%e5%a7%8b%e5%ae%9e%e7%8e%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>æœ€åˆçš„ &lt;code>readLatestData&lt;/code> å‡½æ•°å®ç°å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">optional&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">MappedTickerData&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">MarketDataStore&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">readLatestData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">symbol&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">offset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">calculateOffset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">symbol&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MappedTickerData&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">dataFile&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MappedTickerData&lt;/span>&lt;span class="p">)))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">timestamp&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">symbol&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LOG_WARN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;readLatestData symbol = {} failed&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">symbol&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">nullopt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LOG_ERROR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to read data for symbol = {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">symbol&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">nullopt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå®ç°å­˜åœ¨å‡ ä¸ªæ€§èƒ½ç“¶é¢ˆï¼š&lt;/p>
&lt;ol>
&lt;li>ä½¿ç”¨å…±äº«é”å¯èƒ½å¯¼è‡´å¹¶å‘è¯»å–çš„æ€§èƒ½ä¸‹é™ã€‚&lt;/li>
&lt;li>å­—ç¬¦ä¸²æ¯”è¾ƒæ•ˆç‡ä½ä¸‹ï¼Œç‰¹åˆ«æ˜¯åˆ›å»ºä¸´æ—¶ &lt;code>std::string&lt;/code> å¯¹è±¡ã€‚&lt;/li>
&lt;li>æ²¡æœ‰åˆ©ç”¨ç°ä»£ CPU çš„ SIMD æŒ‡ä»¤é›†ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="3-ä¼˜åŒ–è¿‡ç¨‹" class="relative group">3. ä¼˜åŒ–è¿‡ç¨‹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-%e4%bc%98%e5%8c%96%e8%bf%87%e7%a8%8b" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="31-å­—ç¬¦ä¸²æ¯”è¾ƒä¼˜åŒ–" class="relative group">3.1 å­—ç¬¦ä¸²æ¯”è¾ƒä¼˜åŒ– &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#31-%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%af%94%e8%be%83%e4%bc%98%e5%8c%96" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¼˜åŒ–äº†å­—ç¬¦ä¸²æ¯”è¾ƒé€»è¾‘ï¼š&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„é‡è¿æœºåˆ¶æœ€ä½³å®è·µ</title><link>https://code-agree.github.io/blog/atom/</link><pubDate>Fri, 27 Sep 2024 01:35:21 +0800</pubDate><guid>https://code-agree.github.io/blog/atom/</guid><description>&lt;h1 id="é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„é‡è¿æœºåˆ¶æœ€ä½³å®è·µ" class="relative group">é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„é‡è¿æœºåˆ¶æœ€ä½³å®è·µ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e4%b8%ad%e7%9a%84%e9%87%8d%e8%bf%9e%e6%9c%ba%e5%88%b6%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="èƒŒæ™¯" class="relative group">èƒŒæ™¯ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%83%8c%e6%99%af" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­ï¼Œç½‘ç»œè¿æ¥çš„ç¨³å®šæ€§è‡³å…³é‡è¦ã€‚ç„¶è€Œï¼Œç”±äºç½‘ç»œæ³¢åŠ¨æˆ–å…¶ä»–åŸå› ï¼Œè¿æ¥å¯èƒ½ä¼šä¸­æ–­ã€‚ä¸ºäº†ç¡®ä¿ç³»ç»Ÿçš„è¿ç»­æ€§å’Œå¯é æ€§ï¼Œéœ€è¦å®ç°ä¸€ä¸ªé«˜æ•ˆçš„é‡è¿æœºåˆ¶ã€‚ç„¶è€Œï¼Œé¢‘ç¹çš„é‡è¿æ£€æŸ¥å’Œå¤„ç†å¯èƒ½å¯¼è‡´é‡å¤é‡è¿ï¼Œå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚&lt;/p>
&lt;h2 id="é—®é¢˜æè¿°" class="relative group">é—®é¢˜æè¿° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨ç°æœ‰å®ç°ä¸­ï¼Œä¸»å¾ªç¯é¢‘ç¹æ£€æŸ¥ &lt;code>m_client-&amp;gt;needsReconnection()&lt;/code>ï¼Œå¦‚æœéœ€è¦é‡è¿ï¼Œåˆ™è°ƒç”¨ &lt;code>handleReconnect()&lt;/code>ã€‚ç„¶è€Œï¼Œç”±äºä¸»å¾ªç¯é€Ÿåº¦å¾ˆå¿«ï¼Œå¯èƒ½åœ¨ &lt;code>resetReconnectionFlag()&lt;/code> ç”Ÿæ•ˆå‰å†æ¬¡æ£€æŸ¥ &lt;code>needsReconnection()&lt;/code>ï¼Œå¯¼è‡´é‡å¤è°ƒç”¨ &lt;code>handleReconnect()&lt;/code>ã€‚&lt;/p>
&lt;h2 id="è§£å†³æ–¹æ¡ˆ" class="relative group">è§£å†³æ–¹æ¡ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>é€šè¿‡ä½¿ç”¨åŸå­æ“ä½œå’ŒåŒé‡æ£€æŸ¥æœºåˆ¶ï¼Œç¡®ä¿é‡è¿è¿‡ç¨‹çš„åŸå­æ€§å’Œä¸€è‡´æ€§ï¼Œé¿å…é‡å¤é‡è¿ã€‚&lt;/p>
&lt;h3 id="1-å®šä¹‰è¿æ¥çŠ¶æ€ç®¡ç†" class="relative group">1. å®šä¹‰è¿æ¥çŠ¶æ€ç®¡ç† &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e5%ae%9a%e4%b9%89%e8%bf%9e%e6%8e%a5%e7%8a%b6%e6%80%81%e7%ae%a1%e7%90%86" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>ä½¿ç”¨åŸå­å˜é‡æ¥ç®¡ç†è¿æ¥çŠ¶æ€ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¼˜åŒ–ï¼šä»æ•°æ®è¯»å–åˆ°ç³»ç»Ÿå¹³è¡¡çš„æ€è€ƒè¿‡ç¨‹</title><link>https://code-agree.github.io/blog/datareader_design/</link><pubDate>Wed, 25 Sep 2024 01:04:59 +0800</pubDate><guid>https://code-agree.github.io/blog/datareader_design/</guid><description>&lt;h2 id="1-åˆå§‹é—®é¢˜æ•°æ®è¯»å–æ•ˆç‡" class="relative group">1. åˆå§‹é—®é¢˜ï¼šæ•°æ®è¯»å–æ•ˆç‡ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e5%88%9d%e5%a7%8b%e9%97%ae%e9%a2%98%e6%95%b0%e6%8d%ae%e8%af%bb%e5%8f%96%e6%95%88%e7%8e%87" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>æœ€åˆï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å¸‚åœºæ•°æ®è¯»å–å™¨æœ¬èº«çš„æ•ˆç‡é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="11-è½®è¯¢æ–¹å¼åˆå§‹çŠ¶æ€" class="relative group">1.1 è½®è¯¢æ–¹å¼ï¼ˆåˆå§‹çŠ¶æ€ï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e8%bd%ae%e8%af%a2%e6%96%b9%e5%bc%8f%e5%88%9d%e5%a7%8b%e7%8a%b6%e6%80%81" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">MarketDataReader&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">readingLoop&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nl">symbol&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">symbols_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">processSymbol&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">symbol&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">this_thread&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">sleep_for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">chrono&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">milliseconds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é—®é¢˜ï¼šæŒç»­è½®è¯¢å³ä½¿åœ¨æ²¡æœ‰æ–°æ•°æ®æ—¶ä¹Ÿä¼šæ¶ˆè€—èµ„æºã€‚&lt;/p>
&lt;h3 id="12-æ¡ä»¶æ§åˆ¶æ–¹å¼" class="relative group">1.2 æ¡ä»¶æ§åˆ¶æ–¹å¼ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#12-%e6%9d%a1%e4%bb%b6%e6%8e%a7%e5%88%b6%e6%96%b9%e5%bc%8f" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">MarketDataReader&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">readingLoop&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conditionMutex&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dataCondition&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">wait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="n">running&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="n">symbols_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">auto&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nl">symbol&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">symbols_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">processSymbol&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">symbol&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ”¹è¿›ï¼šå‡å°‘äº†ä¸å¿…è¦çš„CPUä½¿ç”¨ï¼Œä½†å¯èƒ½ä¼šåœ¨é«˜é¢‘æ•°æ®æ›´æ–°æ—¶å¼•å…¥å»¶è¿Ÿã€‚&lt;/p>
&lt;p>æ€è€ƒè½¬å˜ï¼šè¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨å¦‚ä½•æé«˜å•ä¸ªç»„ä»¶ï¼ˆæ•°æ®è¯»å–å™¨ï¼‰çš„æ•ˆç‡ã€‚&lt;/p>
&lt;h2 id="2-æ‰©å±•è€ƒè™‘æ•°æ®è¯»å–å¯¹å…¶ä»–ç³»ç»Ÿç»„ä»¶çš„å½±å“" class="relative group">2. æ‰©å±•è€ƒè™‘ï¼šæ•°æ®è¯»å–å¯¹å…¶ä»–ç³»ç»Ÿç»„ä»¶çš„å½±å“ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e6%89%a9%e5%b1%95%e8%80%83%e8%99%91%e6%95%b0%e6%8d%ae%e8%af%bb%e5%8f%96%e5%af%b9%e5%85%b6%e4%bb%96%e7%b3%bb%e7%bb%9f%e7%bb%84%e4%bb%b6%e7%9a%84%e5%bd%b1%e5%93%8d" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>éšç€å¯¹ç³»ç»Ÿçš„æ·±å…¥æ€è€ƒï¼Œæˆ‘ä»¬å¼€å§‹è€ƒè™‘æ•°æ®è¯»å–å™¨çš„è¡Œä¸ºå¦‚ä½•å½±å“æ•´ä¸ªç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯è®¢å•æµçš„æ‰§è¡Œæ•ˆç‡ã€‚&lt;/p></description></item><item><title>å®ç°é«˜æ€§èƒ½ä½å»¶è¿Ÿçš„äº¤æ˜“ç³»ç»Ÿè®¾è®¡</title><link>https://code-agree.github.io/blog/high_performance/</link><pubDate>Fri, 20 Sep 2024 22:32:08 +0800</pubDate><guid>https://code-agree.github.io/blog/high_performance/</guid><description>&lt;h1 id="é«˜æ€§èƒ½ä½å»¶è¿Ÿäº¤æ˜“ç³»ç»Ÿè®¾è®¡æŠ€æœ¯åˆ†äº«-update" class="relative group">é«˜æ€§èƒ½ä½å»¶è¿Ÿäº¤æ˜“ç³»ç»Ÿè®¾è®¡ï¼šæŠ€æœ¯åˆ†äº« update &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%ab%98%e6%80%a7%e8%83%bd%e4%bd%8e%e5%bb%b6%e8%bf%9f%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e8%ae%be%e8%ae%a1%e6%8a%80%e6%9c%af%e5%88%86%e4%ba%ab-update" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“å’Œå®æ—¶é‡‘èç³»ç»Ÿä¸­ï¼Œæ€§èƒ½å’Œå»¶è¿Ÿæ˜¯å…³é”®å› ç´ ã€‚æœ¬æ–‡å°†åˆ†äº«ä¸€äº›è®¾è®¡å’Œå®ç°é«˜æ€§èƒ½ä½å»¶è¿Ÿäº¤æ˜“ç³»ç»Ÿçš„å…³é”®æŠ€æœ¯å’Œç­–ç•¥ã€‚&lt;/p>
&lt;h2 id="1-æ•°æ®ç»“æ„ä¼˜åŒ–" class="relative group">1. æ•°æ®ç»“æ„ä¼˜åŒ– &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e4%bc%98%e5%8c%96" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="11-å†…å­˜æ˜ å°„memory-mappedæ–‡ä»¶" class="relative group">1.1 å†…å­˜æ˜ å°„ï¼ˆMemory-Mappedï¼‰æ–‡ä»¶ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-%e5%86%85%e5%ad%98%e6%98%a0%e5%b0%84memory-mapped%e6%96%87%e4%bb%b6" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶å¯ä»¥æ˜¾è‘—æé«˜I/Oæ€§èƒ½ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶å…è®¸å¿«é€Ÿçš„è¿›ç¨‹é—´é€šä¿¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MmapOrderBook&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶å­˜å‚¨è®¢å•ç°¿æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="12-è‡ªå®šä¹‰å†…å­˜æ± " class="relative group">1.2 è‡ªå®šä¹‰å†…å­˜æ±  &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#12-%e8%87%aa%e5%ae%9a%e4%b9%89%e5%86%85%e5%ad%98%e6%b1%a0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>å®ç°è‡ªå®šä¹‰å†…å­˜æ± å¯ä»¥å‡å°‘å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œæé«˜å†…å­˜ä½¿ç”¨æ•ˆç‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">MaxSize&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MemoryPool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®ç°é«˜æ•ˆçš„å†…å­˜åˆ†é…å’Œå›æ”¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="2-å¹¶å‘æ§åˆ¶" class="relative group">2. å¹¶å‘æ§åˆ¶ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e5%b9%b6%e5%8f%91%e6%8e%a7%e5%88%b6" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;h3 id="21-ç»†ç²’åº¦é”" class="relative group">2.1 ç»†ç²’åº¦é” &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#21-%e7%bb%86%e7%b2%92%e5%ba%a6%e9%94%81" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>ä½¿ç”¨ç»†ç²’åº¦é”å¯ä»¥å‡å°‘é”ç«äº‰ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„é«˜å±‚é”å®šï¼šå¿…è¦æ€§ä¸å®ç°</title><link>https://code-agree.github.io/blog/mutex/</link><pubDate>Wed, 18 Sep 2024 17:29:59 +0800</pubDate><guid>https://code-agree.github.io/blog/mutex/</guid><description>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿçš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é¢ä¸´ç€æ€§èƒ½å’Œæ­£ç¡®æ€§ä¹‹é—´çš„æƒè¡¡ã€‚æœ€è¿‘ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–è®¢å•å¤„ç†æµç¨‹æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼šæ˜¯å¦éœ€è¦åœ¨é«˜å±‚ç»„ä»¶ä¸­å®ç°é”å®šï¼Ÿæœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™ä¸ªé—®é¢˜ï¼Œåˆ†æå…¶å¿…è¦æ€§ï¼Œå¹¶å±•ç¤ºä¼˜åŒ–å‰åçš„å®ç°ã€‚&lt;/p>
&lt;ol>
&lt;li>èƒŒæ™¯&lt;/li>
&lt;/ol>
&lt;p>æˆ‘ä»¬çš„ç³»ç»Ÿä¸»è¦ç”±ä»¥ä¸‹ç»„ä»¶æ„æˆï¼š&lt;/p>
&lt;ul>
&lt;li>MmapOrderBookï¼šæ ¸å¿ƒæ•°æ®å­˜å‚¨ï¼Œä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶å®ç°&lt;/li>
&lt;li>PositionManagerï¼šè´Ÿè´£ä»“ä½ç®¡ç†&lt;/li>
&lt;li>OrderValidatorï¼šè´Ÿè´£è®¢å•éªŒè¯&lt;/li>
&lt;li>OrderManagerï¼šè´Ÿè´£è®¢å•å¤„ç†æµç¨‹&lt;/li>
&lt;/ul>
&lt;p>æœ€åˆï¼Œæˆ‘ä»¬çš„å®ç°å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// OrderManager.cpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">bool&lt;/span> &lt;span class="n">OrderManager&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">processOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Order&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">order&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">orderValidator_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">validateOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">orderBook_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">addOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">position&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">positionManager_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getPosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">accountId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="cm">/* instrumentId */&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">position&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">position&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">quantity&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">isBuy&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nl">quantity&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">quantity&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">positionManager_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">updatePosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">position&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å‘å¸ƒè®¢å•å·²å¤„ç†äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>é—®é¢˜åˆ†æ&lt;/li>
&lt;/ol>
&lt;p>è™½ç„¶ MmapOrderBook å†…éƒ¨ä½¿ç”¨äº†åˆ†ç‰‡é”æ¥ä¿è¯å•ä¸ªæ“ä½œçš„çº¿ç¨‹å®‰å…¨ï¼Œä½†æˆ‘ä»¬å‘ç°è¿™ç§æ–¹æ³•åœ¨å¤„ç†å¤åˆæ“ä½œæ—¶å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>a) å¤åˆæ“ä½œçš„åŸå­æ€§ï¼š
processOrder æ–¹æ³•åŒ…å«å¤šä¸ªç›¸å…³æ“ä½œï¼ˆéªŒè¯ã€æ·»åŠ ã€æ›´æ–°ä»“ä½ï¼‰ï¼Œè¿™äº›æ“ä½œéœ€è¦ä½œä¸ºä¸€ä¸ªåŸå­å•å…ƒæ‰§è¡Œã€‚&lt;/p>
&lt;p>b) é¿å…ç«æ€æ¡ä»¶ï¼š
åœ¨éªŒè¯è®¢å•å’Œæ·»åŠ è®¢å•ä¹‹é—´ï¼Œç³»ç»ŸçŠ¶æ€å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´åŸºäºè¿‡æ—¶ä¿¡æ¯åšå‡ºå†³ç­–ã€‚&lt;/p>
&lt;p>c) ä¿æŒä¸å˜é‡ï¼š
æŸäº›ä¸šåŠ¡é€»è¾‘ä¾èµ–äºå¤šä¸ªç›¸å…³æ•°æ®çš„ä¸€è‡´çŠ¶æ€ï¼Œéœ€è¦åœ¨æ•´ä¸ªæ“ä½œè¿‡ç¨‹ä¸­ç»´æŠ¤è¿™äº›ä¸å˜é‡ã€‚&lt;/p>
&lt;p>d) ç®€åŒ–å¹¶å‘æ¨¡å‹ï¼š
é«˜å±‚é”å®šå¯ä»¥ç®€åŒ–å¹¶å‘æ¨¡å‹ï¼Œä½¿ä»£ç æ›´æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚&lt;/p>
&lt;p>e) é˜²æ­¢æ­»é”ï¼š
å¤æ‚æ“ä½œä¸­å¯èƒ½éœ€è¦è·å–å¤šä¸ªä½å±‚é”ï¼Œå¢åŠ æ­»é”é£é™©ã€‚é«˜å±‚é”å¯ä»¥é™ä½è¿™ç§é£é™©ã€‚&lt;/p>
&lt;ol start="3">
&lt;li>ä¼˜åŒ–åçš„å®ç°&lt;/li>
&lt;/ol>
&lt;p>è€ƒè™‘åˆ°ä¸Šè¿°å› ç´ ï¼Œæˆ‘ä»¬å†³å®šåœ¨ OrderManager å’Œ PositionManager ä¸­å¼•å…¥é«˜å±‚é”å®šï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// OrderManager.h
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">class&lt;/span> &lt;span class="nc">OrderManager&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="n">processOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Order&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">order&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">orderBook_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PositionManager&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">positionManager_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">OrderValidator&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">orderValidator_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">mutable&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_mutex&lt;/span> &lt;span class="n">mutex_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æ–°å¢ï¼šè¯»å†™é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// OrderManager.cpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">bool&lt;/span> &lt;span class="n">OrderManager&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">processOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Order&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">order&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mutex_&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// å†™é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">orderValidator_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">validateOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">orderBook_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">addOrder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">position&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">positionManager_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getPosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">accountId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="cm">/* instrumentId */&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">position&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">position&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">quantity&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">isBuy&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nl">quantity&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">order&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">quantity&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">positionManager_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">updatePosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">position&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å‘å¸ƒè®¢å•å·²å¤„ç†äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// PositionManager.h
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">class&lt;/span> &lt;span class="nc">PositionManager&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="n">updatePosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Position&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">position&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">optional&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Position&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">getPosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int64_t&lt;/span> &lt;span class="n">accountId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int64_t&lt;/span> &lt;span class="n">instrumentId&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">orderBook_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">mutable&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_mutex&lt;/span> &lt;span class="n">mutex_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æ–°å¢ï¼šè¯»å†™é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// PositionManager.cpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">bool&lt;/span> &lt;span class="n">PositionManager&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">updatePosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Position&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">position&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mutex_&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// å†™é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">orderBook_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">updatePosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">position&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">optional&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">MmapOrderBook&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Position&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">PositionManager&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">getPosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int64_t&lt;/span> &lt;span class="n">accountId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int64_t&lt;/span> &lt;span class="n">instrumentId&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_lock&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">shared_mutex&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mutex_&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// è¯»é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">orderBook_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getPosition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">accountId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">instrumentId&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>ä¼˜åŒ–æ•ˆæœ&lt;/li>
&lt;/ol>
&lt;p>é€šè¿‡å¼•å…¥é«˜å±‚é”å®šï¼Œæˆ‘ä»¬å®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¼˜åŒ–ï¼šä»WebSocketåˆ°å¸‚åœºæ•°æ®å¤„ç†çš„å…¨é¢è§£æ</title><link>https://code-agree.github.io/blog/queue_usage2/</link><pubDate>Sun, 15 Sep 2024 04:03:51 +0800</pubDate><guid>https://code-agree.github.io/blog/queue_usage2/</guid><description>&lt;h1 id="é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¼˜åŒ–ä»websocketåˆ°å¸‚åœºæ•°æ®å¤„ç†çš„å…¨é¢è§£æ" class="relative group">é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¼˜åŒ–ï¼šä»WebSocketåˆ°å¸‚åœºæ•°æ®å¤„ç†çš„å…¨é¢è§£æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e4%bc%98%e5%8c%96%e4%bb%8ewebsocket%e5%88%b0%e5%b8%82%e5%9c%ba%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e7%9a%84%e5%85%a8%e9%9d%a2%e8%a7%a3%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;p>åœ¨å½“ä»Šç«äº‰æ¿€çƒˆçš„é‡‘èå¸‚åœºä¸­,é«˜é¢‘äº¤æ˜“(HFT)ç³»ç»Ÿçš„æ€§èƒ½ç›´æ¥å…³ç³»åˆ°äº¤æ˜“ç­–ç•¥çš„æˆåŠŸä¸å¦ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­ä¸¤ä¸ªå…³é”®ç¯èŠ‚çš„ä¼˜åŒ–ï¼šWebSocketæ¶ˆæ¯æ¥æ”¶æœºåˆ¶å’Œå¸‚åœºæ•°æ®å¤„ç†ã€‚æˆ‘ä»¬å°†åˆ†æå½“å‰æœ€ä½³å®è·µ,æ¢è®¨æ½œåœ¨çš„ä¼˜åŒ–æ–¹å‘,å¹¶æä¾›å…·ä½“çš„ä»£ç ç¤ºä¾‹ã€‚&lt;/p>
&lt;h2 id="1-websocketæ¶ˆæ¯æ¥æ”¶æœºåˆ¶ä¼˜åŒ–" class="relative group">1. WebSocketæ¶ˆæ¯æ¥æ”¶æœºåˆ¶ä¼˜åŒ– &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-websocket%e6%b6%88%e6%81%af%e6%8e%a5%e6%94%b6%e6%9c%ba%e5%88%b6%e4%bc%98%e5%8c%96" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­,æ¯ä¸€æ¯«ç§’çš„å»¶è¿Ÿéƒ½å¯èƒ½å¯¼è‡´å·¨å¤§çš„ç»æµæŸå¤±ã€‚å› æ­¤,ä¼˜åŒ–WebSocketæ¶ˆæ¯çš„æ¥æ”¶æœºåˆ¶å¯¹äºç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½è‡³å…³é‡è¦ã€‚&lt;/p>
&lt;h3 id="11-websocketclientç±»è®¾è®¡ä¸å®ç°" class="relative group">1.1 WebSocketClientç±»è®¾è®¡ä¸å®ç° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#11-websocketclient%e7%b1%bb%e8%ae%be%e8%ae%a1%e4%b8%8e%e5%ae%9e%e7%8e%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„WebSocketClientç±»çš„å®ç°ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">WebSocketClient&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">using&lt;/span> &lt;span class="n">MessageHandler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">function&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size_t&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">WebSocketClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cm">/* æ„é€ å‡½æ•°å‚æ•° */&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">ws_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">nullptr&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">running_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">false&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">receiveMessages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MessageHandler&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">ws_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">runtime_error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;WebSocket is not connected&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">constexpr&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">BUFFER_SIZE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1024&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// 1MB buffer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BUFFER_SIZE&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running_&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ws_&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">receiveFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¿æ¥å…³é—­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">Poco&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä»…åœ¨å…³é”®é”™è¯¯æ—¶è®°å½•æ—¥å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è€ƒè™‘æ·»åŠ é‡è¿é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">start&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">running_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">stop&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">running_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Poco&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Net&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">WebSocket&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">ws_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">running_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="12-å…³é”®ä¼˜åŒ–ç‚¹" class="relative group">1.2 å…³é”®ä¼˜åŒ–ç‚¹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#12-%e5%85%b3%e9%94%ae%e4%bc%98%e5%8c%96%e7%82%b9" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>&lt;strong>å¤§ç¼“å†²åŒº&lt;/strong>: ä½¿ç”¨1MBçš„ç¼“å†²åŒºå¤§å¹…å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°,æé«˜ååé‡ã€‚&lt;/li>
&lt;li>&lt;strong>é›¶æ‹·è´æ¥å£&lt;/strong>: é€šè¿‡&lt;code>MessageHandler&lt;/code>ç›´æ¥ä¼ é€’åŸå§‹æ•°æ®æŒ‡é’ˆå’Œé•¿åº¦,é¿å…ä¸å¿…è¦çš„å†…å­˜æ‹·è´ã€‚&lt;/li>
&lt;li>&lt;strong>ç®€åŒ–çš„é”™è¯¯å¤„ç†&lt;/strong>: åªåœ¨å…³é”®é”™è¯¯æ—¶è®°å½•æ—¥å¿—,å‡å°‘æ­£å¸¸æ“ä½œä¸­çš„å¼€é”€ã€‚&lt;/li>
&lt;li>&lt;strong>åŸå­æ“ä½œæ§åˆ¶&lt;/strong>: ä½¿ç”¨&lt;code>std::atomic&amp;lt;bool&amp;gt;&lt;/code>å®‰å…¨åœ°æ§åˆ¶æ¥æ”¶å¾ªç¯ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="13-åœ¨quoteè¿›ç¨‹ä¸­çš„åº”ç”¨" class="relative group">1.3 åœ¨Quoteè¿›ç¨‹ä¸­çš„åº”ç”¨ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#13-%e5%9c%a8quote%e8%bf%9b%e7%a8%8b%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>åœ¨Quoteè¿›ç¨‹ä¸­,æˆ‘ä»¬ç›´æ¥åœ¨ä¸»çº¿ç¨‹ä¸­å¤„ç†WebSocketæ¶ˆæ¯,ä»¥æœ€å°åŒ–å»¶è¿Ÿï¼š&lt;/p></description></item><item><title>é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­å¸‚åœºæ•°æ®å¤„ç†ï¼šé˜Ÿåˆ—çš„åˆ©å¼Šåˆ†æ</title><link>https://code-agree.github.io/blog/queue_usage/</link><pubDate>Sun, 15 Sep 2024 03:57:13 +0800</pubDate><guid>https://code-agree.github.io/blog/queue_usage/</guid><description>&lt;h1 id="é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­å¸‚åœºæ•°æ®å¤„ç†é˜Ÿåˆ—çš„åˆ©å¼Šåˆ†æ" class="relative group">é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­å¸‚åœºæ•°æ®å¤„ç†ï¼šé˜Ÿåˆ—çš„åˆ©å¼Šåˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e4%b8%ad%e5%b8%82%e5%9c%ba%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e9%98%9f%e5%88%97%e7%9a%84%e5%88%a9%e5%bc%8a%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;p>åœ¨é«˜é¢‘äº¤æ˜“ï¼ˆHFTï¼‰ç³»ç»Ÿä¸­ï¼Œå¤„ç†å¸‚åœºæ•°æ®çš„æ–¹å¼ç›´æ¥å½±å“ç€ç³»ç»Ÿçš„æ€§èƒ½å’Œå»¶è¿Ÿã€‚ä½¿ç”¨é˜Ÿåˆ—æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®å¤„ç†æ–¹æ³•ï¼Œä½†åœ¨è¿½æ±‚æä½å»¶è¿Ÿçš„HFTç³»ç»Ÿä¸­ï¼Œè¿™ç§é€‰æ‹©æ˜¯å¦åˆé€‚éœ€è¦ä»”ç»†è€ƒè™‘ã€‚æœ¬æ–‡å°†åˆ†æä½¿ç”¨é˜Ÿåˆ—çš„åˆ©å¼Šï¼Œå¹¶æ¢è®¨å¯èƒ½çš„æ›¿ä»£æ–¹æ¡ˆã€‚&lt;/p>
&lt;h2 id="1-ä½¿ç”¨é˜Ÿåˆ—çš„ä¼˜åŠ¿" class="relative group">1. ä½¿ç”¨é˜Ÿåˆ—çš„ä¼˜åŠ¿ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e4%bd%bf%e7%94%a8%e9%98%9f%e5%88%97%e7%9a%84%e4%bc%98%e5%8a%bf" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>è§£è€¦å’Œç¼“å†²&lt;/strong>ï¼šé˜Ÿåˆ—å¯ä»¥æœ‰æ•ˆåœ°è§£è€¦æ•°æ®ç”Ÿäº§è€…ï¼ˆå¦‚å¸‚åœºæ•°æ®æºï¼‰å’Œæ¶ˆè´¹è€…ï¼ˆå¦‚ç­–ç•¥å¼•æ“ï¼‰ï¼Œæä¾›ä¸€ä¸ªç¼“å†²åŒºæ¥å¤„ç†çªå‘çš„æ•°æ®æµã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è´Ÿè½½å‡è¡¡&lt;/strong>ï¼šåœ¨å¤šçº¿ç¨‹å¤„ç†ä¸­ï¼Œé˜Ÿåˆ—å¯ä»¥å¸®åŠ©åˆ†é…å·¥ä½œè´Ÿè½½ï¼Œé˜²æ­¢æŸä¸ªå¤„ç†å•å…ƒè¿‡è½½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç®€åŒ–è®¾è®¡&lt;/strong>ï¼šé˜Ÿåˆ—æä¾›äº†ä¸€ä¸ªç›´è§‚çš„æ•°æ®æµæ¨¡å‹ï¼Œå¯ä»¥ç®€åŒ–ç³»ç»Ÿçš„æ•´ä½“è®¾è®¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å®¹é”™æ€§&lt;/strong>ï¼šé˜Ÿåˆ—å¯ä»¥å¸®åŠ©ç³»ç»Ÿæ›´å¥½åœ°å¤„ç†æš‚æ—¶çš„å¤„ç†é€Ÿåº¦ä¸åŒ¹é…ï¼Œå¢å¼ºç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="2-ä½¿ç”¨é˜Ÿåˆ—çš„åŠ£åŠ¿" class="relative group">2. ä½¿ç”¨é˜Ÿåˆ—çš„åŠ£åŠ¿ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e4%bd%bf%e7%94%a8%e9%98%9f%e5%88%97%e7%9a%84%e5%8a%a3%e5%8a%bf" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>é¢å¤–å»¶è¿Ÿ&lt;/strong>ï¼šé˜Ÿåˆ—æ“ä½œï¼ˆå…¥é˜Ÿå’Œå‡ºé˜Ÿï¼‰ä¼šå¼•å…¥é¢å¤–çš„å»¶è¿Ÿï¼Œå³ä½¿æ˜¯å‡ å¾®ç§’çš„å»¶è¿Ÿåœ¨HFTä¸­ä¹Ÿå¯èƒ½é€ æˆæ˜¾è‘—å½±å“ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å†…å­˜å¼€é”€&lt;/strong>ï¼šé˜Ÿåˆ—éœ€è¦é¢å¤–çš„å†…å­˜åˆ†é…ï¼Œè¿™å¯èƒ½å¯¼è‡´ç¼“å­˜æœªå‘½ä¸­ï¼Œè¿›ä¸€æ­¥å¢åŠ å»¶è¿Ÿã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/strong>ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œé˜Ÿåˆ—æ“ä½œå¯èƒ½å¯¼è‡´é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é¡ºåºå¤„ç†é™åˆ¶&lt;/strong>ï¼šé˜Ÿåˆ—é€šå¸¸æŒ‰FIFOé¡ºåºå¤„ç†æ•°æ®ï¼Œè¿™å¯èƒ½ä¸é€‚åˆéœ€è¦ä¼˜å…ˆå¤„ç†æŸäº›å…³é”®æ•°æ®çš„åœºæ™¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ½œåœ¨çš„é”ç«äº‰&lt;/strong>ï¼šåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—å¯èƒ½æˆä¸ºç«äº‰çƒ­ç‚¹ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="3-æ›¿ä»£æ–¹æ¡ˆ" class="relative group">3. æ›¿ä»£æ–¹æ¡ˆ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#3-%e6%9b%bf%e4%bb%a3%e6%96%b9%e6%a1%88" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>è€ƒè™‘åˆ°é˜Ÿåˆ—å¯èƒ½å¼•å…¥çš„å»¶è¿Ÿï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„æ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p>
&lt;h3 id="31-æ— é”ç¯å½¢ç¼“å†²åŒºlock-free-ring-buffer" class="relative group">3.1 æ— é”ç¯å½¢ç¼“å†²åŒºï¼ˆLock-free Ring Bufferï¼‰ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#31-%e6%97%a0%e9%94%81%e7%8e%af%e5%bd%a2%e7%bc%93%e5%86%b2%e5%8c%balock-free-ring-buffer" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">Size&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">LockFreeRingBuffer&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Size&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">buffer_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">size_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">head_&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">atomic&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">size_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">tail_&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">current_tail&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tail_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">next_tail&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">current_tail&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">Size&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">next_tail&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">head_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_acquire&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// Buffer is full
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">buffer_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">current_tail&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">item&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tail_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">store&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">next_tail&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_release&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="nf">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">current_head&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">head_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_relaxed&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">current_head&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">tail_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_acquire&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// Buffer is empty
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">buffer_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">current_head&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">head_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">store&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">current_head&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">Size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">memory_order_release&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§æ–¹æ³•å¯ä»¥æ˜¾è‘—å‡å°‘é”ç«äº‰ï¼Œé™ä½å»¶è¿Ÿã€‚&lt;/p></description></item><item><title>Segmentation Fault Caused by std::string in Memory-Mapped File</title><link>https://code-agree.github.io/blog/string_mmap/</link><pubDate>Thu, 12 Sep 2024 15:23:23 +0800</pubDate><guid>https://code-agree.github.io/blog/string_mmap/</guid><description>&lt;h1 id="æ•…éšœå¤ç›˜æŠ¥å‘Šå†…å­˜æ˜ å°„æ–‡ä»¶ä¸­çš„-stdstring-å¯¼è‡´çš„æ®µé”™è¯¯" class="relative group">æ•…éšœå¤ç›˜æŠ¥å‘Šï¼šå†…å­˜æ˜ å°„æ–‡ä»¶ä¸­çš„ std::string å¯¼è‡´çš„æ®µé”™è¯¯ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e6%95%85%e9%9a%9c%e5%a4%8d%e7%9b%98%e6%8a%a5%e5%91%8a%e5%86%85%e5%ad%98%e6%98%a0%e5%b0%84%e6%96%87%e4%bb%b6%e4%b8%ad%e7%9a%84-stdstring-%e5%af%bc%e8%87%b4%e7%9a%84%e6%ae%b5%e9%94%99%e8%af%af" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="1-é—®é¢˜æè¿°" class="relative group">1. é—®é¢˜æè¿° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#1-%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>åœ¨ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶å­˜å‚¨è®¢å•æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œç¨‹åºåœ¨é‡å¯åå‡ºç°æ®µé”™è¯¯ã€‚å…·ä½“è¡¨ç°ä¸ºåœ¨å°è¯•è®¿é—®å­˜å‚¨åœ¨å†…å­˜æ˜ å°„æ–‡ä»¶ä¸­çš„ &lt;code>Order&lt;/code> ç»“æ„ä½“çš„ &lt;code>id&lt;/code> å­—æ®µæ—¶ï¼Œç¨‹åºå´©æºƒã€‚&lt;/p>
&lt;h2 id="2-é”™è¯¯ä¿¡æ¯" class="relative group">2. é”™è¯¯ä¿¡æ¯ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#2-%e9%94%99%e8%af%af%e4%bf%a1%e6%81%af" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;p>ç¨‹åºå´©æºƒæ—¶çš„ GDB è°ƒè¯•ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>Thread 2 &amp;#34;strategyandtrad&amp;#34; received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7ffff6f4c6c0 (LWP 446582)]
__memcmp_sse2 () at ../sysdeps/x86_64/multiarch/memcmp-sse2.S:258
258 ../sysdeps/x86_64/multiarch/memcmp-sse2.S: No such file or directory.
(gdb) bt
#0 __memcmp_sse2 () at ../sysdeps/x86_64/multiarch/memcmp-sse2.S:258
#1 0x000055555556d79b in std::char_traits&amp;lt;char&amp;gt;::compare (__s1=0x7f4710000eb0 &amp;lt;error: Cannot access memory at address 0x7f4710000eb0&amp;gt;, 
 __s2=0x7fffe8000c80 &amp;#34;ORD-1726124231791862593&amp;#34;, __n=23) at /usr/include/c++/12/bits/char_traits.h:385
#2 0x000055555559c599 in std::operator==&amp;lt;char&amp;gt; (__lhs=&amp;lt;error: Cannot access memory at address 0x7f4710000eb0&amp;gt;, __rhs=&amp;#34;ORD-1726124231791862593&amp;#34;)
 at /usr/include/c++/12/bits/basic_string.h:3587
#3 0x000055555561a7fa in MmapOrderBook::Impl::getOrder (this=0x555555776170, orderId=&amp;#34;ORD-1726124231791862593&amp;#34;)
 at /home/hft_trading_system/strategyandtradingwitheventbus/src/order_management/mmap_order_book_impl.cpp:211
...

(gdb) frame 3
#3 0x000055555561a7fa in MmapOrderBook::Impl::getOrder (this=0x555555776170, orderId=&amp;#34;ORD-1726124231791862593&amp;#34;)
 at /home/hft_trading_system/strategyandtradingwitheventbus/src/order_management/mmap_order_book_impl.cpp:211
211 if (m_orders[i].id == orderId) {
(gdb) print orderId
$1 = &amp;#34;ORD-1726124231791862593&amp;#34;
(gdb) print m_orders[i].id
$2 = &amp;lt;error: Cannot access memory at address 0x7f4710000eb0&amp;gt;
(gdb) print m_orders[i]
$3 = {id = &amp;lt;error: Cannot access memory at address 0x7f4710000eb0&amp;gt;, instId = &amp;lt;error: Cannot access memory at address 0x7f4710000ed0&amp;gt;, 
 price = 58126.699999999997, quantity = 100, status = 3}
&lt;/code>&lt;/pre>&lt;ol start="3">
&lt;li>ç›¸å…³ä»£ç &lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">Order&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">instId&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">double&lt;/span> &lt;span class="n">price&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">double&lt;/span> &lt;span class="n">quantity&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">status&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// 0: pending, 1: filled, 2: cancelled
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªç»“æ„ä½“ç›´æ¥åœ¨å†…å­˜æ˜ å°„æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œå¯¼è‡´äº†æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p></description></item><item><title>Analysis of Configuration Management in High-Frequency Trading System</title><link>https://code-agree.github.io/blog/config_managemeng_in_hft_system/</link><pubDate>Fri, 06 Sep 2024 01:47:52 +0800</pubDate><guid>https://code-agree.github.io/blog/config_managemeng_in_hft_system/</guid><description>&lt;h1 id="é«˜é¢‘äº¤æ˜“ç³»ç»Ÿé…ç½®ç®¡ç†æ–¹æ¡ˆåˆ†æ" class="relative group">é«˜é¢‘äº¤æ˜“ç³»ç»Ÿé…ç½®ç®¡ç†æ–¹æ¡ˆåˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86%e6%96%b9%e6%a1%88%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;h2 id="å½“å‰æ–¹æ¡ˆæ¦‚è¿°" class="relative group">å½“å‰æ–¹æ¡ˆæ¦‚è¿° &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%bd%93%e5%89%8d%e6%96%b9%e6%a1%88%e6%a6%82%e8%bf%b0" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;pre tabindex="0">&lt;code class="language-Mermaid" data-lang="Mermaid">
graph TB
 CommonLib[&amp;#34;Common Library (MMAP)&amp;#34;]
 Exchange[&amp;#34;Exchange&amp;#34;]

 subgraph StrategyAndTrading[&amp;#34;StrategyAndTrading Component&amp;#34;]
 MDR[&amp;#34;MarketDataReader&amp;#34;]
 MDN[&amp;#34;MarketDataNormalizer&amp;#34;]
 SM[&amp;#34;StrategyManager&amp;#34;]
 subgraph Strategies[&amp;#34;Strategies&amp;#34;]
 S1[&amp;#34;Strategy 1&amp;#34;]
 S2[&amp;#34;Strategy 2&amp;#34;]
 SN[&amp;#34;Strategy N&amp;#34;]
 end
 OG[&amp;#34;OrderGenerator&amp;#34;]
 OV[&amp;#34;OrderValidator&amp;#34;]
 RP[&amp;#34;RiskProfiler&amp;#34;]
 RE[&amp;#34;RiskEvaluator&amp;#34;]
 OM[&amp;#34;OrderManager&amp;#34;]
 OE[&amp;#34;OrderExecutor&amp;#34;]
 OMO[&amp;#34;OrderMonitor&amp;#34;]
 PM[&amp;#34;PositionManager&amp;#34;]
 end

 CommonLib --&amp;gt;|1. Read MMAP| MDR
 MDR --&amp;gt;|2. Raw Market Data| MDN
 MDN --&amp;gt;|3. Normalized Data| SM
 SM --&amp;gt;|4. Distribute Data| Strategies
 Strategies --&amp;gt;|5. Generate Signals| OG
 OG --&amp;gt;|6. Create Orders| OV
 OV --&amp;gt;|7. Validated Orders| RP
 RP --&amp;gt;|8. Risk Profile| RE
 RE --&amp;gt;|9. Risk Evaluated Orders| OM
 OM --&amp;gt;|10. Managed Orders| OE
 OE &amp;lt;--&amp;gt;|11. Execute Orders| Exchange
 Exchange --&amp;gt;|12. Execution Results| OMO
 OMO --&amp;gt;|13. Order Updates| OM
 OM --&amp;gt;|14. Position Updates| PM
 PM -.-&amp;gt;|15. Position Feedback| SM

 classDef external fill:#f9f,stroke:#333,stroke-width:2px;
 classDef component fill:#bbf,stroke:#333,stroke-width:1px;
 classDef strategy fill:#bfb,stroke:#333,stroke-width:1px;
 class CommonLib,Exchange external;
 class MDR,MDN,SM,OG,OV,RP,RE,OM,OE,OMO,PM component;
 class S1,S2,SN strategy;
&lt;/code>&lt;/pre>&lt;ol>
&lt;li>Quoteè¿›ç¨‹ä½¿ç”¨commoné™æ€åº“ç»„ä»¶åŠ è½½é…ç½®ä¿¡æ¯ã€‚&lt;/li>
&lt;li>é…ç½®ä¿¡æ¯åŠ è½½åˆ°Quoteè¿›ç¨‹çš„æœ¬åœ°ç¼“å­˜ä¸­ã€‚&lt;/li>
&lt;li>ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼è®¢é˜…commonç»„ä»¶ä¸­configçš„å˜æ›´ã€‚&lt;/li>
&lt;li>å½“é…ç½®å˜æ›´æ—¶ï¼ŒQuoteè¿›ç¨‹æ›´æ–°æœ¬åœ°ç¼“å­˜ã€é‡æ–°è¿æ¥å’Œé‡æ–°è®¢é˜…ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="ä¼˜ç‚¹åˆ†æ" class="relative group">ä¼˜ç‚¹åˆ†æ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e4%bc%98%e7%82%b9%e5%88%86%e6%9e%90" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>æ¨¡å—åŒ–è®¾è®¡&lt;/strong>ï¼š&lt;/p></description></item><item><title>How to publish new blog</title><link>https://code-agree.github.io/blog/how_to_publish_new_blog/</link><pubDate>Mon, 02 Sep 2024 12:36:27 +0800</pubDate><guid>https://code-agree.github.io/blog/how_to_publish_new_blog/</guid><description>&lt;h3 id="workflow" class="relative group">workflow &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#workflow" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>ç›®å‰å·²ç»å®ç°GitHub Actionï¼Œè‡ªåŠ¨ç¼–è¯‘é™æ€æ–‡ä»¶, Pushåˆ°GitHub Pageã€‚&lt;/p>
&lt;h3 id="å…·ä½“æµç¨‹" class="relative group">å…·ä½“æµç¨‹ &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e5%85%b7%e4%bd%93%e6%b5%81%e7%a8%8b" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>åœ¨ä»“åº“ &lt;code>git@github.com:code-agree/MyBlogWebsiteRepo.git&lt;/code> MyBlogWebsiteRepo/WebsiteRepo ä½¿ç”¨
hugoå‘½ä»¤ &lt;code>hugo new content ./content/blog/How_to_publish_new_blog.md&lt;/code> æ–°å¢blog&lt;/li>
&lt;li>å°†å½“å‰ä»“åº“çš„å˜æ›´pushåˆ°è¿œç«¯&lt;/li>
&lt;li>ç”±é…ç½®çš„GitHub action è‡ªåŠ¨è§¦å‘ æ„å»ºé™æ€æ–‡ä»¶-&amp;gt;pushåˆ°GitHub Pageä»“åº“&lt;/li>
&lt;li>æˆåŠŸå‘å¸ƒ&lt;/li>
&lt;/ol></description></item><item><title>Lock Free Queue Application</title><link>https://code-agree.github.io/blog/lockfree/</link><pubDate>Mon, 02 Sep 2024 02:10:33 +0800</pubDate><guid>https://code-agree.github.io/blog/lockfree/</guid><description>&lt;h3 id="æ ‡é¢˜è§£å†³é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„æ­»é”ä»ä¼ ç»Ÿ-eventbus-åˆ°æ— é”é˜Ÿåˆ—çš„ä¼˜åŒ–ä¹‹æ—…" class="relative group">æ ‡é¢˜ï¼šè§£å†³é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­çš„æ­»é”ï¼šä»ä¼ ç»Ÿ EventBus åˆ°æ— é”é˜Ÿåˆ—çš„ä¼˜åŒ–ä¹‹æ—… &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e6%a0%87%e9%a2%98%e8%a7%a3%e5%86%b3%e9%ab%98%e9%a2%91%e4%ba%a4%e6%98%93%e7%b3%bb%e7%bb%9f%e4%b8%ad%e7%9a%84%e6%ad%bb%e9%94%81%e4%bb%8e%e4%bc%a0%e7%bb%9f-eventbus-%e5%88%b0%e6%97%a0%e9%94%81%e9%98%9f%e5%88%97%e7%9a%84%e4%bc%98%e5%8c%96%e4%b9%8b%e6%97%85" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;ol>
&lt;li>
&lt;p>å¼•è¨€
åœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€æ¯«ç§’éƒ½è‡³å…³é‡è¦ã€‚æœ€è¿‘åœ¨ç³»ç»Ÿä¸­é‡åˆ°äº†ä¸€ä¸ªä»¤äººå¤´ç–¼çš„æ­»é”é—®é¢˜ï¼Œè¿™ä¸ä»…å½±å“äº†ç³»ç»Ÿçš„æ€§èƒ½ï¼Œè¿˜å±åŠäº†å…¶ç¨³å®šæ€§ã€‚æœ¬æ–‡å°†è¯¦ç»†è®²è¿°å¦‚ä½•å‘ç°ã€åˆ†æå¹¶æœ€ç»ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»¥åŠä»ä¸­å­¦åˆ°çš„å®è´µç»éªŒã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜å‘ç°
åœ¨ä¸€æ¬¡ä¾‹è¡Œçš„ç³»ç»Ÿç›‘æ§ä¸­ï¼Œæ³¨æ„åˆ°ç³»ç»Ÿå¶å°”ä¼šå‡ºç°çŸ­æš‚çš„åœé¡¿ã€‚é€šè¿‡æ—¥å¿—åˆ†æï¼Œå‘ç° MarketDataReader çš„ readingLoop() å‡½æ•°åªæ‰§è¡Œäº†ä¸€æ¬¡å°±åœæ­¢äº†ã€‚è¿™å¼•èµ·äº†çš„è­¦è§‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜åˆ†æ
é¦–å…ˆæŸ¥çœ‹äº† MarketDataReader çš„æ—¥å¿—ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>[2024-09-01 13:02:08.472] [main_logger] [MarketDataReader.cpp:38] [info] [thread 4048966] [start] Starting market data reader...
[2024-09-01 13:02:08.472] [main_logger] [MarketDataReader.cpp:40] [info] [thread 4048966] [start] Starting start,and running_ = true
[2024-09-01 13:02:08.489] [main_logger] [MarketDataReader.cpp:63] [info] [thread 4048967] [readingLoop] Starting reading loop...,and running_ = true
[2024-09-01 13:02:08.490] [main_logger] [MarketDataReader.cpp:65] [info] [thread 4048967] [readingLoop] Reading loop...
[2024-09-01 13:02:08.490] [main_logger] [MarketDataReader.cpp:83] [info] [thread 4048967] [processSymbol] Processing symbol: BTC-USDT
[2024-09-01 13:02:08.490] [main_logger] [MarketDataReader.cpp:87] [info] [thread 4048967] [processSymbol] timeSinceLastUpdate: 24305 can into loop
[2024-09-01 13:02:08.490] [main_logger] [MarketDataStore.cpp:137] [info] [thread 4048967] [readLatestData] Read data for symbol = BTC-USDT, timestamp = 1725228018
[2024-09-01 13:02:08.491] [main_logger] [MarketDataReader.cpp:94] [info] [thread 4048967] [processSymbol] currentData: 58124.24
[2024-09-01 13:02:08.491] [main_logger] [MarketDataReader.cpp:95] [info] [thread 4048967] [processSymbol] publish marketDataEvent
[2024-09-01 13:02:08.491] [main_logger] [EventBus.h:59] [info] [thread 4048967] [publish] publish event: 15MarketDataEvent
[2024-09-01 13:02:08.492] [main_logger] [StrategyManager.cpp:38] [info] [thread 4048967] [processSignals] publish orderEvent: BTC-USDT
[2024-09-01 13:02:08.492] [main_logger] [EventBus.h:59] [info] [thread 4048967] [publish] publish event: 10OrderEvent
&lt;/code>&lt;/pre>&lt;p>æ—¥å¿—æ˜¾ç¤ºï¼ŒreadingLoop ç¡®å®å¼€å§‹æ‰§è¡Œï¼Œä½†åœ¨å¤„ç†å®Œä¸€ä¸ªå¸‚åœºæ•°æ®äº‹ä»¶åå°±æ²¡æœ‰ç»§ç»­ã€‚è¿™æš—ç¤ºå¯èƒ½å­˜åœ¨æ­»é”ã€‚&lt;/p></description></item><item><title>First Post</title><link>https://code-agree.github.io/blog/two/</link><pubDate>Sun, 04 Aug 2024 00:13:28 +0800</pubDate><guid>https://code-agree.github.io/blog/two/</guid><description>&lt;h1 id="const" class="relative group">Const &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#const" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h1>&lt;p>Owner: More_surface Ted
Created time: July 25, 2024 4:59 PM&lt;/p>
&lt;p>const å¯ä»¥ç”¨æ¥ä¿®é¥°å˜é‡ã€å‡½æ•°ã€æŒ‡é’ˆç­‰ã€‚&lt;/p>
&lt;ol>
&lt;li>ä¿®é¥°å˜é‡&lt;/li>
&lt;/ol>
&lt;p>å½“ä¿®é¥°å˜é‡æ—¶ï¼Œæ„å‘³ç€è¯¥å˜é‡ä¸ºåªè¯»å˜é‡ï¼Œå³ä¸èƒ½è¢«ä¿®æ”¹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">const&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//ç¼–è¯‘æŠ¥é”™ï¼Œaä¸ºåªè¯»ï¼Œä¸å¯ä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯å¯ä»¥é€šè¿‡ä¸€äº›æŒ‡é’ˆç±»å‹è½¬æ¢æ“ä½œ&lt;a href="https://www.notion.so/const_cast-45bcd744ee374253abebd58b83a5c812?pvs=21" target="_blank" rel="noreferrer">const_cast&lt;/a> ï¼Œä¿®æ”¹è¿™ä¸ªå˜é‡ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// pæ˜¯æŒ‡å‘const intç±»å‹çš„å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">q&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">const_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">*&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// ç±»å‹è½¬æ¢ï¼Œå°†pè½¬æ¢æˆæŒ‡å‘intå‹å¯¹è±¡çš„æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">q&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// é€šè¿‡æŒ‡é’ˆæ“ä½œä¿®æ”¹ const açš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">ends&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// è¾“å‡ºç»“æœ ä»ç„¶æ˜¯10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡ºç»“æœä¸å˜ï¼Œå½’åŠŸäºç¼–è¯‘å™¨é†‰åšäº†ä¼˜åŒ–ï¼Œç¼–è¯‘æ—¶æŠŠä»£ç æ›¿æ¢ä¸ºäº†å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p>
&lt;p>&lt;code>std::cout &amp;lt;&amp;lt; &amp;quot;a = &amp;quot; &amp;lt;&amp;lt; 10 &amp;lt;&amp;lt; std::endl;&lt;/code>&lt;/p>
&lt;ol>
&lt;li>ä¿®é¥°å‡½æ•°å‚æ•°ï¼Œè¡¨ç¤ºå‡½æ•°ä¸ä¼šä¿®æ”¹å‚æ•°&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç¼–è¯‘é”™è¯¯ï¼Œä¸èƒ½ä¿®æ”¹ a çš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>ä¿®é¥°å‡½æ•°è¿”å›å€¼&lt;/li>
&lt;/ol>
&lt;p>å½“ä¿®é¥°å‡½æ•°è¿”å›å€¼æ—¶ï¼Œè¡¨ç¤ºå‡½æ•°çš„è¿”å›å€¼ä¸ºåªè¯»ï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚å¥½å¤„æ˜¯å¯ä»¥ä½¿å‡½æ•°çš„è¿”å›å€¼æ›´åŠ å®‰å…¨ï¼Œä¸ä¼šè¢«è¯¯ä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">const&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">func&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// b çš„å€¼ä¸º 10ï¼Œä¸èƒ½è¢«ä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ç¼–è¯‘é”™è¯¯ï¼Œb æ˜¯åªè¯»å˜é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>ä¿®é¥°æŒ‡é’ˆæˆ–å¼•ç”¨&lt;/li>
&lt;/ol>
&lt;p>4.1. constä¿®é¥°çš„æ˜¯æŒ‡é’ˆæ‰€æŒ‡å‘çš„å˜é‡ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆæœ¬èº«ï¼›æŒ‡é’ˆæœ¬èº«å¯ä»¥è¢«ä¿®æ”¹(å¯ä»¥æŒ‡å‘æ–°çš„å˜é‡)ï¼Œä½†æ˜¯ä¸èƒ½é€šè¿‡æŒ‡é’ˆä¿®æ”¹æ‰€æŒ‡å‘çš„å˜é‡ã€‚&lt;/p></description></item><item><title>two First Post</title><link>https://code-agree.github.io/blog/two-first-post/</link><pubDate>Sat, 03 Aug 2024 00:13:28 +0800</pubDate><guid>https://code-agree.github.io/blog/two-first-post/</guid><description>&lt;p>This is my first blog post&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">B&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="badge" class="relative group">Badge &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#badge" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;span class="flex">
 &lt;span
 class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
 >
 
æ–°æ–‡ç« ï¼

 &lt;/span>
&lt;/span>


&lt;h3 id="çŸ­é¡µç " class="relative group">çŸ­é¡µç  &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%e7%9f%ad%e9%a1%b5%e7%a0%81" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;div class="flex rounded-md bg-primary-100 px-4 py-3 dark:bg-primary-900">
 &lt;span class="pe-3 text-primary-400">
 &lt;span class="icon relative inline-block px-1 align-text-bottom">&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">&lt;path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/>&lt;/svg>
&lt;/span>
 &lt;/span>
 &lt;span class="dark:text-neutral-300">&lt;strong>è­¦å‘Šï¼&lt;/strong> è¿™ä¸ªæ“ä½œæ˜¯ç ´åæ€§çš„ï¼&lt;/span>
&lt;/div>

&lt;div class="flex rounded-md bg-primary-100 px-4 py-3 dark:bg-primary-900">
 &lt;span class="pe-3 text-primary-400">
 &lt;span class="icon relative inline-block px-1 align-text-bottom">&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">&lt;path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/>&lt;/svg>
&lt;/span>
 &lt;/span>
 &lt;span class="dark:text-neutral-300">åˆ«å¿˜äº†åœ¨Twitterä¸Š&lt;a href="https://twitter.com/jpanther" target="_blank" rel="noreferrer">å…³æ³¨æˆ‘&lt;/a>ã€‚&lt;/span>
&lt;/div>

&lt;h3 id="button" class="relative group">Button &lt;span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100">&lt;a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#button" aria-label="Anchor">#&lt;/a>&lt;/span>&lt;/h3>&lt;p>button è¾“å‡ºä¸€ä¸ªæ ·å¼åŒ–çš„æŒ‰é’®ç»„ä»¶ï¼Œç”¨äºçªå‡ºæ˜¾ç¤ºä¸»è¦æ“ä½œã€‚å®ƒæœ‰ä¸‰ä¸ªå¯é€‰å‚æ•°ï¼š&lt;/p></description></item><item><title>My First Post</title><link>https://code-agree.github.io/blog/firstpost/</link><pubDate>Sat, 03 Aug 2024 00:11:28 +0800</pubDate><guid>https://code-agree.github.io/blog/firstpost/</guid><description>&lt;p>è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡blogï¼Œå¸Œæœ›èƒ½åˆ†äº«æ›´å¤šçš„æŠ€æœ¯ï¼Œç”Ÿæ´»ã€å…´è¶£åœ¨è¿™ä¸ªBlogä¸Šã€‚æ¬¢è¿å¤§å®¶æŸ¥çœ‹è¯„è®ºã€‚&lt;/p>
&lt;p>Welcome to my inaugural blog post! I&amp;rsquo;m excited to share more about technology, life experiences, and personal interests through this platform. Feel free to check out the comments section and join the conversation!&lt;/p></description></item></channel></rss>